!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=49)}([function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(56),i=r(57),o=r(29);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|d(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=a(e,t<0?0:0|d(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|d(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function d(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(e).length;default:if(n)return j(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return C(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return T(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:w(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):w(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var f=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){f=!1;break}if(f)return o}return-1}function b(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function v(e,t,r,n){return z(j(t,e.length-r),e,r,n)}function _(e,t,r,n){return z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return _(e,t,r,n)}function S(e,t,r,n){return z(V(t),e,r,n)}function I(e,t,r,n){return z(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function T(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function C(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],l=null,f=u>239?4:u>223?3:u>191?2:1;if(i+f<=r)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return f(null,e)},c.allocUnsafeSlow=function(e){return f(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(n,i),l=e.slice(t,r),f=0;f<a;++f)if(u[f]!==l[f]){o=u[f],s=l[f];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function x(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=B(e[o]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function k(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function F(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function L(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,o){return o||L(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,o){return o||L(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):F(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):F(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=c.isBuffer(e)?e:j(new c(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function V(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(4))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&d())}function d(){if(!l){var e=a(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||l||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=n;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function i(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var o={},s={};function a(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=s[e])?n:(r=u(e,(0|e)<0?-1:0,!0),i&&(s[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=o[e])?n:(r=u(e,e<0?-1:0,!1),i&&(o[e]=r),r)}function c(e,t){if(isNaN(e))return t?w:y;if(t){if(e<0)return w;if(e>=p)return S}else{if(e<=-g)return I;if(e+1>=g)return E}return e<0?c(-e,t).neg():u(e%d|0,e/d|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=c,n.fromBits=u;var l=Math.pow;function f(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return y;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return f(e.substring(1),t,r).neg();for(var i=c(l(r,8)),o=y,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+a),r);if(a<8){var h=c(l(r,a));o=o.mul(h).add(c(u))}else o=(o=o.mul(i)).add(c(u))}return o.unsigned=t,o}function h(e,t){return"number"==typeof e?c(e,t):"string"==typeof e?f(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=f,n.fromValue=h;var d=4294967296,p=d*d,g=p/2,m=a(1<<24),y=a(0);n.ZERO=y;var w=a(0,!0);n.UZERO=w;var b=a(1);n.ONE=b;var v=a(1,!0);n.UONE=v;var _=a(-1);n.NEG_ONE=_;var E=u(-1,2147483647,!1);n.MAX_VALUE=E;var S=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=S;var I=u(0,-2147483648,!1);n.MIN_VALUE=I;var T=n.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=c(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=c(l(e,6),this.unsigned),o=this,s="";;){var a=o.div(i),u=(o.sub(a.mul(i)).toInt()>>>0).toString(e);if((o=a).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(b)},T.neg=T.negate,T.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,c=e.low>>>16,l=0,f=0,d=0,p=0;return d+=(p+=o+(65535&e.low))>>>16,f+=(d+=n+c)>>>16,l+=(f+=r+a)>>>16,l+=t+s,u((d&=65535)<<16|(p&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},T.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return y;if(i(e)||(e=h(e)),r)return u(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return y;if(this.eq(I))return e.isOdd()?I:y;if(e.eq(I))return this.isOdd()?I:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return c(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,l=65535&e.high,f=e.low>>>16,d=65535&e.low,p=0,g=0,w=0,b=0;return w+=(b+=s*d)>>>16,g+=(w+=o*d)>>>16,w&=65535,g+=(w+=s*f)>>>16,p+=(g+=n*d)>>>16,g&=65535,p+=(g+=o*f)>>>16,g&=65535,p+=(g+=s*l)>>>16,p+=t*d+n*f+o*l+s*a,u((w&=65535)<<16|(b&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,n,o;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?w:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return w;if(e.gt(this.shru(1)))return v;o=w}else{if(this.eq(I))return e.eq(b)||e.eq(_)?I:e.eq(I)?b:(t=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:_:(n=this.sub(e.mul(t)),o=t.add(n.div(e)));if(e.eq(I))return this.unsigned?w:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=y}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:l(2,s-48),f=c(t),d=f.mul(e);d.isNegative()||d.gt(n);)d=(f=c(t-=a,this.unsigned)).mul(e);f.isZero()&&(f=b),o=o.add(f),n=n.sub(d)}return o},T.div=T.divide,T.modulo=function(e){return i(e)||(e=h(e)),r?u((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return u(~this.low,~this.high,this.unsigned)},T.and=function(e){return i(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return i(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return i(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){(function(t){var n=r(32),i=r(10);function o(){return(new Date).getTime()}var s,a=Array.prototype.slice,c={};s=void 0!==t&&t.console?t.console:"undefined"!=typeof window&&window.console?window.console:{};for(var u=[[function(){},"log"],[function(){s.log.apply(s,arguments)},"info"],[function(){s.log.apply(s,arguments)},"warn"],[function(){s.warn.apply(s,arguments)},"error"],[function(e){c[e]=o()},"time"],[function(e){var t=c[e];if(!t)throw new Error("No such label: "+e);delete c[e];var r=o()-t;s.log(e+": "+r+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=n.format.apply(null,arguments),s.error(e.stack)},"trace"],[function(e){s.log(n.inspect(e)+"\n")},"dir"],[function(e){if(!e){var t=a.call(arguments,1);i.ok(!1,n.format.apply(null,t))}},"assert"]],l=0;l<u.length;l++){var f=u[l],h=f[0],d=f[1];s[d]||(s[d]=h)}e.exports=s}).call(this,r(4))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(76);class i{constructor(e){this.info=n(e+":info"),this.warn=n(e+":warn"),this.error=n(e+":error"),this.debug=n(e+":debug"),this.trace=n(e+":trace")}}t.Logger=i,t.formatters=n.formatters;const o=function(e){return new i(e)};o.default=o,o.Logger=i,o.formatters=n.formatters,t.default=o,e.exports=o},function(e,t,r){"use strict";var n=r(14),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=f;var o=Object.create(r(11));o.inherits=r(9);var s=r(40),a=r(23);o.inherits(f,s);for(var c=i(a.prototype),u=0;u<c.length;u++){var l=c[u];f.prototype[l]||(f.prototype[l]=a.prototype[l])}function f(e){if(!(this instanceof f))return new f(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),f.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,r){"use strict";(function(t){var r,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,r,n,i){var o,s,a,l;if(c(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",r,n.listener?n.listener:n),s=e._events),a=s[r]),void 0===a)a=s[r]=n,++e._eventsCount;else if("function"==typeof a?a=s[r]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(o=u(e))>0&&a.length>o&&!a.warned){a.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=r,f.count=a.length,l=f,t&&t.warn&&t.warn(l)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=f.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,l=g(c,u);for(r=0;r<u;++r)i(l[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,o,s;if(c(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}}).call(this,r(3))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(79);t.Reader=n.default;var i=r(82);t.Writer=i.default;var o=r(83);t.Predictor=o.default},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},function(e,t,r){"use strict";(function(t){var n=r(67);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function o(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var s=r(32),a=Object.prototype.hasOwnProperty,c=Array.prototype.slice,u="foo"===function(){}.name;function l(e){return Object.prototype.toString.call(e)}function f(e){return!o(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var h=e.exports=w,d=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(s.isFunction(e)){if(u)return e.name;var t=e.toString().match(d);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(u||!s.isFunction(e))return s.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function y(e,t,r,n,i){throw new h.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function w(e,t){e||y(e,!0,t,"==",h.ok)}function b(e,t,r,n){if(e===t)return!0;if(o(e)&&o(t))return 0===i(e,t);if(s.isDate(e)&&s.isDate(t))return e.getTime()===t.getTime();if(s.isRegExp(e)&&s.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(f(e)&&f(t)&&l(e)===l(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var a=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==a&&a===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(s.isPrimitive(e)||s.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=v(e),o=v(t);if(i&&!o||!i&&o)return!1;if(i)return e=c.call(e),t=c.call(t),b(e,t,r);var a,u,l=S(e),f=S(t);if(l.length!==f.length)return!1;for(l.sort(),f.sort(),u=l.length-1;u>=0;u--)if(l[u]!==f[u])return!1;for(u=l.length-1;u>=0;u--)if(a=l[u],!b(e[a],t[a],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function v(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function _(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function E(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&y(i,r,"Missing expected exception"+n);var o="string"==typeof n,a=!e&&i&&!r;if((!e&&s.isError(i)&&o&&_(i,r)||a)&&y(i,r,"Got unwanted exception"+n),e&&i&&r&&!_(i,r)||!e&&i)throw i}h.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(m(e.actual),128)+" "+e.operator+" "+g(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=p(t),o=n.indexOf("\n"+i);if(o>=0){var s=n.indexOf("\n",o+1);n=n.substring(s+1)}this.stack=n}}},s.inherits(h.AssertionError,Error),h.fail=y,h.ok=w,h.equal=function(e,t,r){e!=t&&y(e,t,r,"==",h.equal)},h.notEqual=function(e,t,r){e==t&&y(e,t,r,"!=",h.notEqual)},h.deepEqual=function(e,t,r){b(e,t,!1)||y(e,t,r,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,r){b(e,t,!0)||y(e,t,r,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,r){b(e,t,!1)&&y(e,t,r,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,r,n){b(t,r,!0)&&y(t,r,n,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,r){e!==t&&y(e,t,r,"===",h.strictEqual)},h.notStrictEqual=function(e,t,r){e===t&&y(e,t,r,"!==",h.notStrictEqual)},h.throws=function(e,t,r){E(!0,e,t,r)},h.doesNotThrow=function(e,t,r){E(!1,e,t,r)},h.ifError=function(e){if(e)throw e},h.strict=n((function e(t,r){t||y(t,!0,r,"==",e)}),h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var S=Object.keys||function(e){var t=[];for(var r in e)a.call(e,r)&&t.push(r);return t}}).call(this,r(4))},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2);function i(e,t){return e.lessThan(t)?e:t}function o(e,t,r){let i=n.UZERO,o=n.UZERO,s=t.divide(r),a=t.modulo(r);for(;!e.isZero();){let t=i;if(e.and(n.UONE).isZero()||(i=i.add(s),o=o.add(a),o.greaterThanOrEqual(r)&&(i=i.add(n.UONE),o=o.subtract(r))),i.lessThan(t))return{quo:n.MAX_UNSIGNED_VALUE,rem:n.UZERO};e=e.shiftRightUnsigned(1),s=s.shiftLeft(1),a=a.shiftLeft(1),a.greaterThanOrEqual(r)&&(s=s.add(n.UONE),a=a.subtract(r))}return{quo:i,rem:o}}t.longFromValue=function(e,t){if("number"==typeof e){if(t&&e<0)throw new Error("Expected positive number");return n.fromNumber(e,t)}if("string"==typeof e){if(t&&"-"===e[0])throw new Error("Expected positive number");const r=n.fromString(e,t);if(r.toString()!==e)throw new Error("Value "+e+" does not fit in a Long.");return r}if(e.unsigned!==t)throw new Error("Expected "+(t?"unsigned":"signed")+" Long");return e},t.maxLong=function(e,t){return e.greaterThan(t)?e:t},t.minLong=i,t.minLongs=function(e){let t=e[0];for(let r=1;r<e.length;r++)t=i(t,e[r]);return t},t.countDigits=function(e){let t=0;for(;!e.isZero();)t++,e=e.divide(10);return t},t.checkedAdd=function(e,t){const r=e.add(t),i=r.lessThan(e)||r.lessThan(t);return{sum:i?n.MAX_UNSIGNED_VALUE:r,overflow:i}},t.checkedSubtract=function(e,t){const r=e.subtract(t),i=r.greaterThan(e)&&r.greaterThan(t);return{difference:i?n.UZERO:r,underflow:i}},t.checkedMultiply=function(e,t){const r=e.multiply(t),i=r.lessThan(e)||r.lessThan(t);return{product:i?n.MAX_UNSIGNED_VALUE:r,overflow:i}},t.multiplyDivideFloor=function(e,t,r){return o(e,t,r).quo},t.multiplyDivideCeil=function(e,t,r){const{quo:i,rem:s}=o(e,t,r);return i.equals(n.MAX_UNSIGNED_VALUE)?i:i.add(s.isZero()?0:1)},t.multiplyDivideRound=function(e,t,r){const{quo:i,rem:s}=o(e,t,r);return i.equals(n.MAX_UNSIGNED_VALUE)?i:!s.isZero()&&(r.isOdd()?s.greaterThan(r.divide(2)):s.greaterThanOrEqual(r.divide(2)))?i.add(n.UONE):i},t.multiplyDivide=o,n.prototype.toJSON=function(){return this.toString()}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(68),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(4))},function(e,t,r){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,r)}));case 3:return t.nextTick((function(){e.call(null,r,n)}));case 4:return t.nextTick((function(){e.call(null,r,n,i)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick((function(){e.apply(null,o)}))}}}:e.exports=t}).call(this,r(1))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDoc=function(e){return void 0===e&&(e=document),e}},function(e,t){var r=1e3,n=6e4,i=60*n,o=24*i;function s(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=o)return s(e,t,o,"day");if(t>=i)return s(e,t,i,"hour");if(t>=n)return s(e,t,n,"minute");if(t>=r)return s(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=o)return Math.round(e/o)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.MAX_SAFE_BYTES=6;var i=/^-?[0-9]+$/;function o(e){return n.isLong(e)}t.isInteger=function(e){return"number"==typeof e?isFinite(e)&&Math.floor(e)===e:"string"==typeof e?!!i.exec(e):n.isLong(e)},t.isLong=o,t.longFromValue=function(e,t){if("number"==typeof e){if(t&&e<0)throw new Error("UInt must be positive");return n.fromNumber(e,t)}if(o(e)){if(e.unsigned!==t)throw t?new Error("Expected unsigned Long"):new Error("Expected signed Long");return e}if(t&&"-"===e[0])throw new Error("UInt must be positive");return n.fromString(e,t)},t.bufferToLong=function(e,t){if(e.length>8)throw new Error((t?"UInt":"Int")+" of length "+e.length+" is too large");return t?e.reduce((function(e,t){return e.shiftLeft(8).add(t)}),n.UZERO):e.reduce((function(e,t,r){return e.multiply(256).add(0===r&&128<=t?t-256:t)}),n.ZERO)},t.longToBuffer=function(t,r){return e.from(t.toBytesBE().slice(8-r))};for(var s=new Array(8),a=new Array(8),c=0;c<8;c++)s[c]={max:n.MAX_UNSIGNED_VALUE.shiftRightUnsigned(64-8*(c+1)),bytes:c+1},a[c]={min:n.MIN_VALUE.shiftRight(64-8*(c+1)),max:n.MAX_VALUE.shiftRight(64-8*(c+1)),bytes:c+1};var u=h(s),l=h(a);function f(e){return Math.ceil(e.toString(16).length/2)}function h(e){return e.filter((function(e){return e.bytes<=t.MAX_SAFE_BYTES})).map((function(e){return{min:e.min&&e.min.toNumber(),max:e.max.toNumber(),bytes:e.bytes}}))}t.getLongUIntBufferSize=function(e){for(var t=0;t<s.length;t++){var r=s[t];if(e.lessThanOrEqual(r.max))return r.bytes}throw new Error("unreachable")},t.getUIntBufferSize=function(e){for(var t=0;t<u.length;t++){var r=u[t];if(e<=r.max)return r.bytes}return f(n.fromNumber(e,!0))},t.getLongIntBufferSize=function(e){for(var t=0;t<a.length;t++){var r=a[t];if(e.greaterThanOrEqual(r.min)&&e.lessThanOrEqual(r.max))return r.bytes}throw new Error("unreachable")},t.getIntBufferSize=function(e){for(var t=0;t<l.length;t++){var r=l[t];if(e>=r.min&&e<=r.max)return r.bytes}return f(n.fromNumber(e,!1))}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(88);t.Reader=n.default;const i=r(91);t.Writer=i.default;const o=r(92);t.Predictor=o.default},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(2);t.MAX_SAFE_BYTES=6;const i=/^-?[0-9]+$/;function o(e){return n.isLong(e)}t.isInteger=function(e){return"number"==typeof e?isFinite(e)&&Math.floor(e)===e:"string"==typeof e?!!i.exec(e):n.isLong(e)},t.isLong=o,t.longFromValue=function(e,t){if("number"==typeof e){if(t&&e<0)throw new Error("UInt must be positive");return n.fromNumber(e,t)}if(o(e)){if(e.unsigned!==t)throw t?new Error("Expected unsigned Long"):new Error("Expected signed Long");return e}if(t&&"-"===e[0])throw new Error("UInt must be positive");return n.fromString(e,t)},t.bufferToLong=function(e,t){if(e.length>8)throw new Error((t?"UInt":"Int")+" of length "+e.length+" is too large");return t?e.reduce((e,t)=>e.shiftLeft(8).add(t),n.UZERO):e.reduce((e,t,r)=>e.multiply(256).add(0===r&&128<=t?t-256:t),n.ZERO)},t.longToBuffer=function(t,r){return e.from(t.toBytesBE().slice(8-r))};const s=new Array(8),a=new Array(8);for(let e=0;e<8;e++)s[e]={max:n.MAX_UNSIGNED_VALUE.shiftRightUnsigned(64-8*(e+1)),bytes:e+1},a[e]={min:n.MIN_VALUE.shiftRight(64-8*(e+1)),max:n.MAX_VALUE.shiftRight(64-8*(e+1)),bytes:e+1};const c=f(s),u=f(a);function l(e){return Math.ceil(e.toString(16).length/2)}function f(e){return e.filter(e=>e.bytes<=t.MAX_SAFE_BYTES).map(e=>({min:e.min&&e.min.toNumber(),max:e.max.toNumber(),bytes:e.bytes}))}t.getLongUIntBufferSize=function(e){for(let t=0;t<s.length;t++){const r=s[t];if(e.lessThanOrEqual(r.max))return r.bytes}throw new Error("unreachable")},t.getUIntBufferSize=function(e){for(let t=0;t<c.length;t++){const r=c[t];if(e<=r.max)return r.bytes}return l(n.fromNumber(e,!0))},t.getLongIntBufferSize=function(e){for(let t=0;t<a.length;t++){const r=a[t];if(e.greaterThanOrEqual(r.min)&&e.lessThanOrEqual(r.max))return r.bytes}throw new Error("unreachable")},t.getIntBufferSize=function(e){for(let t=0;t<u.length;t++){const r=u[t];if(e>=r.min&&e<=r.max)return r.bytes}return l(n.fromNumber(e,!1))}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(8),i=r(97),o=r(10),s=r(98);var a;t.Errors=s,function(e){e[e.TYPE_ILP_PREPARE=12]="TYPE_ILP_PREPARE",e[e.TYPE_ILP_FULFILL=13]="TYPE_ILP_FULFILL",e[e.TYPE_ILP_REJECT=14]="TYPE_ILP_REJECT"}(a=t.Type||(t.Type={})),t.errorToReject=(r,n)=>t.serializeIlpReject({code:n.ilpErrorCode||"F00",triggeredBy:r,message:n.message||"",data:n.ilpErrorData||e.alloc(0)}),t.deserializeEnvelope=e=>{const t=n.Reader.from(e);return{type:t.readUInt8Number(),contents:t.readVarOctetString()}},t.serializeIlpPrepare=t=>{o(t.amount&&"string"==typeof t.amount,"amount must be a string"),o(e.isBuffer(t.executionCondition)&&32===t.executionCondition.length,"executionCondition must be a 32-byte buffer"),o(t.expiresAt&&t.expiresAt instanceof Date,"expiresAt must be a Date"),o("string"==typeof t.destination,"destination is required"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=e.from(i.dateToInterledgerTime(t.expiresAt),"ascii"),s=e.from(t.destination,"ascii"),c=8+i.INTERLEDGER_TIME_LENGTH+32+n.Predictor.measureVarOctetString(s.length)+n.Predictor.measureVarOctetString(t.data.length),u=1+n.Predictor.measureVarOctetString(c),l=new n.Writer(u);l.writeUInt8(a.TYPE_ILP_PREPARE);const f=l.createVarOctetString(c);return f.writeUInt64(t.amount),f.write(r),f.write(t.executionCondition),f.writeVarOctetString(s),f.writeVarOctetString(t.data),l.getBuffer()},t.deserializeIlpPrepare=e=>{const{type:r,contents:o}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_PREPARE)throw new Error("Packet has incorrect type");const s=n.Reader.from(o),c=s.readUInt64(),u=i.interledgerTimeToDate(s.read(i.INTERLEDGER_TIME_LENGTH).toString("ascii"));return{amount:c,executionCondition:s.read(32),expiresAt:u,destination:s.readVarOctetString().toString("ascii"),data:s.readVarOctetString()}},t.serializeIlpFulfill=t=>{o(e.isBuffer(t.fulfillment)&&32===t.fulfillment.length,"fulfillment must be a 32-byte buffer"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=32+n.Predictor.measureVarOctetString(t.data.length),i=1+n.Predictor.measureVarOctetString(r),s=new n.Writer(i);s.writeUInt8(a.TYPE_ILP_FULFILL);const c=s.createVarOctetString(r);return c.write(t.fulfillment),c.writeVarOctetString(t.data),s.getBuffer()},t.deserializeIlpFulfill=e=>{const{type:r,contents:i}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_FULFILL)throw new Error("Packet has incorrect type");const o=n.Reader.from(i);return{fulfillment:o.read(32),data:o.readVarOctetString()}};const c=e.alloc(0);function u(t){return e.isBuffer(t.fulfillment)&&e.isBuffer(t.data)}t.serializeIlpReject=t=>{o(t.code&&"string"==typeof t.code,"code must be a string"),o("string"==typeof t.triggeredBy,"triggeredBy must be a string"),o("string"==typeof t.message,"message must be a string"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=e.from(t.code,"ascii");if(3!==r.length)throw new Error("ILP error codes must be three bytes long, received: "+t.code);const i=e.from(t.triggeredBy,"ascii"),s=e.from(t.message,"utf8"),u=t.data||c,l=3+n.Predictor.measureVarOctetString(i.length)+n.Predictor.measureVarOctetString(s.length)+n.Predictor.measureVarOctetString(u.length),f=1+n.Predictor.measureVarOctetString(l),h=new n.Writer(f);h.writeUInt8(a.TYPE_ILP_REJECT);const d=h.createVarOctetString(l);return d.write(r),d.writeVarOctetString(i),d.writeVarOctetString(s),d.writeVarOctetString(u),h.getBuffer()},t.deserializeIlpReject=e=>{const{type:r,contents:i}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_REJECT)throw new Error("Packet has incorrect type");const o=n.Reader.from(i);return{code:o.read(3).toString("ascii"),triggeredBy:o.readVarOctetString().toString("ascii"),message:o.readVarOctetString().toString("utf8"),data:o.readVarOctetString()}},t.serializeIlpPacket=e=>{switch(e.type){case a.TYPE_ILP_PREPARE:return t.serializeIlpPrepare(e.data);case a.TYPE_ILP_FULFILL:return t.serializeIlpFulfill(e.data);case a.TYPE_ILP_REJECT:return t.serializeIlpReject(e.data);default:throw new Error("Object has invalid type")}},t.deserializeIlpPacket=e=>{if(e[0]===a.TYPE_ILP_PREPARE)return{type:e[0],typeString:"ilp_prepare",data:t.deserializeIlpPrepare(e)};if(e[0]===a.TYPE_ILP_FULFILL)return{type:e[0],typeString:"ilp_fulfill",data:t.deserializeIlpFulfill(e)};if(e[0]===a.TYPE_ILP_REJECT)return{type:e[0],typeString:"ilp_reject",data:t.deserializeIlpReject(e)};throw new Error("Packet has invalid type")},t.deserializeIlpReply=function(e){return t.deserializeIlpPacket(e).data},t.serializeIlpReply=function(e){return u(e)?t.serializeIlpFulfill(e):t.serializeIlpReject(e)},t.errorToIlpReject=(t,r)=>({code:r.ilpErrorCode||"F00",triggeredBy:t,message:r.message||"",data:r.ilpErrorData||e.alloc(0)}),t.isPrepare=function(t){return"string"==typeof t.amount&&void 0!==t.expiresAt&&"string"==typeof t.destination&&e.isBuffer(t.executionCondition)&&e.isBuffer(t.data)},t.isFulfill=u,t.isReject=function(t){return"string"==typeof t.code&&"string"==typeof t.triggeredBy&&"string"==typeof t.message&&e.isBuffer(t.data)}}).call(this,r(0).Buffer)},function(e,t,r){(t=e.exports=r(40)).Stream=t,t.Readable=t,t.Writable=r(23),t.Duplex=r(6),t.Transform=r(44),t.PassThrough=r(106)},function(e,t,r){var n=r(0),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";(function(t,n,i){var o=r(14);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=w;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:o.nextTick;w.WritableState=y;var u=Object.create(r(11));u.inherits=r(9);var l={deprecate:r(104)},f=r(41),h=r(22).Buffer,d=i.Uint8Array||function(){};var p,g=r(42);function m(){}function y(e,t){a=a||r(6),e=e||{};var n=t instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(u||0===u)?u:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===e.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(o.nextTick(i,n),o.nextTick(I,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),I(e,t))}(e,r,n,t,i);else{var s=E(r);s||r.corked||r.bufferProcessing||!r.bufferedRequest||_(e,r),n?c(v,e,r,s,i):v(e,r,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function w(e){if(a=a||r(6),!(p.call(w,this)||this instanceof a))return new w(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),f.call(this)}function b(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function v(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),I(e,t)}function _(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,l=r.encoding,f=r.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,l,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),I(e,t)}))}function I(e,t){var r=E(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}u.inherits(w,f),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:l.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(w,Symbol.hasInstance,{value:function(e){return!!p.call(this,e)||this===w&&(e&&e._writableState instanceof y)}})):p=function(e){return e instanceof this},w.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},w.prototype.write=function(e,t,r){var n,i=this._writableState,s=!1,a=!i.objectMode&&(n=e,h.isBuffer(n)||n instanceof d);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=m),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),o.nextTick(t,r)}(this,r):(a||function(e,t,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(n,s),i=!1),i}(this,i,e,r))&&(i.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,a,n,i,o);return c}(this,i,a,e,t,r)),s},w.prototype.cork=function(){this._writableState.corked++},w.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},w.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),w.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},w.prototype._writev=null,w.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,I(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(w.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),w.prototype.destroy=g.destroy,w.prototype._undestroy=g.undestroy,w.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(1),r(13).setImmediate,r(4))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=r(15);function i(){["monetizationstart","monetizationstop","monetizationpending"].forEach((function(e){n.getDoc(document).monetization.addEventListener(e,(function(r){t.debug("WM EVENT: ",e,r.detail)}))}))}t.debug=localStorage.WM_DEBUG?e.log.bind(e,"oauth-scripts:"):function(){},t.logEvents=i,i()}).call(this,r(3))},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(26));t.asyncUtils=i;var o=r(54);t.MonetizationTagObserver=o.MonetizationTagObserver;var s=r(28);t.watchMouseMovement=s.watchMouseMovement,t.watchVisibility=s.watchVisibility;var a=r(27);t.whenDocumentReady=a.whenDocumentReady;var c=r(55);t.getSPSPResponse=c.getSPSPResponse,t.SPSPError=c.SPSPError;var u=r(30);t.portableFetch=u.portableFetch;var l=r(59);t.AdaptiveBandwidth=l.AdaptiveBandwidth;var f=r(28);t.watchPageEvents=f.watchPageEvents;var h=r(60);t.BackoffWaiter=h.BackoffWaiter;var d=r(61);t.resolvePaymentEndpoint=d.resolvePaymentEndpoint;var p=r(62);t.getFarFutureExpiry=p.getFarFutureExpiry;var g=r(63);t.parsePolicyDirectives=g.parsePolicyDirectives},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeout=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.onlyOnce=function(e){var t=!1;return function(){t||(t=!0,e())}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.whenDocumentReady=function(e,t){"interactive"===e.readyState||"complete"===e.readyState?t():e.addEventListener("readystatechange",(function(){"interactive"===e.readyState&&t()}),{once:!0})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function n(e){var t=e.pause,r=e.resume;"hidden"===document.visibilityState&&t();var n=function(){"visible"===document.visibilityState?r():t()};return document.addEventListener("visibilitychange",n),function(){document.removeEventListener("visibilitychange",n)}}function i(e){var t,r=e.pause,n=e.resume,i=!1,o=Date.now();function s(){var e=Date.now(),n=o+18e5-e;n>0?t=setTimeout(s,n):(i=!0,r())}t=setTimeout(s,18e5);var a=function(){o=Date.now(),i&&(i=!1,t=setTimeout(s,18e5),n())};return document.addEventListener("mousemove",a),function(){clearTimeout(t),document.removeEventListener("mousemove",a)}}t.watchVisibility=n,t.watchMouseMovement=i,t.watchPageEvents=function(){var e=[];return{clearWatch:function(){for(;"function"==typeof e[0];)e[0](),e.pop()},setWatch:function(t){e.push(n(t)),e.push(i(t))}}}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(31);t.portableFetch=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o(e,t)]}))}))}},function(e,t,r){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,t.default=n.fetch.bind(n),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},function(e,t,r){(function(e,n){var i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},o=/%[sdj%]/g;t.format=function(e){if(!w(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,s=String(e).replace(o,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),a=n[r];r<i;a=n[++r])m(a)||!_(a)?s+=" "+a:s+=" "+c(a);return s},t.deprecate=function(r,i){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,i).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?n.trace(i):n.error(i),o=!0}return r.apply(this,arguments)}};var s,a={};function c(e,r){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),g(r)?n.showHidden=r:r&&t._extend(n,r),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,e,n.depth)}function u(e,t){var r=c.styles[t];return r?"["+c.colors[r][0]+"m"+e+"["+c.colors[r][1]+"m":e}function l(e,t){return e}function f(e,r,n){if(e.customInspect&&r&&I(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return w(i)||(i=f(e,i,n)),i}var o=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(w(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(y(t))return e.stylize(""+t,"number");if(g(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,r);if(o)return o;var s=Object.keys(r),a=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),S(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(r);if(0===s.length){if(I(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(v(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return e.stylize(Date.prototype.toString.call(r),"date");if(S(r))return h(r)}var u,l="",_=!1,T=["{","}"];(p(r)&&(_=!0,T=["[","]"]),I(r))&&(l=" [Function"+(r.name?": "+r.name:"")+"]");return v(r)&&(l=" "+RegExp.prototype.toString.call(r)),E(r)&&(l=" "+Date.prototype.toUTCString.call(r)),S(r)&&(l=" "+h(r)),0!==s.length||_&&0!=r.length?n<0?v(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=_?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)O(t,String(s))?o.push(d(e,t,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(d(e,t,r,n,i,!0))})),o}(e,r,n,a,s):s.map((function(t){return d(e,r,n,a,t,_)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,l,T)):T[0]+l+T[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),O(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(r)?f(e,c.value,null):f(e,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),b(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function y(e){return"number"==typeof e}function w(e){return"string"==typeof e}function b(e){return void 0===e}function v(e){return _(e)&&"[object RegExp]"===T(e)}function _(e){return"object"==typeof e&&null!==e}function E(e){return _(e)&&"[object Date]"===T(e)}function S(e){return _(e)&&("[object Error]"===T(e)||e instanceof Error)}function I(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(b(s)&&(s=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(s)){var i=e.pid;a[r]=function(){var e=t.format.apply(t,arguments);n.error("%s %d: %s",r,i,e)}}else a[r]=function(){};return a[r]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=g,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=w,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=v,t.isObject=_,t.isDate=E,t.isError=S,t.isFunction=I,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(65);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),A[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){n.log("%s - %s",x(),t.format.apply(t,arguments))},t.inherits=r(66),t._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function k(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t;if("function"!=typeof(t=e[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=P,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return i.apply(o,arguments)};t.apply(this,r).then((function(t){e.nextTick(s,null,t)}),(function(t){e.nextTick(k,t,s)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,i(t)),r}}).call(this,r(1),r(3))},function(e,t,r){(function(n,i){var o;
/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */!function(s){var a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function c(){this._events={},this._conf&&u.call(this,this._conf)}function u(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=void 0!==e.maxListeners?e.maxListeners:10,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=10}function l(e,t){var r="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(r+=" Event name: "+t+"."),void 0!==n&&n.emitWarning){var o=new Error(r);o.name="MaxListenersExceededWarning",o.emitter=this,o.count=e,n.emitWarning(o)}else i.error(r),i.trace&&i.trace()}function f(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,u.call(this,e)}function h(e,t,r,n){if(!r)return[];var i,o,s,a,c,u,l,f=[],d=t.length,p=t[n],g=t[n+1];if(n===d&&r._listeners){if("function"==typeof r._listeners)return e&&e.push(r._listeners),[r];for(i=0,o=r._listeners.length;i<o;i++)e&&e.push(r._listeners[i]);return[r]}if("*"===p||"**"===p||r[p]){if("*"===p){for(s in r)"_listeners"!==s&&r.hasOwnProperty(s)&&(f=f.concat(h(e,t,r[s],n+1)));return f}if("**"===p){for(s in(l=n+1===d||n+2===d&&"*"===g)&&r._listeners&&(f=f.concat(h(e,t,r,d))),r)"_listeners"!==s&&r.hasOwnProperty(s)&&("*"===s||"**"===s?(r[s]._listeners&&!l&&(f=f.concat(h(e,t,r[s],d))),f=f.concat(h(e,t,r[s],n))):f=s===g?f.concat(h(e,t,r[s],n+2)):f.concat(h(e,t,r[s],n)));return f}f=f.concat(h(e,t,r[p],n+1))}if((a=r["*"])&&h(e,t,a,n+1),c=r["**"])if(n<d)for(s in c._listeners&&h(e,t,c,d),c)"_listeners"!==s&&c.hasOwnProperty(s)&&(s===g?h(e,t,c[s],n+2):s===p?h(e,t,c[s],n+1):((u={})[s]=c[s],h(e,t,{"**":u},n+1)));else c._listeners?h(e,t,c,d):c["*"]&&c["*"]._listeners&&h(e,t,c["*"],d);return f}function d(e,t){for(var r=0,n=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;r+1<n;r++)if("**"===e[r]&&"**"===e[r+1])return;for(var i=this.listenerTree,o=e.shift();void 0!==o;){if(i[o]||(i[o]={}),i=i[o],0===e.length)return i._listeners?("function"==typeof i._listeners&&(i._listeners=[i._listeners]),i._listeners.push(t),!i._listeners.warned&&this._maxListeners>0&&i._listeners.length>this._maxListeners&&(i._listeners.warned=!0,l.call(this,i._listeners.length,o))):i._listeners=t,!0;o=e.shift()}return!0}f.EventEmitter2=f,f.prototype.delimiter=".",f.prototype.setMaxListeners=function(e){void 0!==e&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},f.prototype.event="",f.prototype.once=function(e,t){return this._once(e,t,!1)},f.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},f.prototype._once=function(e,t,r){return this._many(e,1,t,r),this},f.prototype.many=function(e,t,r){return this._many(e,t,r,!1)},f.prototype.prependMany=function(e,t,r){return this._many(e,t,r,!0)},f.prototype._many=function(e,t,r,n){var i=this;if("function"!=typeof r)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&i.off(e,o),r.apply(this,arguments)}return o._origin=r,this._on(e,o,n),i},f.prototype.emit=function(){this._events||c.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,r,n,i,o,s=arguments.length;if(this._all&&this._all.length){if(o=this._all.slice(),s>3)for(t=new Array(s),i=0;i<s;i++)t[i]=arguments[i];for(n=0,r=o.length;n<r;n++)switch(this.event=e,s){case 1:o[n].call(this,e);break;case 2:o[n].call(this,e,arguments[1]);break;case 3:o[n].call(this,e,arguments[1],arguments[2]);break;default:o[n].apply(this,t)}}if(this.wildcard){o=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,o,a,this.listenerTree,0)}else{if("function"==typeof(o=this._events[e])){switch(this.event=e,s){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(s-1),i=1;i<s;i++)t[i-1]=arguments[i];o.apply(this,t)}return!0}o&&(o=o.slice())}if(o&&o.length){if(s>3)for(t=new Array(s-1),i=1;i<s;i++)t[i-1]=arguments[i];for(n=0,r=o.length;n<r;n++)switch(this.event=e,s){case 1:o[n].call(this);break;case 2:o[n].call(this,arguments[1]);break;case 3:o[n].call(this,arguments[1],arguments[2]);break;default:o[n].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},f.prototype.emitAsync=function(){this._events||c.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,r,n,i,o,s=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),i=1;i<a;i++)t[i]=arguments[i];for(n=0,r=this._all.length;n<r;n++)switch(this.event=e,a){case 1:s.push(this._all[n].call(this,e));break;case 2:s.push(this._all[n].call(this,e,arguments[1]));break;case 3:s.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:s.push(this._all[n].apply(this,t))}}if(this.wildcard){o=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,o,u,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o)switch(this.event=e,a){case 1:s.push(o.call(this));break;case 2:s.push(o.call(this,arguments[1]));break;case 3:s.push(o.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];s.push(o.apply(this,t))}else if(o&&o.length){if(o=o.slice(),a>3)for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];for(n=0,r=o.length;n<r;n++)switch(this.event=e,a){case 1:s.push(o[n].call(this));break;case 2:s.push(o[n].call(this,arguments[1]));break;case 3:s.push(o[n].call(this,arguments[1],arguments[2]));break;default:s.push(o[n].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(s)},f.prototype.on=function(e,t){return this._on(e,t,!1)},f.prototype.prependListener=function(e,t){return this._on(e,t,!0)},f.prototype.onAny=function(e){return this._onAny(e,!1)},f.prototype.prependAny=function(e){return this._onAny(e,!0)},f.prototype.addListener=f.prototype.on,f.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},f.prototype._on=function(e,t,r){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||c.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(d.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),r?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,l.call(this,this._events[e].length,e))):this._events[e]=t,this)},f.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,n=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();n=h.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],n.push({_listeners:r})}for(var o=0;o<n.length;o++){var s=n[o];if(r=s._listeners,a(r)){for(var c=-1,u=0,l=r.length;u<l;u++)if(r[u]===t||r[u].listener&&r[u].listener===t||r[u]._origin&&r[u]._origin===t){c=u;break}if(c<0)continue;return this.wildcard?s._listeners.splice(c,1):this._events[e].splice(c,1),0===r.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(void 0!==t){var r=Object.keys(t);for(var n in r){var i=r[n],o=t[i];o instanceof Function||"object"!=typeof o||null===o||(Object.keys(o).length>0&&e(t[i]),0===Object.keys(o).length&&delete t[i])}}}(this.listenerTree),this},f.prototype.offAny=function(e){var t,r=0,n=0;if(e&&this._all&&this._all.length>0){for(r=0,n=(t=this._all).length;r<n;r++)if(e===t[r])return t.splice(r,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(r=0,n=t.length;r<n;r++)this.emit("removeListenerAny",t[r]);this._all=[]}return this},f.prototype.removeListener=f.prototype.off,f.prototype.removeAllListeners=function(e){if(void 0===e)return!this._events||c.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),r=h.call(this,null,t,this.listenerTree,0),n=0;n<r.length;n++){r[n]._listeners=null}else this._events&&(this._events[e]=null);return this},f.prototype.listeners=function(e){if(this.wildcard){var t=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return h.call(this,t,r,this.listenerTree,0),t}return this._events||c.call(this),this._events[e]||(this._events[e]=[]),a(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},f.prototype.eventNames=function(){return Object.keys(this._events)},f.prototype.listenerCount=function(e){return this.listeners(e).length},f.prototype.listenersAny=function(){return this._all?this._all:[]},void 0===(o=function(){return f}.call(t,r,t,e))||(e.exports=o)}()}).call(this,r(1),r(3))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(8),i=r(84);var o;!function(e){e[e.TYPE_RESPONSE=1]="TYPE_RESPONSE",e[e.TYPE_ERROR=2]="TYPE_ERROR",e[e.TYPE_MESSAGE=6]="TYPE_MESSAGE",e[e.TYPE_TRANSFER=7]="TYPE_TRANSFER"}(o=t.Type||(t.Type={})),t.TYPE_RESPONSE=o.TYPE_RESPONSE,t.TYPE_ERROR=o.TYPE_ERROR,t.TYPE_MESSAGE=o.TYPE_MESSAGE,t.TYPE_TRANSFER=o.TYPE_TRANSFER,t.MIME_APPLICATION_OCTET_STREAM=0,t.MIME_TEXT_PLAIN_UTF8=1,t.MIME_APPLICATION_JSON=2,t.typeToString=function(e){switch(e){case o.TYPE_RESPONSE:return"TYPE_RESPONSE";case o.TYPE_ERROR:return"TYPE_ERROR";case o.TYPE_MESSAGE:return"TYPE_MESSAGE";case o.TYPE_TRANSFER:return"TYPE_TRANSFER";default:throw new Error("Unrecognized BTP packet type")}};const s=/^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2}\.[0-9]{3}Z)$/,a={};function c(t){for(const r of t)a[r]=e.from(r,"ascii")}function u(t,r){if(!Array.isArray(r))throw new Error("protocolData must be an array");const n=r.length,i=Math.max(1,Math.ceil(Math.log(r.length+1)/Math.log(2)/8));t.writeUInt8(i),t.writeUInt(n,i);for(const n of r)t.writeVarOctetString(a[n.protocolName]||e.from(n.protocolName,"ascii")),t.writeUInt8(n.contentType),t.writeVarOctetString(n.data)}function l(e){const t=e.readUInt8Number(),r=e.readUIntNumber(t),n=[];for(let t=0;t<r;++t){const t=e.readVarOctetString().toString("ascii"),r=e.readUInt8Number(),i=e.readVarOctetString();n.push({protocolName:t,contentType:r,data:i})}return n}function f(t,r){if(3!==r.code.length)throw new Error(`error code must be 3 characters, got: "${r.code}"`);const n=e.from(r.code,"ascii"),o=e.from(r.name,"ascii"),s=(a=r.triggeredAt,e.from(i(a,"UTC:yyyymmddHHMMss.l'Z'")));var a;const c=e.from(r.data,"utf8");t.write(n),t.writeVarOctetString(o),t.writeVarOctetString(s),t.writeVarOctetString(c),u(t,r.protocolData)}function h(e,t){switch(t.type){case o.TYPE_RESPONSE:case o.TYPE_MESSAGE:u(e,t.data.protocolData);break;case o.TYPE_TRANSFER:!function(e,t){e.writeUInt64(t.amount),u(e,t.protocolData)}(e,t.data);break;case o.TYPE_ERROR:f(e,t.data);break;default:throw new Error("Unrecognized type")}}function d(e){const t=new n.Predictor;h(t,e);const r=5+n.Predictor.measureVarOctetString(t.length),i=new n.Writer(r);return i.writeUInt8(e.type),i.writeUInt32(e.requestId),h(i.createVarOctetString(t.length),e),i.getBuffer()}function p(e){return{code:e.read(3).toString("ascii"),name:e.readVarOctetString().toString("ascii"),triggeredAt:function(e){const t=e.readVarOctetString().toString().replace(s,"$1-$2-$3T$4:$5:$6");return new Date(t)}(e),data:e.readVarOctetString().toString("utf8"),protocolData:l(e)}}c(["ilp","auth","auth_username","auth_token","channel","channel_signature","claim","fund_channel","info","last_claim"]),t.registerProtocolNames=c,t.base64url=function(e){return e.toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},t.serialize=d,t.deserialize=function(e){const t=n.Reader.from(e),r=t.readUInt8Number(),i=t.readUInt32Number(),s=t.readVarOctetString(),a=new n.Reader(s);let c;switch(r){case o.TYPE_RESPONSE:case o.TYPE_MESSAGE:c={protocolData:l(a)};break;case o.TYPE_TRANSFER:c=function(e){return{amount:e.readUInt64(),protocolData:l(e)}}(a);break;case o.TYPE_ERROR:c=p(a);break;default:throw new Error("Unrecognized type")}return{type:r,requestId:i,data:c}},t.serializeResponse=(e,t)=>d({type:o.TYPE_RESPONSE,requestId:e,data:{protocolData:t}}),t.serializeError=(e,t,r)=>{let n;const{code:i,name:s,triggeredAt:a,data:c}=e;return n={code:i,name:s,triggeredAt:a,data:c,protocolData:r},d({type:o.TYPE_ERROR,requestId:t,data:n})},t.serializeMessage=(e,t)=>d({type:o.TYPE_MESSAGE,requestId:e,data:{protocolData:t}}),t.serializeTransfer=(e,t,r)=>{const{amount:n}=e;return d({type:o.TYPE_TRANSFER,requestId:t,data:{amount:n,protocolData:r}})}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){void 0===t&&(t="");var r=e.call(this)||this;return Object.defineProperty(r,"message",{configurable:!0,enumerable:!1,value:t}),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:r.constructor.name}),Error.captureStackTrace&&Error.captureStackTrace(r,r.constructor),r}return i(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e=""){super(),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:e}),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name}),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}t.default=n},function(e,t,r){"use strict";class n extends Error{constructor(e){super(),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:void 0!==e?String(e):""}),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name}),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}e.exports=n},function(e,t,r){"use strict";(function(e,n){var i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=r(7),s=r(5),a=r(39),c=r(20),u=r(45),l=r(113),f=r(8),h=r(114),d=r(12),p=r(2),g=r(115),m=r(116);class y extends Error{constructor(e,t){super(e),this.streamErrorCode=t||l.ErrorCode.InternalError}}var w;function b(){return new Date(Date.now()+3e4)}t.ConnectionError=y,function(e){e[e.Init=0]="Init",e[e.Connected=1]="Connected",e[e.Closed=2]="Closed"}(w||(w={}));class v extends o.EventEmitter{constructor(e){if(super(),this.remoteState=w.Init,this.connectionId=m.v4(),this.plugin=e.plugin,this._sourceAccount=e.sourceAccount,this._sourceAssetCode=e.assetCode,this._sourceAssetScale=e.assetScale,this._destinationAccount=e.destinationAccount,this.sharedSecret=e.sharedSecret,this.isServer=e.isServer,this._pskKey=e.pskKey,this._fulfillmentKey=e.fulfillmentKey,this.slippage=g.default.fromNumber(void 0===e.slippage?.01:e.slippage,!0),this.slippage.greaterThanOne())throw new Error("slippage must be less than one");this.allowableReceiveExtra=g.default.fromNumber(1.01,!0),this.enablePadding=!!e.enablePadding,this.connectionTag=e.connectionTag,this.maxStreamId=2*(e.maxRemoteStreams||10),this.maxBufferedData=e.connectionBufferSize||65534,this.minExchangeRatePrecision=e.minExchangeRatePrecision||3,this.exchangeRate=void 0===e.exchangeRate?void 0:g.default.fromNumber(e.exchangeRate,!0),this.getExpiry=e.getExpiry||b,this.idleTimeout=e.idleTimeout||6e4,this.lastActive=new Date,this.nextPacketSequence=1,this.streams=new Map,this.closedStreams=new Set,this.nextStreamId=this.isServer?2:1,this.log=s.default(`ilp-protocol-stream:${this.isServer?"Server":"Client"}:Connection:${this.connectionId}`),this.sending=!1,this.connected=!1,this.closed=!0,this.queuedFrames=[],this.congestion=new h.CongestionController({maximumPacketAmount:void 0===e.maximumPacketAmount?void 0:p.fromString(e.maximumPacketAmount,!0)}),this.retryDelay=100,this.remoteKnowsOurAccount=this.isServer,this.remoteMaxStreamId=20,this.remoteMaxOffset=this.maxBufferedData,this._totalReceived=p.UZERO,this._totalSent=p.UZERO,this._totalDelivered=p.UZERO,this._lastPacketExchangeRate=g.default.UZERO}static build(e){return i(this,void 0,void 0,(function*(){const t=yield u.generatePskEncryptionKey(e.sharedSecret),r=yield u.generateFulfillmentKey(e.sharedSecret);return new v(Object.assign({pskKey:t,fulfillmentKey:r},e))}))}connect(){return i(this,void 0,void 0,(function*(){if(!this.closed)return Promise.resolve();this.startSendLoop(),yield new Promise((e,t)=>{const r=()=>{s(),e()},n=()=>{s(),t(new Error("Connection was closed before it was connected"))},i=e=>{s(),t(new Error("Error connecting"+(e?": "+e.message:"")))};this.once("connect",r),this.once("error",i),this.once("close",n),this.once("end",n);const o=this;function s(){clearTimeout(o.idleTimer),o.removeListener("connect",r),o.removeListener("error",i),o.removeListener("close",n),o.removeListener("end",n)}}),this.closed=!1,this.startIdleTimer()}))}end(){return i(this,void 0,void 0,(function*(){this.log.info("closing connection");let e=[];for(let[t,r]of this.streams)r.isOpen()&&(e.push(new Promise((e,t)=>{r.on("end",e)})),r.end());yield new Promise((e,t)=>{this.once("_send_loop_finished",e),this.once("error",t),this.startSendLoop()}),yield Promise.all(e),this.closed=!0,yield this.sendConnectionClose(),this.safeEmit("end"),this.safeEmit("close"),clearTimeout(this.idleTimer)}))}destroy(e){return i(this,void 0,void 0,(function*(){this.log.error("destroying connection with error:",e),e&&this.safeEmit("error",e);let t=[];for(let[e,r]of this.streams)t.push(new Promise((e,t)=>{r.on("close",e)})),r.destroy();yield this.sendConnectionClose(e||new y("Connection destroyed",l.ErrorCode.ApplicationError)),yield Promise.all(t),this.safeEmit("close"),clearTimeout(this.idleTimer)}))}createStream(){if(this.remoteMaxStreamId<this.nextStreamId)throw this.log.debug("cannot create another stream. nextStreamId: %d, remote maxStreamId: %d",this.nextStreamId,this.remoteMaxStreamId),this.queuedFrames.push(new l.ConnectionStreamIdBlockedFrame(this.nextStreamId)),new Error("Creating another stream would exceed the remote connection's maximum number of open streams");const e=new a.DataAndMoneyStream({id:this.nextStreamId,isServer:this.isServer,connectionId:this.connectionId});return this.streams.set(this.nextStreamId,e),this.log.debug("created stream: %d",this.nextStreamId),this.nextStreamId+=2,e.on("_maybe_start_send_loop",this.startSendLoop.bind(this)),e.once("close",()=>this.removeStreamRecord(e)),e}get destinationAccount(){return this._destinationAccount}get destinationAssetScale(){return this._destinationAssetScale}get destinationAssetCode(){return this._destinationAssetCode}get sourceAccount(){return this._sourceAccount}get sourceAssetScale(){return this._sourceAssetScale}get sourceAssetCode(){return this._sourceAssetCode}get minimumAcceptableExchangeRate(){if(this.exchangeRate){return this.exchangeRate.multiplyByRational(this.slippage.complement()).toString()}return"0"}get lastPacketExchangeRate(){return this._lastPacketExchangeRate.toString()}get totalDelivered(){return this._totalDelivered.toString()}get totalSent(){return this._totalSent.toString()}get totalReceived(){return this._totalReceived.toString()}handlePrepare(e){return i(this,void 0,void 0,(function*(){let t;try{t=yield l.Packet.decryptAndDeserialize(this._pskKey,e.data)}catch(e){throw this.log.error("error parsing frames:",e),new c.Errors.UnexpectedPaymentError("")}if(this.log.trace("handling packet:",JSON.stringify(t)),t.ilpPacketType.valueOf()!==c.Type.TYPE_ILP_PREPARE)throw this.log.error("prepare packet contains a frame that says it should be something other than a prepare: %d",t.ilpPacketType),new c.Errors.UnexpectedPaymentError("");this.bumpIdle();let r=[];r.push(new l.ConnectionMaxDataFrame(this.getIncomingOffsets().maxAcceptable));const n=()=>i(this,void 0,void 0,(function*(){r=r.concat(this.queuedFrames),this.queuedFrames=[];const n=new l.Packet(t.sequence,l.IlpPacketType.Reject,e.amount,r);throw this.log.trace("rejecting packet %s: %j",t.sequence,n),new c.Errors.FinalApplicationError("",yield n.serializeAndEncrypt(this._pskKey,this.enablePadding?32767:void 0))}));for(let e of t.frames)if(e.type===l.FrameType.StreamMoney||e.type===l.FrameType.StreamData||e.type===l.FrameType.StreamMaxMoney||e.type===l.FrameType.StreamMaxData){const t=e.streamId.toNumber();if(this.closedStreams.has(t)){if(this.log.trace("got packet with frame for stream %d, which was already closed",t),e.type!==l.FrameType.StreamMoney&&e.type!==l.FrameType.StreamData)continue;const i=e=>e.type===l.FrameType.StreamClose&&e.streamId.equals(t);r.find(i)||this.queuedFrames.find(i)||r.push(new l.StreamCloseFrame(t,l.ErrorCode.StreamStateError,"Stream is already closed")),yield n()}try{this.handleNewStream(e.streamId.toNumber())}catch(t){this.log.debug("error handling new stream %s: %s",e.streamId,t&&t.message),yield n()}}try{this.handleControlFrames(t.frames)}catch(e){this.log.debug("error handling frames:",e&&e.message),yield n()}const o=this.getIncomingOffsets();o.max>o.maxAcceptable&&(this.destroy(new y(`Exceeded flow control limits. Max connection byte offset: ${o.maxAcceptable}, received: ${o.max}`,l.ErrorCode.FlowControlError)),yield n());const s=p.fromString(e.amount,!0);t.prepareAmount.greaterThan(s)&&(this.log.debug("received less than minimum destination amount. actual: %s, expected: %s",e.amount,t.prepareAmount),yield n());const a=yield u.generateFulfillment(this._fulfillmentKey,e.data),f=yield u.hash(a);f.equals(e.executionCondition)||(this.log.debug("got unfulfillable prepare for amount: %s. generated condition: %h, prepare condition: %h",e.amount,f,e.executionCondition),yield n());const h=[],g=t.frames.reduce((e,t)=>{if(t instanceof l.StreamMoneyFrame){const r=d.checkedAdd(e,t.shares);if(r.overflow)throw new Error("Total shares exceeded MaxUint64");return r.sum}return e},p.UZERO);for(let e of t.frames){if(!(e instanceof l.StreamMoneyFrame))continue;const t=e.streamId.toNumber(),i=d.multiplyDivideFloor(s,e.shares,g),o=this.streams.get(t);h.push({stream:o,amount:i});const a=this.allowableReceiveExtra.multiplyByLongCeil(o._getAmountStreamCanReceive());a.lessThan(i)&&(this.log.debug("peer sent too much for stream: %d. got: %s, max receivable: %s",t,i,a),r.push(new l.StreamMaxMoneyFrame(t,o.receiveMax,o.totalReceived)),yield n()),o.isOpen()||(this.log.debug("peer sent money for stream that was already closed: %d",t),r.push(new l.StreamCloseFrame(t,l.ErrorCode.StreamStateError,"Stream is already closed")),yield n())}for(let{stream:e,amount:t}of h)e._addToIncoming(t);if(!this.closed&&this.remoteState!==w.Closed)for(let[e,t]of this.streams)t.isOpen()||t._remoteClosed?(this.log.trace("telling other side that stream %d can receive %s",t.id,t.receiveMax),r.push(new l.StreamMaxMoneyFrame(t.id,t.receiveMax,t.totalReceived)),r.push(new l.StreamMaxDataFrame(t.id,t._getIncomingOffsets().maxAcceptable))):(this.log.trace("telling other side that stream %d is closed",t.id),t._errorMessage?r.push(new l.StreamCloseFrame(t.id,l.ErrorCode.ApplicationError,t._errorMessage)):r.push(new l.StreamCloseFrame(t.id,l.ErrorCode.NoError,"")),t._remoteClosed=!0);r=r.concat(this.queuedFrames),this.queuedFrames=[];const m=new l.Packet(t.sequence,l.IlpPacketType.Fulfill,s,r);return this.addTotalReceived(s),this.log.trace("fulfilling prepare with fulfillment: %h and response packet: %j",a,m),{fulfillment:a,data:yield m.serializeAndEncrypt(this._pskKey,this.enablePadding?32767:void 0)}}))}handleControlFrames(e){for(let t of e){let e;switch(t.type){case l.FrameType.ConnectionNewAddress:this.log.trace("peer notified us of their account: %s",t.sourceAccount);const r=void 0===this._destinationAccount;this._destinationAccount=t.sourceAccount,r&&this.handleConnect();break;case l.FrameType.ConnectionAssetDetails:this.log.trace("peer notified us of their asset details: code=%s, scale=%d",t.sourceAssetCode,t.sourceAssetScale),this._destinationAssetCode=t.sourceAssetCode,this._destinationAssetScale=t.sourceAssetScale;break;case l.FrameType.ConnectionClose:this.sending=!1,this.closed=!0,this.remoteState=w.Closed,t.errorCode===l.ErrorCode.NoError?(this.log.info("remote closed connection"),this.end()):(this.log.error("remote connection error. code: %s, message: %s",l.ErrorCode[t.errorCode],t.errorMessage),this.destroy(new Error(`Remote connection error. Code: ${l.ErrorCode[t.errorCode]}, message: ${t.errorMessage}`)));break;case l.FrameType.ConnectionMaxData:const n=this.getOutgoingOffsets();this.log.trace("remote connection max byte offset is: %s, we've sent: %d, we want to send up to: %d",t.maxOffset,n.currentOffset,n.maxOffset),t.maxOffset.notEquals(this.maxBufferedData)?this.remoteMaxOffset=Math.max(t.maxOffset.toNumber(),this.remoteMaxOffset):this.remoteMaxOffset=t.maxOffset.toNumber();break;case l.FrameType.ConnectionDataBlocked:this.log.trace("remote wants to send more data but we are blocking them. current max incoming offset: %d, remote max offset: %s",this.getIncomingOffsets(),t.maxOffset);break;case l.FrameType.ConnectionMaxStreamId:this.log.trace("remote set max stream id to %s",t.maxStreamId),this.remoteMaxStreamId=t.maxStreamId.toNumber();break;case l.FrameType.ConnectionStreamIdBlocked:this.log.trace("remote wants to open more streams but we are blocking them");break;case l.FrameType.StreamClose:this.handleStreamClose(t);break;case l.FrameType.StreamMaxMoney:if(this.log.trace("peer told us that stream %s can receive up to: %s and has received: %s so far",t.streamId,t.receiveMax,t.totalReceived),e=this.streams.get(t.streamId.toNumber()),!e)break;e._remoteReceived=d.maxLong(e._remoteReceived,t.totalReceived),e._remoteReceiveMax.notEquals(p.MAX_UNSIGNED_VALUE)?e._remoteReceiveMax=d.maxLong(e._remoteReceiveMax,t.receiveMax):e._remoteReceiveMax=t.receiveMax,e._remoteReceiveMax.greaterThan(e._remoteReceived)&&e._getAmountAvailableToSend().greaterThan(0)&&this.startSendLoop();break;case l.FrameType.StreamMoneyBlocked:this.log.debug("peer told us that they want to send more money on stream %s but we are blocking them. they have sent: %s so far and want to send: %s",t.streamId,t.totalSent,t.sendMax);break;case l.FrameType.StreamData:if(this.log.trace("got data for stream %s",t.streamId),e=this.streams.get(t.streamId.toNumber()),!e)break;e._pushIncomingData(t.data,t.offset.toNumber());const i=e._getIncomingOffsets();i.max>i.maxAcceptable&&this.destroy(new y(`Exceeded flow control limits. Stream ${e.id} can accept up to offset: ${i.maxAcceptable} but got bytes up to offset: ${i.max}`,l.ErrorCode.FlowControlError));break;case l.FrameType.StreamMaxData:if(e=this.streams.get(t.streamId.toNumber()),!e)break;const o=e._remoteMaxOffset,s=t.maxOffset.toNumber();s>o?(this.log.trace("peer told us that stream %s can receive up to byte offset: %s (we've sent up to offset: %d)",t.streamId,t.maxOffset,e._getOutgoingOffsets().current),e._remoteMaxOffset=s,this.startSendLoop()):this.log.trace("peer told us that stream %s can receive up to byte offset: %d; ignoring new offset: %d",t.streamId,o,s);break;case l.FrameType.StreamDataBlocked:if(e=this.streams.get(t.streamId.toNumber()),!e)break;this.log.debug("peer told us that stream %s is blocked. they want to send up to offset: %s, but we are only allowing up to: %d",t.streamId,t.maxOffset,e._getIncomingOffsets().maxAcceptable);break;default:continue}}}handleConnect(){this.closed=!1,this.log.info("connected"),this.safeEmit("connect"),this.queuedFrames.push(new l.ConnectionMaxStreamIdFrame(this.maxStreamId),new l.ConnectionAssetDetailsFrame(this.sourceAssetCode,this.sourceAssetScale))}handleNewStream(e){if(this.streams.has(e)||this.closedStreams.has(e))return;if(this.isServer&&e%2==0){this.log.error("got invalid stream ID %d from peer (should be odd)",e),this.queuedFrames.push(new l.ConnectionCloseFrame(l.ErrorCode.ProtocolViolation,`Invalid Stream ID: ${e}. Client-initiated streams must have odd-numbered IDs`));const t=new Error(`Invalid Stream ID: ${e}. Client-initiated streams must have odd-numbered IDs`);throw this.safeEmit("error",t),t}if(!this.isServer&&e%2==1){this.log.error("got invalid stream ID %d from peer (should be even)",e),this.queuedFrames.push(new l.ConnectionCloseFrame(l.ErrorCode.ProtocolViolation,`Invalid Stream ID: ${e}. Server-initiated streams must have even-numbered IDs`));const t=new Error(`Invalid Stream ID: ${e}. Server-initiated streams must have even-numbered IDs`);throw this.safeEmit("error",t),t}if(e>this.maxStreamId){this.log.debug("peer opened too many streams. got stream: %d, but max stream id is: %d. closing connection",e,this.maxStreamId),this.queuedFrames.push(new l.ConnectionCloseFrame(l.ErrorCode.StreamIdError,`Maximum number of open streams exceeded. Got stream: ${e}, current max stream ID: ${this.maxStreamId}`));const t=new Error(`Maximum number of open streams exceeded. Got stream: ${e}, current max stream ID: ${this.maxStreamId}`);throw this.safeEmit("error",t),t}.75*this.maxStreamId<e&&(this.log.trace("informing peer that our max stream id is: %d",this.maxStreamId),this.queuedFrames.push(new l.ConnectionMaxStreamIdFrame(this.maxStreamId))),this.log.info("got new stream: %d",e);const t=new a.DataAndMoneyStream({id:e,isServer:this.isServer,connectionId:this.connectionId});this.streams.set(e,t),t.on("_maybe_start_send_loop",()=>this.startSendLoop()),t.once("close",()=>this.removeStreamRecord(t)),this.safeEmit("stream",t)}handleStreamClose(e){const t=e.streamId.toNumber(),r=this.streams.get(t);if(!r)return void this.log.error("remote error on stream %d, but we don't have a record of that stream",t);if(!r.isOpen()||r._remoteSentEnd)return;let n;this.log.error("peer closed stream %d with error code: %s and message: %s",r.id,l.ErrorCode[e.errorCode],e.errorMessage),r._sentEnd=!0,e.errorMessage&&(n=new Error(e.errorMessage),n.name=l.ErrorCode[e.errorCode]),r._remoteEnded(n),this.maxStreamId+=2,this.log.trace("raising maxStreamId to %d",this.maxStreamId),this.queuedFrames.push(new l.ConnectionMaxStreamIdFrame(this.maxStreamId)),this.startSendLoop()}startSendLoop(){return i(this,void 0,void 0,(function*(){if(!this.sending){if(this.remoteState===w.Closed)return this.log.debug("remote connection is already closed, not starting another loop"),void this.safeEmit("_send_loop_finished");if(this._destinationAccount){this.sending=!0,this.log.debug("starting send loop");try{for(;this.sending;)this.connected?yield this.loadAndSendPacket():(yield this.setupExchangeRate(),this.connected=!0)}catch(e){return this.destroy(e)}this.log.debug("finished sending"),this.safeEmit("_send_loop_finished");for(let[e,t]of this.streams)t.emit("_send_loop_finished")}else this.log.debug("not sending because we do not know the client's address")}}))}loadAndSendPacket(){return i(this,void 0,void 0,(function*(){yield new Promise((t,r)=>e(t)),this.log.trace("loadAndSendPacket");let t=p.UZERO;const r=new l.Packet(this.getNextPacketSequence(),l.IlpPacketType.Prepare,void 0,this.queuedFrames);this.queuedFrames=[],this.maybePushAccountFrames(r);for(let[e,t]of this.streams)t.isOpen()&&(r.frames.push(new l.StreamMaxMoneyFrame(t.id,t.receiveMax,t.totalReceived)),r.frames.push(new l.StreamMaxDataFrame(t.id,t._getIncomingOffsets().maxAcceptable)));this.closed&&this.remoteState===w.Connected&&(this.log.trace("sending connection close frame"),r.frames.push(new l.ConnectionCloseFrame(l.ErrorCode.NoError,"")),this.remoteState=w.Closed);let n=this.congestion.testMaximumPacketAmount;this.exchangeRate.greaterThanOne()&&(n=d.minLong(n,this.exchangeRate.reciprocal().multiplyByLong(p.MAX_UNSIGNED_VALUE)));const i=[];for(let[e,o]of this.streams){if(o._sentEnd)continue;let e=d.minLong(o._getAmountAvailableToSend(),n);const s=d.checkedSubtract(o._remoteReceiveMax,o._remoteReceived).difference,a=this.exchangeRate.reciprocal().multiplyByLongCeil(s);a.lessThan(e)&&(this.log.trace("stream %d could send %s but that would be more than the receiver says they can receive, so we'll send %s instead",o.id,e,a),e=a),this.log.trace("amount to send from stream %d: %s, exchange rate: %s, remote total received: %s, remote receive max: %s",o.id,e,this.exchangeRate,o._remoteReceived,o._remoteReceiveMax),e.greaterThan(0)&&(o._holdOutgoing(r.sequence.toString(),e),r.frames.push(new l.StreamMoneyFrame(o.id,e)),t=t.add(e),n=n.subtract(e),i.push(o));const c=p.fromString(o.sendMax,!0).subtract(o.totalSent).subtract(e);if(this.exchangeRate.multiplyByLong(c).greaterThan(d.checkedSubtract(o._remoteReceiveMax,o._remoteReceived).difference)&&r.frames.push(new l.StreamMoneyBlockedFrame(o.id,o.sendMax,o.totalSent)),n.equals(0))break}let o=32767-r.byteLength();const s=this.remoteMaxOffset-this.getOutgoingOffsets().currentOffset;if(o>s){const e=this.getOutgoingOffsets().maxOffset;this.log.debug("peer is blocking us from sending more data. they will only accept up to offset: %d, but we want to send up to: %d",this.remoteMaxOffset,e),r.frames.push(new l.ConnectionDataBlockedFrame(e)),o=s}for(let[e,t]of this.streams){if(o-20<=0)break;const{data:e,offset:n}=t._getAvailableDataToSend(o-20);if(e&&e.length>0){const i=new l.StreamDataFrame(t.id,n,e);this.log.trace("sending %d bytes from stream %d",e.length,t.id),o-=i.byteLength(),r.frames.push(i)}const i=t._isDataBlocked();i&&(this.log.trace("telling remote that stream %d is blocked and has more data to send",t.id),r.frames.push(new l.StreamDataBlockedFrame(t.id,i)))}if(t.equals(0)){if(0===r.frames.length)return void(this.sending=!1);r.frames.find(e=>e.type===l.FrameType.StreamClose||e.type===l.FrameType.StreamData||e.type===l.FrameType.StreamMoney)||(this.sending=!1)}const a=this.slippage.complement().multiplyByLong(this.exchangeRate.multiplyByLong(t));a.greaterThan(0)&&(r.prepareAmount=a);const c=yield this.sendPacket(r,t,!1);if(c&&(this.remoteState===w.Init&&(this.remoteState=w.Connected),this.remoteKnowsOurAccount=!0,this.handleControlFrames(c.frames),t.greaterThan(0)&&(this._lastPacketExchangeRate=new g.default(c.prepareAmount,t,!0)),c.ilpPacketType===l.IlpPacketType.Fulfill)){for(let e of i)e._executeHold(r.sequence.toString());this.addTotalDelivered(c.prepareAmount),this.addTotalSent(t),this.congestion.onFulfill(t),this.retryDelay=100}}))}sendTestPacketVolley(e){return i(this,void 0,void 0,(function*(){const t=yield Promise.all(e.map(e=>i(this,void 0,void 0,(function*(){try{return this.sendTestPacket(p.fromNumber(e,!0))}catch(t){return this.log.error("Error sending test packet for amount %d: %s",e,t),null}})))),r=e.map((r,n)=>{if(t[n]&&"F08"===t[n].code)try{const i=f.Reader.from(t[n].data),o=i.readUInt64Long(),s=i.readUInt64Long(),a=d.multiplyDivideFloor(p.fromNumber(r,!0),s,o);return this.log.debug("sending test packet of %d resulted in F08 error that told us maximum packet amount is %s",e[n],a),a}catch(e){return p.MAX_UNSIGNED_VALUE}return p.MAX_UNSIGNED_VALUE}),{maxDigits:n,exchangeRate:o,packetErrors:s}=t.reduce(({maxDigits:t,exchangeRate:r,packetErrors:n},i,o)=>{const s=e[o];if(i&&i.code&&n.push({sourceAmount:s,code:i.code}),i&&i.prepareAmount){const e=i.prepareAmount,r=new g.default(e,p.fromNumber(s,!0),!0);if(this.log.debug("sending test packet of %d delivered %s (exchange rate: %s)",s,e,r),d.countDigits(e)>=t)return{maxDigits:d.countDigits(e),exchangeRate:r,packetErrors:n}}return{maxDigits:t,exchangeRate:r,packetErrors:n}},{maxDigits:0,exchangeRate:g.default.UZERO,packetErrors:[]});return{maxDigits:n,exchangeRate:o,maxPacketAmounts:r,packetErrors:s}}))}setupExchangeRate(){return i(this,void 0,void 0,(function*(){this.exchangeRate||(this.log.trace("determining exchange rate"),yield this.determineExchangeRate()),n.nextTick(()=>{this.safeEmit("connect"),this.log.trace("connected")})}))}determineExchangeRate(){return i(this,void 0,void 0,(function*(){if(this.log.trace("determineExchangeRate"),!this._destinationAccount)throw new Error("Cannot determine exchange rate. Destination account is unknown");let e=100,t=[1,1e3,1e6,1e9,1e12],r=0;for(;!this.exchangeRate&&t.length>0&&r<20;){r++;const{maxDigits:n,exchangeRate:i,maxPacketAmounts:o,packetErrors:s}=yield this.sendTestPacketVolley(t);if(this.congestion.setMaximumAmounts(d.minLongs(o.concat(this.congestion.maximumPacketAmount))),this.congestion.maximumPacketAmount.equals(0))throw this.log.error("cannot send anything through this path. the maximum packet amount is 0"),new Error("Cannot send. Path has a Maximum Packet Amount of 0");if(n>=this.minExchangeRatePrecision)return this.log.debug("determined exchange rate to be %s with %d digits precision",i,n),void(this.exchangeRate=i);if(t=o.filter(e=>!e.equals(p.MAX_UNSIGNED_VALUE)).reduce((e,t)=>[...new Set([...e,t.toString()])],[]),s.some(e=>"T"===e.code[0])){const r=s.reduce((e,t)=>d.minLong(e,p.fromNumber(t.sourceAmount,!0)),p.MAX_UNSIGNED_VALUE),n=r.subtract(r.divide(3));this.log.debug("got Txx error(s), waiting %dms and reducing packet amount to %s before sending another test packet",e,n),t=[...t,n],yield new Promise((t,r)=>setTimeout(t,e)),e*=1.5}this.log.debug("retry with packet amounts %j",t)}throw new Error(`Unable to establish connection, no packets meeting the minimum exchange precision of ${this.minExchangeRatePrecision} digits made it through the path.`)}))}sendTestPacket(e,t=3e4){return i(this,void 0,void 0,(function*(){const r=new l.Packet(this.getNextPacketSequence(),l.IlpPacketType.Prepare);this.log.trace("sending test packet %s for amount: %s. timeout: %d",r.sequence,e,t),this.maybePushAccountFrames(r);const n={destination:this._destinationAccount,amount:e.toString(),data:yield r.serializeAndEncrypt(this._pskKey),executionCondition:u.generateRandomCondition(),expiresAt:this.getExpiry(this._destinationAccount)},o=yield new Promise((e,o)=>i(this,void 0,void 0,(function*(){const i=setTimeout(()=>{this.log.error("test packet %s timed out before we got a response",r.sequence),e(null)},t),o=yield this.plugin.sendData(c.serializeIlpPrepare(n));clearTimeout(i),e(o)})));if(!o)return null;this.bumpIdle();const s=c.deserializeIlpReject(o);let a;if("F99"===s.code&&s.data.length>0){if(a=yield l.Packet.decryptAndDeserialize(this._pskKey,s.data),!a.sequence.equals(r.sequence))throw this.log.error("response packet sequence does not match the request packet. expected sequence: %s, got response packet: %j",r.sequence,a),new Error(`Response packet sequence does not correspond to the request. Actual: ${a.sequence}, expected: ${r.sequence}`);if(a.ilpPacketType!==o[0])throw this.log.error("response packet was on wrong ILP packet type. expected ILP packet type: %d, got: %j",o[0],a),new Error(`Response says it should be on an ILP packet of type: ${a.ilpPacketType} but it was carried on an ILP packet of type: ${o[0]}`)}else this.log.debug("test packet %s was rejected with a %s triggered by %s error%s",r.sequence,s.code,s.triggeredBy,s.message?' with the message: "'+s.message+'"':"");return a?(this.remoteKnowsOurAccount=!0,this.handleControlFrames(a.frames),a):s}))}sendConnectionClose(e){return i(this,void 0,void 0,(function*(){if(this.remoteState===w.Closed)return void this.log.debug("not sending connection error because remote is already closed");let t,r;e&&e instanceof y?(t=e.streamErrorCode,r=e.message):e?(t=l.ErrorCode.InternalError,r=e.message):(t=l.ErrorCode.NoError,r="");const n=new l.Packet(this.nextPacketSequence++,l.IlpPacketType.Prepare,0,[new l.ConnectionCloseFrame(t,r)]);try{const e={destination:this._destinationAccount,amount:"0",data:yield n.serializeAndEncrypt(this._pskKey),executionCondition:u.generateRandomCondition(),expiresAt:this.getExpiry(this._destinationAccount)};yield this.plugin.sendData(c.serializeIlpPrepare(e))}catch(e){this.log.error("error while trying to inform peer that connection is closing, but closing anyway",e)}this.remoteState=w.Closed}))}sendPacket(e,t,r=!1){return i(this,void 0,void 0,(function*(){this.log.trace("sending packet %s with source amount: %s: %j",e.sequence,t,e);const n=yield e.serializeAndEncrypt(this._pskKey,this.enablePadding?32767:void 0);let i,o;r?(i=void 0,o=u.generateRandomCondition()):(i=yield u.generateFulfillment(this._fulfillmentKey,n),o=yield u.hash(i));const s={destination:this._destinationAccount,amount:t.toString(),data:n,executionCondition:o,expiresAt:this.getExpiry(this._destinationAccount)},a=yield this.plugin.sendData(c.serializeIlpPrepare(s));let f,h;this.bumpIdle();try{if(a[0]===c.Type.TYPE_ILP_FULFILL)f=c.deserializeIlpFulfill(a);else{if(a[0]!==c.Type.TYPE_ILP_REJECT)throw new Error("Invalid response packet type: "+a[0]);f=c.deserializeIlpReject(a)}}catch(t){throw this.log.error("got invalid response from sending packet %s: %s %h",e.sequence,t,a),new Error(`Invalid response when sending packet ${e.sequence}: ${t.message}`)}if(i&&function(e){return e.hasOwnProperty("fulfillment")}(f)){if(!(yield u.hash(f.fulfillment)).equals(o))throw this.log.error("got invalid fulfillment for packet %s: %h. expected: %h for condition: %h",e.sequence,f.fulfillment,i,o),new Error(`Got invalid fulfillment for packet ${e.sequence}. Actual: ${f.fulfillment.toString("hex")}, expected: ${i.toString("hex")}`)}else if(f=f,this.undoRejectedPacket(e),"F99"!==f.code)return this.handleConnectorError(f,t);if(0!==f.data.length){try{h=yield l.Packet.decryptAndDeserialize(this._pskKey,f.data)}catch(e){throw this.log.error("unable to decrypt and parse response data: %s %h",e),new Error("Unable to decrypt and parse response data: "+e.message)}if(!h.sequence.equals(e.sequence))throw this.log.error("response packet sequence does not match the request packet. expected sequence: %s, got response packet: %j",e.sequence,h),new Error(`Response packet sequence does not correspond to the request. Actual: ${h.sequence}, expected: ${e.sequence}`);if(h.ilpPacketType!==a[0])throw this.log.error("response packet was on wrong ILP packet type. expected ILP packet type: %d, got: %j",a[0],h),new Error(`Response says it should be on an ILP packet of type: ${h.ilpPacketType} but it was carried on an ILP packet of type: ${a[0]}`);return this.log.debug("got response to packet: %s: %j",e.sequence,h),h}}))}undoRejectedPacket(e){this.log.debug("packet %s was rejected",e.sequence);for(let t of e.frames)switch(t.type){case l.FrameType.StreamMoney:const r=this.streams.get(t.streamId.toNumber());r&&r._cancelHold(e.sequence.toString());break;case l.FrameType.StreamData:const n=this.streams.get(t.streamId.toNumber());n&&n._resendOutgoingData(t.data,t.offset.toNumber());break;case l.FrameType.StreamClose:this.queuedFrames.push(t);break;default:continue}}handleConnectorError(e,t){return i(this,void 0,void 0,(function*(){if(this.log.debug("handling reject triggered by: %s error: %s message: %s data: %h",e.triggeredBy,e.code,e.message,e.data),"F08"===e.code){if(this.congestion.onAmountTooLargeError(e,t).equals(0))throw this.log.error("cannot send anything through this path. the maximum packet amount is 0"),new Error("Cannot send. Path has a Maximum Packet Amount of 0")}else{if("T"!==e.code[0]){this.log.error("unexpected error. code: %s, triggered by: %s, message: %s, data: %h",e.code,e.triggeredBy,e.message,e.data);const t=new Error(`Unexpected error while sending packet. Code: ${e.code}, triggered by: ${e.triggeredBy}, message: ${e.message}`);throw t.ilpReject=e,t}{"T04"===e.code&&this.congestion.onInsufficientLiquidityError(e,t),this.log.warn("got %s temporary error triggered by: %s. waiting %dms before trying again",e.code,e.triggeredBy,this.retryDelay);const r=this.retryDelay;this.retryDelay=Math.min(2*this.retryDelay,432e5),yield new Promise((e,t)=>setTimeout(e,r))}}}))}safeEmit(e,...t){try{t.unshift(e),this.emit.apply(this,t)}catch(t){this.log.debug("error in %s handler: %s",e,t)}}getOutgoingOffsets(){let e=0,t=0;for(let[r,n]of this.streams){const r=n._getOutgoingOffsets();e+=r.current,t+=r.max}return{currentOffset:e,maxOffset:t}}getIncomingOffsets(){let e=0,t=0,r=0;for(let[n,i]of this.streams){const{max:n,current:o}=i._getIncomingOffsets();e+=n,t+=o,r+=i.readableLength}return{current:t,max:e,maxAcceptable:t-r+this.maxBufferedData}}removeStreamRecord(t){if(this.log.debug("removing record of stream %d",t.id),this.streams.delete(t.id),this.closedStreams.add(t.id),!t._sentEnd){t._sentEnd=!0;const r=t._errorMessage?new l.StreamCloseFrame(t.id,l.ErrorCode.ApplicationError,t._errorMessage):new l.StreamCloseFrame(t.id,l.ErrorCode.NoError,"");this.queuedFrames.push(r),e(()=>this.startSendLoop())}}startIdleTimer(){if(0===this.idleTimeout)return;const e=Date.now()-this.lastActive.getTime();this.idleTimer=setTimeout(()=>this.testIdle(),this.idleTimeout-e),"function"==typeof this.idleTimer.unref&&this.idleTimer.unref(),this.log.trace("(re)starting idle timeout for %dms from now",this.idleTimeout)}testIdle(){Date.now()-this.lastActive.getTime()>=this.idleTimeout?(this.log.error("Connection timed out due to inactivity, destroying connection"),this.destroy(new Error("Connection timed out due to inactivity"))):this.startIdleTimer()}bumpIdle(){this.lastActive=new Date}addTotalReceived(e){const t=d.checkedAdd(this._totalReceived,e);if(t.overflow){const e=new c.Errors.BadRequestError("Total received exceeded MaxUint64");throw e.ilpErrorMessage=e.message,this.destroy(e),e}this._totalReceived=t.sum}addTotalSent(e){const t=d.checkedAdd(this._totalSent,e);if(t.overflow){const e=new c.Errors.BadRequestError("Total sent exceeded MaxUint64");throw e.ilpErrorMessage=e.message,this.destroy(e),e}this._totalSent=t.sum}addTotalDelivered(e){const t=d.checkedAdd(this._totalDelivered,e);if(t.overflow){const e=new c.Errors.BadRequestError("Total delivered exceeded MaxUint64");throw e.ilpErrorMessage=e.message,this.destroy(e),e}this._totalDelivered=t.sum}getNextPacketSequence(){const e=this.nextPacketSequence++;if(e>=Math.pow(2,31))throw new y("Connection exceeded maximum number of packets",l.ErrorCode.InternalError);return e}maybePushAccountFrames(e){this.remoteKnowsOurAccount||(e.frames.push(new l.ConnectionNewAddressFrame(this._sourceAccount)),e.frames.push(new l.ConnectionAssetDetailsFrame(this._sourceAssetCode,this._sourceAssetScale)))}}t.Connection=v}).call(this,r(13).setImmediate,r(1))},function(e,t,r){"use strict";(function(e,n){var i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=r(5),s=r(2),a=r(100),c=r(111),u=r(112),l=r(12),f=s.MAX_UNSIGNED_VALUE;class h extends a.Duplex{constructor(e){super({allowHalfOpen:!1}),this.id=e.id,this.isServer=e.isServer,this.log=o.default(`ilp-protocol-stream:${this.isServer?"Server":"Client"}:Connection:${e.connectionId}:Stream:${this.id}`),this.log.info("new stream created"),this._totalSent=s.UZERO,this._totalReceived=s.UZERO,this._sendMax=s.UZERO,this._receiveMax=s.UZERO,this._outgoingHeldAmount=s.UZERO,this._sentEnd=!1,this._remoteSentEnd=!1,this.closed=!1,this.holds={},this._incomingData=new u.OffsetSorter,this._outgoingData=new c.DataQueue,this._outgoingDataToRetry=[],this.outgoingOffset=0,this._remoteClosed=!1,this._remoteReceived=s.UZERO,this._remoteReceiveMax=f,this._remoteMaxOffset=16384,this.emittedEnd=!1,this.emittedClose=!1,this.once("end",()=>{this.emittedEnd=!0}),this.once("close",()=>{this.emittedClose=!0})}get totalSent(){return this._totalSent.toString()}get totalReceived(){return this._totalReceived.toString()}get sendMax(){return this._sendMax.toString()}get receiveMax(){return this._receiveMax.toString()}get readableLength(){return(super.readableLength||this._readableState&&this._readableState.length||0)+this._incomingData.byteLength()}get writableLength(){return super.writableLength||this._writableState&&this._writableState.length||0}get readableHighWaterMark(){return"number"==typeof super.readableHighWaterMark?super.readableHighWaterMark:this._readableState.highWaterMark}get writableHighWaterMark(){return"number"==typeof super.writableHighWaterMark?super.writableHighWaterMark:this._writableState.highWaterMark}isOpen(){return!this.closed}setSendMax(e){if(this.closed)throw new Error("Stream already closed");if("number"==typeof e&&!isFinite(e))throw new Error("sendMax must be finite");const t=l.longFromValue(e,!0);if(this._totalSent.greaterThan(t))throw this.log.debug("cannot set sendMax to %s because we have already sent: %s",t,this._totalSent),new Error("Cannot set sendMax lower than the totalSent");this.log.debug("setting sendMax to %s",t),this._sendMax=t,this.emit("_maybe_start_send_loop")}setReceiveMax(e){if(this.closed)throw new Error("Stream already closed");const t=l.longFromValue(e,!0);if(this._totalReceived.greaterThan(t))throw this.log.debug("cannot set receiveMax to %s because we have already received: %s",t,this._totalReceived),new Error("Cannot set receiveMax lower than the totalReceived");if(this._receiveMax.greaterThan(t))throw this.log.debug("cannot set receiveMax to %s because the current limit is: %s",t,this._receiveMax),new Error("Cannot decrease the receiveMax");this.log.debug("setting receiveMax to %s",t),this._receiveMax=t,this.emit("_maybe_start_send_loop")}sendTotal(t,r){return i(this,void 0,void 0,(function*(){const n=l.longFromValue(t,!0),i=r&&r.timeout||6e4;if(this._totalSent.greaterThanOrEqual(n))return this.log.debug("already sent %s, not sending any more",this._totalSent),Promise.resolve();this.setSendMax(n),yield new Promise((t,r)=>{const o=this;function s(){o._totalSent.greaterThanOrEqual(n)&&(l(),t())}function a(){e(l),o._totalSent.greaterThanOrEqual(n)?t():(o.log.debug("Stream was closed before the desired amount was sent (target: %s, totalSent: %s)",n,o._totalSent),r(new Error(`Stream was closed before the desired amount was sent (target: ${n}, totalSent: ${o._totalSent})`)))}function c(e){o.log.debug("error waiting for stream to stabilize:",e),l(),r(new Error(`Stream encountered an error before the desired amount was sent (target: ${n}, totalSent: ${o._totalSent}): ${e}`))}const u=setTimeout(()=>{l(),r(new Error(`Timed out before the desired amount was sent (target: ${n}, totalSent: ${o._totalSent})`))},i);function l(){clearTimeout(u),o.removeListener("outgoing_money",s),o.removeListener("error",c),o.removeListener("end",a)}this.on("outgoing_money",s),this.on("error",c),this.on("end",a)})}))}receiveTotal(t,r){return i(this,void 0,void 0,(function*(){const n=l.longFromValue(t,!0),i=r&&r.timeout||6e4;if(this._totalReceived.greaterThanOrEqual(n))return this.log.debug("already received %s, not waiting for more",this._totalReceived),Promise.resolve();this.setReceiveMax(n),yield new Promise((t,r)=>{const o=this;function s(){o._totalReceived.greaterThanOrEqual(n)&&(l(),t())}function a(){e(l),o._totalReceived.greaterThanOrEqual(n)?t():(o.log.debug("Stream was closed before the desired amount was received (target: %s, totalReceived: %s)",n,o._totalReceived),r(new Error(`Stream was closed before the desired amount was received (target: ${n}, totalReceived: ${o._totalReceived})`)))}function c(e){o.log.debug("error waiting for stream to stabilize:",e),l(),r(new Error(`Stream encountered an error before the desired amount was received (target: ${n}, totalReceived: ${o._totalReceived}): ${e}`))}const u=setTimeout(()=>{l(),r(new Error(`Timed out before the desired amount was received (target: ${n}, totalReceived: ${o._totalReceived})`))},i);function l(){clearTimeout(u),o.removeListener("money",s),o.removeListener("error",c),o.removeListener("end",a)}this.on("money",s),this.on("error",c),this.on("end",a)})}))}_getAmountStreamCanReceive(){return this._receiveMax.lessThan(this._totalReceived)?s.UZERO:l.checkedSubtract(this._receiveMax,this._totalReceived).difference}_addToIncoming(e){this._totalReceived=l.checkedAdd(this._totalReceived,e).sum,this.log.trace("received %s (totalReceived: %s)",e,this._totalReceived),this.emit("money",e.toString())}_getAmountAvailableToSend(){if(this.closed)return s.UZERO;return l.checkedSubtract(l.checkedSubtract(this._sendMax,this._totalSent).difference,this._outgoingHeldAmount).difference}_holdOutgoing(e,t){const r=this._getAmountAvailableToSend(),n=t?l.minLong(r,t):r;return n.greaterThan(0)&&(this._outgoingHeldAmount=this._outgoingHeldAmount.add(n),this.holds[e]=n,this.log.trace("holding outgoing balance. holdId: %s, amount: %s",e,n)),n}_executeHold(e){if(!this.holds[e])return;const t=this.holds[e];this._outgoingHeldAmount=this._outgoingHeldAmount.subtract(t),this._totalSent=this._totalSent.add(t),delete this.holds[e],this.log.trace("executed holdId: %s for: %s",e,t),this.emit("outgoing_money",t.toString()),this._totalSent.greaterThanOrEqual(this._sendMax)&&(this.log.debug("outgoing total sent"),this.emit("outgoing_total_sent"))}_cancelHold(e){if(!this.holds[e])return;const t=this.holds[e];this.log.trace("cancelled holdId: %s for: %s",e,t),this._outgoingHeldAmount=this._outgoingHeldAmount.subtract(t),delete this.holds[e]}_final(t){this.log.info("stream is closing");const r=r=>{r&&this.log.debug("error waiting for money to be sent:",r),this.log.info("stream ended"),this.closed=!0,e(()=>{this.emittedEnd||(this.emittedEnd=!0,this.safeEmit("end")),this.emittedClose||(this.emittedClose=!0,this.safeEmit("close"))}),t(r)};this._remoteSentEnd||this._sendMax.lessThanOrEqual(this._totalSent)?r():(this.log.info("waiting to finish sending money before ending stream"),new Promise((e,t)=>{this.once("outgoing_total_sent",e),this.once("_send_loop_finished",e),this.once("error",e=>t(e))}).then(()=>r()).catch(r))}_destroy(t,r){this.log.error("destroying stream because of error:",t),this.closed=!0,t&&(this._errorMessage=t.message),e(()=>{this.emittedEnd||(this.emittedEnd=!0,this.safeEmit("end")),this.emittedClose||(this.emittedClose=!0,this.safeEmit("close"))}),r(t)}_write(e,t,r){this.log.trace("%d bytes written to the outgoing data queue",e.length),this._outgoingData.push(e,r),this.emit("_maybe_start_send_loop")}_writev(e,t){for(let r=0;r<e.length;r++){const n=e[r];this.log.trace("%d bytes written to the outgoing data queue",n.chunk.length),r===e.length-1?this._outgoingData.push(n.chunk,t):this._outgoingData.push(n.chunk)}this.emit("_maybe_start_send_loop")}_read(e){const t=this._incomingData.read();t?(this.push(t),t.length<e&&this._read(e-t.length)):!0!==this.readableFlowing&&n.nextTick(()=>this.emit("_maybe_start_send_loop"))}_hasDataToSend(){return!this._outgoingData.isEmpty()||this._outgoingDataToRetry.length>0}_getAvailableDataToSend(e){if(this._outgoingDataToRetry.length>0){const t=this._outgoingDataToRetry[0];if(t.data.length>e){const r=t.data.slice(0,e),n=t.offset;return t.data=t.data.slice(e),t.offset=t.offset+e,{data:r,offset:n}}return this._outgoingDataToRetry.shift()}const t=Math.min(e,this._remoteMaxOffset-this.outgoingOffset),r=this.outgoingOffset,n=this._outgoingData.read(t);return n&&n.length>0&&(this.outgoingOffset+=n.length,this.log.trace("%d bytes taken from the outgoing data queue",n.length)),{data:n,offset:r}}_resendOutgoingData(e,t){this.log.trace("re-queuing %d bytes of data starting at offset %d",e.length,t),this._outgoingDataToRetry.push({data:e,offset:t})}_isDataBlocked(){if(this._remoteMaxOffset<this.outgoingOffset+this._outgoingData.byteLength())return this.outgoingOffset+this._outgoingData.byteLength()}_getOutgoingOffsets(){return{current:this.outgoingOffset,max:this.outgoingOffset+this._outgoingData.byteLength()}}_getIncomingOffsets(){return{max:this._incomingData.maxOffset,current:this._incomingData.readOffset,maxAcceptable:this._incomingData.readOffset+this.readableHighWaterMark-this.readableLength}}_pushIncomingData(e,t){this._incomingData.push(e,t),this._read(this.readableHighWaterMark-this.readableLength)}_remoteEnded(e){this.log.info("remote closed stream"),this._remoteSentEnd=!0,this._remoteClosed=!0,e?this.destroy(e):(this.push(null),this.end())}safeEmit(e,...t){try{t.unshift(e),this.emit.apply(this,t)}catch(t){this.log.debug("error in %s handler: %s",e,t)}}}t.DataAndMoneyStream=h}).call(this,r(13).setImmediate,r(1))},function(e,t,r){"use strict";(function(t,n){var i=r(14);e.exports=b;var o,s=r(29);b.ReadableState=w;r(7).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=r(41),u=r(22).Buffer,l=t.Uint8Array||function(){};var f=Object.create(r(11));f.inherits=r(9);var h=r(101),d=void 0;d=h&&h.debuglog?h.debuglog("stream"):function(){};var p,g=r(102),m=r(42);f.inherits(b,c);var y=["error","close","destroy","pause","resume"];function w(e,t){e=e||{};var n=t instanceof(o=o||r(6));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=r(43).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(o=o||r(6),!(this instanceof b))return new b(e);this._readableState=new w(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function v(e,t,r,n,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,S(e)}(e,s)):(i||(o=function(e,t){var r;n=t,u.isBuffer(n)||n instanceof l||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?_(e,s,t,!1):T(e,s)):_(e,s,t,!1))):n||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function _(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&S(e)),T(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),v(this,e,t,!1,r)},b.prototype.unshift=function(e){return v(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=r(43).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(I,e):I(e))}function I(e){d("emit readable"),e.emit("readable"),O(e)}function T(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){d("readable nexttick read 0"),e.read(0)}function x(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function P(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=u.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function k(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}b.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?k(this):S(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&k(this),null;var n,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(r,t))),null===(n=e>0?P(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&k(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,d("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:b;function u(t,n){d("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,d("cleanup"),e.removeListener("close",y),e.removeListener("finish",w),e.removeListener("drain",f),e.removeListener("error",m),e.removeListener("unpipe",u),r.removeListener("end",l),r.removeListener("end",b),r.removeListener("data",g),h=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||f())}function l(){d("onend"),e.end()}o.endEmitted?i.nextTick(c):r.once("end",c),e.on("unpipe",u);var f=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,O(e))}}(r);e.on("drain",f);var h=!1;var p=!1;function g(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==M(o.pipes,e))&&!h&&(d("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,p=!0),r.pause())}function m(t){d("onerror",t),b(),e.removeListener("error",m),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",w),b()}function w(){d("onfinish"),e.removeListener("close",y),b()}function b(){d("unpipe"),r.unpipe(e)}return r.on("data",g),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",m),e.once("close",y),e.once("finish",w),e.emit("pipe",r),o.flowing||(d("pipe resume"),r.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=M(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},b.prototype.on=function(e,t){var r=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&S(this):i.nextTick(A,this))}return r},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(x,e,t))}(this,e)),this},b.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(d("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(d("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<y.length;o++)e.on(y[o],this.emit.bind(this,y[o]));return this._read=function(t){d("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=P}).call(this,r(4),r(1))},function(e,t,r){e.exports=r(7).EventEmitter},function(e,t,r){"use strict";var n=r(14);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){"use strict";var n=r(105).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=f,t=3;break;default:return this.write=h,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";e.exports=s;var n=r(6),i=Object.create(r(11));function o(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,r){c(e,t,r)})):c(this,null,null)}function c(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(9),i.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(46);var i=r(46);t.decrypt=i.decrypt,t.encrypt=i.encrypt,t.generateSharedSecretFromToken=i.generateSharedSecretFromToken,t.hash=i.hash,t.randomBytes=i.randomBytes;const o=e.from("ilp_stream_encryption","utf8"),s=e.from("ilp_stream_fulfillment","utf8");t.ENCRYPTION_OVERHEAD=28,t.generateToken=function(){return n.randomBytes(18)},t.generateRandomCondition=function(){return n.randomBytes(32)},t.generatePskEncryptionKey=function(e){return n.hmac(e,o)},t.generateFulfillmentKey=function(e){return n.hmac(e,s)},t.generateFulfillment=function(e,t){return n.hmac(e,t)}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const{crypto:n}=window;class i{constructor(){this.cache=new Map}cleanup(){const e=Date.now();for(const[t,r]of this.cache)e-r.accessTime>3e4&&this.cache.delete(t)}importKey(e,t,i){return r(this,void 0,void 0,(function*(){const r=this.cache.get(e);if(r)return r.accessTime=Date.now(),r.keyObject;const o=yield n.subtle.importKey("raw",e,t,!1,i);return this.cache.set(e,{keyObject:o,accessTime:Date.now()}),o}))}}const o=new i,s=new i;setInterval(()=>{o.cleanup(),s.cleanup()},3e4),t.hash=function(t){return r(this,void 0,void 0,(function*(){const r=yield n.subtle.digest({name:"SHA-256"},t);return e.from(r)}))},t.encrypt=function(t,...i){return r(this,void 0,void 0,(function*(){const r=c(12),o=yield s.importKey(t,"AES-GCM",["encrypt","decrypt"]),a=yield n.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},o,e.concat(i)),u=a.byteLength-16,l=a.slice(u),f=a.slice(0,u);return e.concat([e.from(r),e.from(l),e.from(f)])}))},t.decrypt=function(t,i){return r(this,void 0,void 0,(function*(){const r=i.slice(0,12),o=i.slice(12,28),a=i.slice(28),c=yield s.importKey(t,"AES-GCM",["encrypt","decrypt"]),u=yield n.subtle.decrypt({name:"AES-GCM",iv:r},c,e.concat([a,o]));return e.from(u)}))};const a={name:"HMAC",hash:{name:"SHA-256"}};function c(t){const r=new Uint8Array(t),i=n.getRandomValues(r);return e.from(i)}t.hmac=function(t,i){return r(this,void 0,void 0,(function*(){const r=yield o.importKey(t,a,["sign","verify"]),s=yield n.subtle.sign("HMAC",r,i);return e.from(s)}))},t.randomBytes=c,t.generateSharedSecretFromToken=function(e,t){throw new Error("unreachable in browser")}}).call(this,r(0).Buffer)},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,r){e.exports=r(50)},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(51)),o=r(53);r(15).getDoc().coilMonetizationPolyfill=i.default()(o.MonetizationPolyfill)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(52),i=function(e){let t;if(e instanceof Map)t=t=>e.get(t);else if("object"==typeof e)t=t=>e[t.name];else if("function"==typeof e)t=e;else{if(void 0!==e)throw new TypeError("Parent injector must be a Map, object or function");t=()=>{}}const r=new Map,i=new Map;let o=new Set,s=[];const a=e=>{if("function"!=typeof e)throw new TypeError("Dependencies must be constructors/factories, but got: "+typeof e);if(o.has(e)){const t=n.convertSetToArray(o);t.push(e);const r=t.map(n.printPrettyConstructor).join(" => ");throw new Error("Circular dependency detected: "+r)}const c=r.get(e);if(c)return c;o.add(e);const u=t(e)||(e=>new(i.get(e)||e)(a))(e);if(o.delete(e),r.set(e,u),s.length){o.add(n.printPrettyConstructor(e)+" (post)");const t=s;s=[],t.forEach(e=>e())}return u};return a.setOverride=(e,t)=>{i.set(e,t)},a.later=e=>s.push(e),a};i.default=i,i.util=n,t.default=i,e.exports=i},function(e,t,r){"use strict";function n(e){return"function"==typeof e&&/^\s*class\s+/.test(e.toString())}Object.defineProperty(t,"__esModule",{value:!0}),t.convertSetToArray=function(e){const t=[];for(let r of e)t.push(r);return t},t.isClass=n,t.printPrettyConstructor=function(e){return"string"==typeof e?e:e.name||(n(e)?"[anonymous class]":"[anonymous fn]")}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(25),a=r(64),c=r(15),u=r(24);!function(e){e[e.STOPPED=0]="STOPPED",e[e.STARTED=1]="STARTED"}(o=t.InitState||(t.InitState={}));var l=function(){function e(e){this.state=o.STOPPED,u.debug("MonetizationPolyfill constructor!"),this.stream=e(a.Stream)}return e.prototype.init=function(e){var t=this;if(this.state===o.STARTED)throw new Error("coil monetization polyfill has already been initialized");if(!c.getDoc().monetization)throw new Error("document.monetization must be set outside of this script");if(!c.getDoc().monetizationExtensionInstalled){this.state=o.STARTED,this.refreshBtpToken(e.btpToken),this.btpEndpoint=e.btpEndpoint;var r={pause:function(){return t.stream.pause()},resume:function(){var e='meta[name="monetization"]';if(!document.head.querySelector(e))throw new Error('invalid_state: no "'+e+'" found');t.stream.start({paymentPointer:t.paymentPointer,requestId:t.requestId,pageUrl:window.location.href,btpToken:t.btpToken,btpEndpoint:t.btpEndpoint,spspEndpoint:t.resolvedEndpoint})}},a=s.watchPageEvents(),l=a.clearWatch,f=a.setWatch;new s.MonetizationTagObserver(window,document,(function(e){var o=e.started,a=e.stopped;return n(t,void 0,void 0,(function(){return i(this,(function(e){return u.debug({started:o,stopped:a}),a&&(l(),this.stream.stop()),o&&(this.resolvedEndpoint=s.resolvePaymentEndpoint(o.paymentPointer),f(r),this.requestId=o.requestId,this.paymentPointer=o.paymentPointer,r.resume()),[2]}))}))})).startWhenDocumentReady()}},e.prototype.refreshBtpToken=function(e){if(null==e)throw new Error("btpToken is null, is the user subscribed?");this.btpToken=e,this.stream.refreshBtpToken(e)},e}();t.MonetizationPolyfill=l},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(124),s=r(27),a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]};!function(e){e[e.PAGE_LOAD=0]="PAGE_LOAD",e[e.META_ADDED_CHANGED=1]="META_ADDED_CHANGED"}(i=t.IDGenerationStrategy||(t.IDGenerationStrategy={}));var c=function(){function e(e,t,r,n,s){void 0===n&&(n=1),void 0===s&&(s=i.META_ADDED_CHANGED),this.window=e,this.document=t,this.callback=r,this.maxMetas=n,this.idGenerationStrategy=s,this.pageLoadId=o.v4(),this.head=null,this.metaTags=new Map,this.headObserver=new MutationObserver(this.onHeadChildListObserved.bind(this))}return e.prototype.startWhenDocumentReady=function(){s.whenDocumentReady(this.document,this.start.bind(this))},e.prototype.start=function(){this.head=this.document.head,this.head.querySelectorAll('meta[name="monetization"]').forEach(this.onAddedMeta.bind(this)),this.headObserver.observe(this.head,{childList:!0})},e.prototype.onHeadChildListObserved=function(e){var t,r,i,o,s=this;a("head mutation records.length=",e.length);var c=function(e,t){a("head node",e,t),t instanceof HTMLMetaElement&&"monetization"===t.name&&("added"===e?s.onAddedMeta(t):"removed"===e&&s.onRemovedMeta(t))};try{for(var u=n(e),l=u.next();!l.done;l=u.next()){var f=l.value;a("Record",f.type,f.target),"childList"===f.type&&f.removedNodes.forEach(c.bind(null,"removed"))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}try{for(var h=n(e),d=h.next();!d.done;d=h.next()){f=d.value;a("Record",f.type,f.target),"childList"===f.type&&f.addedNodes.forEach(c.bind(null,"added"))}}catch(e){i={error:e}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}},e.prototype.onMetaContentChangeObserved=function(e){var t,r;try{for(var i=n(e),o=i.next();!o.done;o=i.next()){var s=o.value;if("attributes"===s.type&&"content"===s.attributeName&&s.target instanceof HTMLMetaElement&&s.target.content!==s.oldValue){var a=s.target;this.onChangedMetaContent(a)}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.onAddedMeta=function(e){var t=this.getPaymentDetails(e),r=new MutationObserver(this.onMetaContentChangeObserved.bind(this));if(r.observe(e,{attributeOldValue:!0,childList:!1,attributeFilter:["content"]}),this.metaTags.set(e,{observer:r,details:t}),this.metaTags.size>this.maxMetas)throw new Error("Only "+this.maxMetas+" monetization tags supported");this.callback({stopped:null,started:t})},e.prototype.onRemovedMeta=function(e){var t=this.getEntry(e);t.observer.disconnect(),this.metaTags.delete(e),this.callback({started:null,stopped:t.details})},e.prototype.getEntry=function(e){var t=this.metaTags.get(e);if(!t)throw new Error("meta not tracked: "+e.outerHTML);return t},e.prototype.onChangedMetaContent=function(e){var t=this.getEntry(e),r=t.details,n=this.getPaymentDetails(e);t.details=n,this.callback({started:n,stopped:r})},e.prototype.getPaymentDetails=function(e){return{requestId:this.getWebMonetizationId(),paymentPointer:e.content,initiatingUrl:this.window.location.href}},e.prototype.getWebMonetizationId=function(){if(this.idGenerationStrategy===i.PAGE_LOAD)return this.pageLoadId;if(this.idGenerationStrategy===i.META_ADDED_CHANGED)return o.v4();throw new Error},e}();t.MonetizationTagObserver=c},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(30),c=function(e){function t(t,r){var n=e.call(this,t)||this;return n.response=r,n}return i(t,e),t}(r(58).CustomError);t.SPSPError=c,t.getSPSPResponse=function(t,r){return o(this,void 0,void 0,(function(){var n,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.portableFetch(t,{method:"GET",credentials:"omit",cache:"no-cache",headers:{accept:"application/spsp4+json","Web-Monetization-Id":r}})];case 1:return n=o.sent(),[3,3];case 2:throw o.sent(),new c("failed_to_fetch");case 3:if(!n.ok)throw new c("spsp request failed. status="+n.status,n);return[4,n.json()];case 4:return[2,{destinationAccount:(i=o.sent()).destination_account,sharedSecret:e.from(i.shared_secret,"base64")}]}}))}))}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=u(e),s=n[0],a=n[1],c=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),l=0,f=a>0?s-4:s;for(r=0;r<f;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[l++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(l(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,l=-7,f=r?i-1:0,h=r?-1:1,d=e[t+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=u}return(d?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(s++,c/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*c-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+d]=255&s,d+=p,s/=256,u-=8);e[r+d-p]|=128*g}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this,i=r.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i,n}return i(t,e),t}(Error);t.CustomError=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r){void 0===r&&(r=function(){}),this._pageUrl=e,this._tiers=t,this._debug=r,this.reset()}return e.prototype.reset=function(){this._timeStarted=Date.now(),this._sentAmount=0,this._debug("reset amount parameters to 0")},e.prototype.addSentAmount=function(e){this._debug("adding sent amount of",e),this._sentAmount+=Number(e)||0},e.prototype.getStreamSendMax=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,o;return i(this,(function(i){switch(i.label){case 0:return e=Date.now(),t=e-this._timeStarted,r=t/1e3,[4,this._tiers.getBandwidth(this._pageUrl)];case 1:return n=i.sent(),o=Math.floor(r*n-this._sentAmount),this._debug("current send amount is",o),[2,o]}}))}))},e}();t.AdaptiveBandwidth=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(26),s=function(){function e(e,t,r){void 0===e&&(e=50),void 0===t&&(t=e),void 0===r&&(r=5e3),this.defaultBackoff=e,this.backoff=t,this.maxBackoff=r}return e.prototype.reset=function(){this.backoff=this.defaultBackoff},e.prototype.waitAndBackoff=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,o.timeout(this.backoff)];case 1:return e.sent(),this.backoff=Math.floor(Math.pow(this.backoff,1.05)),this.backoff>this.maxBackoff&&(this.backoff=this.maxBackoff),[2]}}))}))},e}();t.BackoffWaiter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePaymentEndpoint=function(e){var t,r=e.replace(/^\$/,"https://");try{t=new URL(r)}catch(t){throw new Error("Invalid payment pointer/url: "+JSON.stringify(e))}var n=e.startsWith("$");if(n&&(t.hash||t.search||t.port||t.username||t.password))throw new Error("Payment pointer must not contain query/fragment/port/username elements: "+JSON.stringify({hash:t.hash,search:t.search,port:t.port,username:t.username,password:t.password}));return n&&"/"===t.pathname?t.href+".well-known/pay":t.href}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new Date(41024448e5);t.getFarFutureExpiry=function(e){return n}},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.parsePolicyDirectives=function(e){return e.split(";").reduce((function(e,t){var r,o=i(t.trim().split(/\s+/g)),s=o[0],a=o.slice(1);return!s||Object.prototype.hasOwnProperty.call(e,s)?e:n(n({},e),((r={})[s]=a,r))}),{})}},function(e,t,r){"use strict";(function(e,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var u,l=r(7),f=a(r(69)),h=c(r(85)),d=r(25),p=r(120),g=r(123),m=r(24);!function(e){e[e.STOPPED=0]="STOPPED",e[e.STARTED=1]="STARTED"}(u=t.MonetizationStateEnum||(t.MonetizationStateEnum={}));var y=function(){function t(e){this.btpEndpoint="btp+wss://coil.com/btp",this.state=u.STOPPED,this.active=!1,this.activeChanges=new l.EventEmitter,this.backoff=new d.BackoffWaiter,this.lastDelivered=0,this.loop=null,this.tiers=e(p.BandwidthTiers),this.monetization=new g.DocumentMonetization(document)}return t.prototype.refreshBtpToken=function(e){this.btpToken=e},t.prototype.start=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.finalizeExisting()];case 1:return t.sent(),this.active=!0,this.btpToken=e.btpToken,this.btpEndpoint=e.btpEndpoint||"btp+wss://coil.com/btp",this.requestId=e.requestId,this.paymentPointer=e.paymentPointer,this.spspEndpoint=e.spspEndpoint,this.pageUrl=e.pageUrl,this.adaptiveBandwidth=new d.AdaptiveBandwidth(e.pageUrl,this.tiers),this.monetization.setMonetizationRequest({paymentPointer:e.paymentPointer,requestId:e.requestId}),this.loop||(this.loop=this.streamRetryLoop()),this.activeChanges.emit("start"),[2]}}))}))},t.prototype.finalizeExisting=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(!this.existing)return[3,5];e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,this.existing];case 2:return e.sent(),[3,5];case 3:return e.sent(),[3,5];case 4:return this.existing=void 0,[7];case 5:return[2]}}))}))},t.prototype.stop=function(e){return void 0===e&&(e=!0),o(this,void 0,void 0,(function(){return s(this,(function(t){return this.active=!1,this.monetization.setState({state:"stopped",finalized:e}),e&&this.monetization.setMonetizationRequest(void 0),this.state=u.STOPPED,this.activeChanges.emit("stop"),[2]}))}))},t.prototype.isActive=function(){return this.active},t.prototype.streamRetryLoop=function(){return o(this,void 0,void 0,(function(){var t,r,n,i=this;return s(this,(function(o){switch(o.label){case 0:if(!this.spspEndpoint)throw new Error("no spspEndpoint; was init called?");if(!this.requestId)throw new Error("no streamId; was init called?");o.label=1;case 1:return this.isActive()?[3,3]:[4,new Promise((function(e){return i.activeChanges.once("start",e)}))];case 2:o.sent(),o.label=3;case 3:return o.trys.push([3,6,,8]),this.monetization.setState({state:"pending"}),m.debug("Start streamPayment()"),t=this,r=this.streamPayment,[4,d.getSPSPResponse(this.spspEndpoint,this.requestId)];case 4:return[4,t.existing=r.apply(this,[o.sent()])];case 5:return o.sent(),m.debug("End streamPayment()"),[3,8];case 6:return n=o.sent(),e.error("streaming error; retry in "+this.backoff+" ms. error=",n),[4,this.backoff.waitAndBackoff()];case 7:return o.sent(),[3,8];case 8:return[3,1];case 9:return[2]}}))}))},t.prototype.streamPayment=function(e){return o(this,void 0,void 0,(function(){var t,r,a,c,l,p=this;return s(this,(function(g){switch(g.label){case 0:if(!this.btpToken)throw new Error("no btpToken; was init called?");if(!this.spspEndpoint)throw new Error("no spspEndpoint; was init called?");if(!this.isActive())return[2];t=new f.default({server:this.btpEndpoint,btpToken:this.btpToken}),g.label=1;case 1:return g.trys.push([1,,8,10]),[4,t.connect()];case 2:return g.sent(),this.backoff.reset(),this.isActive()?[4,h.createConnection(i(i({plugin:t,slippage:1,exchangeRate:1,maximumPacketAmount:"10000000"},e),{getExpiry:d.getFarFutureExpiry}))]:[2];case 3:return r=g.sent(),this.isActive()?[3,5]:[4,r.destroy()];case 4:return g.sent(),[2];case 5:return[4,(a=this.adaptiveBandwidth).getStreamSendMax()];case 6:return c=g.sent(),(l=r.createStream()).setSendMax(c),[4,new Promise((function(e,i){var c=function(e){n(p.onOutgoingMoney.bind(p),r,e)},f=function(){return o(p,void 0,void 0,(function(){return s(this,(function(t){return w(),e(),[2]}))}))},h=function(){w(),i(new Error("connection closed"))},g=f,y=d.asyncUtils.onlyOnce((function(){a.addSentAmount(l.totalSent)})),w=d.asyncUtils.onlyOnce((function(){m.debug("cleanUp()"),t.removeListener("disconnect",f),l.removeListener("outgoing_money",c),r.removeListener("close",h),y(),p.activeChanges.removeListener("stop",g),p.lastDelivered=0,p.monetization.setState({state:"stopped"}),p.state=u.STOPPED,clearInterval(b)}));t.on("disconnect",f),l.on("outgoing_money",c),r.on("close",h),p.activeChanges.once("stop",(function(){m.debug("activeChanges on stop!"),g()}));var b=setInterval((function(){return o(p,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,a.getStreamSendMax()];case 1:return e=t.sent(),l.isOpen()&&l.setSendMax(e),[2]}}))}))}),2e3)}))];case 7:return g.sent(),[3,10];case 8:return[4,t.disconnect()];case 9:return g.sent(),[7];case 10:return[2]}}))}))},t.prototype.onOutgoingMoney=function(e,t){this.state===u.STOPPED&&(this.state=u.STARTED,this.dispatchMonetizationStart());var r=Number(e.totalDelivered)-this.lastDelivered;this.lastDelivered=Number(e.totalDelivered),this.dispatchMonetizationProgress(e,r.toString())},t.prototype.dispatchMonetizationStart=function(){var e={paymentPointer:this.paymentPointer,requestId:this.requestId};this.monetization.dispatchMonetizationStartEventAndSetMonetizationState(e)},t.prototype.dispatchMonetizationProgress=function(e,t){var r={amount:t,assetCode:e.destinationAssetCode,assetScale:e.destinationAssetScale,paymentPointer:this.paymentPointer,requestId:this.requestId};this.monetization.dispatchMonetizationProgressEvent(r)},t.prototype.pause=function(){return this.stop(!1)},t}();t.Stream=y}).call(this,r(3),r(13).setImmediate)},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,a,c=s(e),u=1;u<arguments.length;u++){for(var l in r=Object(arguments[u]))i.call(r,l)&&(c[l]=r[l]);if(n){a=n(r);for(var f=0;f<a.length;f++)o.call(r,a[f])&&(c[a[f]]=r[a[f]])}}return c}},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,o,s,a,c=1,u={},l=!1,f=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){o.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,n=function(e){var t=f.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return u[c]=i,n(c),c++},h.clearImmediate=d}function d(e){delete u[e]}function p(e){if(l)setTimeout(p,0,e);else{var t=u[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{d(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(4),r(1))},function(e,t,r){"use strict";e.exports=r(70).default,e.exports.default=e.exports},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(10),i=r(71),o=r(72),s=r(74),a=r(75),c=r(33),u=r(78),l=r(34),f=r(5)("ilp-plugin-btp");var h;!function(e){e[e.INITIAL=0]="INITIAL",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.READY_TO_EMIT=4]="READY_TO_EMIT"}(h||(h={}));const d={UnreachableError:"T00",NotAcceptedError:"F00",InvalidFieldsError:"F01",TransferNotFoundError:"F03",InvalidFulfillmentError:"F04",DuplicateIdError:"F05",AlreadyRolledBackError:"F06",AlreadyFulfilledError:"F07",InsufficientBalanceError:"F08"},p=e=>{if(!e.startsWith("btp+"))throw new Error('server must start with "btp+". server='+e);return new URL(e.substring(4))};const g={12:"ilp-prepare",13:"ilp-fulfill",14:"ilp-reject"};function m(e){return{toString:()=>{try{return e.protocolData.map(e=>{switch(e.protocolName){case"ilp":return g[e.data[0]]||"ilp-"+e.data[0];default:return function(e){let t;switch(e.contentType){case l.MIME_APPLICATION_OCTET_STREAM:t=e.data.toString("base64");break;case l.MIME_APPLICATION_JSON:case l.MIME_TEXT_PLAIN_UTF8:t=e.data.toString("utf8")}return`${e.protocolName}=${t}`}(e)}}).join(";")}catch(e){return"serialization error. err="+e.stack}}}}class y extends c.EventEmitter2{constructor(t,r){if(super(),this._readyState=h.INITIAL,this._wss=null,this._reconnectInterval=t.reconnectInterval,this._reconnectIntervals=t.reconnectIntervals,this._reconnectClearTryTimeout=t.reconnectClearTryTimeout,this._responseTimeout=t.responseTimeout||35e3,this._listener=t.listener,this._server=t.server,this._listener&&(this._listenerSecret=e.from(this._listener.secret,"utf8"),this._listener.wsOpts=this._listener.wsOpts||{port:this._listener.port},this._listener.wsOpts.server&&(this._httpServer=this._listener.wsOpts.server)),this._server){const e=p(this._server),r=e.username,n=e.password;if((r||n)&&(t.btpAccount||t.btpToken))throw new Error("account/token must be passed in via constructor or uri, but not both");this._btpToken=n||t.btpToken||"",this._btpAccount=r||t.btpAccount||""}r=r||{},this._log=r.log||f,this._log.trace=this._log.trace||o(this._log.debug.namespace+":trace"),this.WebSocket=r.WebSocket||s,this.WebSocketServer=r.WebSocketServer||s.Server}async _connect(...e){}async _disconnect(){}async connect(){if(!(this._readyState>h.INITIAL)){if(this._readyState=h.CONNECTING,this._listener){this._httpServer&&this._httpServer.listen(this._listener.port);const e=this._wss=new this.WebSocketServer(Object.assign({},this._listener.wsOpts));this._incomingWs=void 0,e.on("connection",e=>{let t;this._log.info("got connection"),e.on("close",e=>{this._log.info("incoming websocket closed. code="+e),this._emitDisconnect()}),e.on("error",e=>{this._log.debug("incoming websocket error. error=",e),this._emitDisconnect()}),e.once("message",async r=>{try{t=l.deserialize(r),this._log.trace("got auth packet. packet=%j",t),this._validateAuthPacket(t),this._incomingWs&&this._closeIncomingSocket(this._incomingWs,t),this._incomingWs=e,e.send(l.serializeResponse(t.requestId,[]))}catch(r){if(this._incomingWs=void 0,t){const n=l.serializeError({code:"F00",name:"NotAcceptedError",data:r.message,triggeredAt:(new Date).toISOString()},t.requestId,[]);e.send(n)}return void e.close()}this._log.trace("connection authenticated"),e.on("message",this._handleIncomingWsMessage.bind(this,e)),this._emitConnect()})}),this._log.info("listening for BTP connections on "+this._listener.port)}if(this._server){const t=p(this._server),r=this._btpAccount||"",n=this._btpToken||"";this._ws=new a.WebSocketReconnector({WebSocket:this.WebSocket,intervals:this._reconnectIntervals,interval:this._reconnectInterval,clearTryTimeout:this._reconnectClearTryTimeout});const i=[{protocolName:"auth",contentType:l.MIME_APPLICATION_OCTET_STREAM,data:e.from([])},{protocolName:"auth_username",contentType:l.MIME_TEXT_PLAIN_UTF8,data:e.from(r,"utf8")},{protocolName:"auth_token",contentType:l.MIME_TEXT_PLAIN_UTF8,data:e.from(n,"utf8")}];this._ws.on("open",async()=>{this._log.trace("connected to server"),this._call("",{type:l.TYPE_MESSAGE,requestId:await w(),data:{protocolData:i}}).then(()=>{this._emitConnect()}).catch(e=>{this._log.error("error authenticating btp connection",e.message)})}),t.username="",t.password="",await this._ws.open(t.toString()),this._ws.on("close",()=>this._emitDisconnect()),this._ws.on("message",this._handleIncomingWsMessage.bind(this,this._ws))}await new Promise((e,t)=>{const r=()=>{this._ws&&this._ws.close(),t(new Error("connection aborted"))};this.once("disconnect",r),this.once("_first_time_connect",()=>{this.removeListener("disconnect",r),e()})}),await this._connect(),this._readyState=h.READY_TO_EMIT,this._emitConnect()}}_closeIncomingSocket(e,t){e.removeAllListeners(),e.once("message",async r=>{try{e.send(l.serializeError({code:"F00",name:"NotAcceptedError",data:"This connection has been ended because the user has opened a new connection",triggeredAt:(new Date).toISOString()},t.requestId,[]))}catch(e){this._log.error("error responding on closed socket",e)}e.close()})}async disconnect(){this._emitDisconnect(),await this._disconnect(),this._ws&&this._ws.close(),this._incomingWs&&(this._incomingWs.close(),this._incomingWs=void 0),this._wss&&(this._wss.close(),this._httpServer&&this._httpServer.close(),this._wss=null)}isConnected(){return this._readyState===h.CONNECTED}async _handleIncomingWsMessage(e,t){let r;try{r=l.deserialize(t)}catch(t){return this._log.error("deserialization error:",t),void e.close()}try{await this._handleIncomingBtpPacket("",r)}catch(e){this._log.debug(`Error processing BTP packet of type ${r.type}: `,e);const t=function(e){const t=e.name||"NotAcceptedError";return{code:d[t]||"F00",name:t,triggeredAt:new Date,data:JSON.stringify({message:e.message})}}(e),n=r.requestId,{code:i,name:o,triggeredAt:s,data:a}=t;await this._handleOutgoingBtpPacket("",{type:l.TYPE_ERROR,requestId:n,data:{code:i,name:o,triggeredAt:s,data:a,protocolData:[]}})}}async sendData(t){const r=(await this._call("",{type:l.TYPE_MESSAGE,requestId:await w(),data:{protocolData:[{protocolName:"ilp",contentType:l.MIME_APPLICATION_OCTET_STREAM,data:t}]}})).protocolData.filter(e=>"ilp"===e.protocolName)[0];return r?r.data:e.alloc(0)}async sendMoney(e){}_safeEmit(){try{this.emit.apply(this,arguments)}catch(e){const t="object"==typeof e&&e.stack?e.stack:String(e);this._log.error("error in handler for event",arguments,t)}}registerDataHandler(e){if(this._dataHandler)throw new Error("requestHandler is already registered");if("function"!=typeof e)throw new Error("requestHandler must be a function");this._log.trace("registering data handler"),this._dataHandler=e}deregisterDataHandler(){this._dataHandler=void 0}registerMoneyHandler(e){if(this._moneyHandler)throw new Error("requestHandler is already registered");if("function"!=typeof e)throw new Error("requestHandler must be a function");this._log.trace("registering money handler"),this._moneyHandler=e}deregisterMoneyHandler(){this._moneyHandler=void 0}protocolDataToIlpAndCustom(e){return u.protocolDataToIlpAndCustom(e)}ilpAndCustomToProtocolData(e){return u.ilpAndCustomToProtocolData(e)}async _call(e,t){const r=t.requestId;let n,i;const o=new Promise((e,t)=>{n=(r,n)=>{switch(r){case l.TYPE_RESPONSE:e(n),clearTimeout(i);break;case l.TYPE_ERROR:t(new Error(JSON.stringify(n))),clearTimeout(i);break;default:throw new Error("Unknown BTP packet type: "+r)}},this.once("__callback_"+r,n)});await this._handleOutgoingBtpPacket(e,t);const s=new Promise((e,t)=>{i=setTimeout(()=>{this.removeListener("__callback_"+r,n),t(new Error(r+" timed out"))},this._responseTimeout)});return Promise.race([o,s])}async _handleIncomingBtpPacket(e,t){const{type:r,requestId:n,data:i}=t,o=l.typeToString(r);let s;switch(this._log.trace(`received btp packet. type=${o} requestId=${n} info=${m(i)}`),r){case l.TYPE_RESPONSE:case l.TYPE_ERROR:return void this.emit("__callback_"+n,r,i);case l.TYPE_PREPARE:case l.TYPE_FULFILL:case l.TYPE_REJECT:throw new Error("Unsupported BTP packet");case l.TYPE_TRANSFER:s=await this._handleMoney(e,t);break;case l.TYPE_MESSAGE:s=await this._handleData(e,t);break;default:throw new Error("Unknown BTP packet type")}await this._handleOutgoingBtpPacket(e,{type:l.TYPE_RESPONSE,requestId:n,data:{protocolData:s||[]}})}async _handleData(e,t){const{data:r}=t,{ilp:n}=u.protocolDataToIlpAndCustom(r);if(!this._dataHandler)throw new Error("no request handler registered");const i=await this._dataHandler(n);return u.ilpAndCustomToProtocolData({ilp:i})}async _handleMoney(e,t){throw new Error("No sendMoney functionality is included in this module")}async _handleOutgoingBtpPacket(e,t){const r=this._ws||this._incomingWs,{type:n,requestId:i,data:o}=t,s=l.typeToString(n);this._log.trace(`sending btp packet. type=${s} requestId=${i} info=${m(o)}`);try{await new Promise(e=>r.send(l.serialize(t),e))}catch(e){this._log.error("unable to send btp message to client: "+e.message,"btp packet:",JSON.stringify(t))}}_emitDisconnect(){this._readyState!==h.DISCONNECTED&&(this._readyState=h.DISCONNECTED,this.emit("disconnect"))}_emitConnect(){this._readyState===h.CONNECTING?this.emit("_first_time_connect"):this._readyState!==h.READY_TO_EMIT&&this._readyState!==h.DISCONNECTED||(this._readyState=h.CONNECTED,this.emit("connect"))}_validateAuthPacket(e){n.strictEqual(e.type,l.TYPE_MESSAGE,"First message sent over BTP connection must be auth packet"),n(e.data.protocolData.length>=2,"Auth packet must have auth and auth_token subprotocols"),n.strictEqual(e.data.protocolData[0].protocolName,"auth","First subprotocol must be auth");const t=e.data.protocolData.find(e=>"auth_token"===e.protocolName);n(t,"auth_token subprotocol is required");const r=this._listenerSecret,o=t.data;if(o.length!==r.length||!i.timingSafeEqual(o,r))throw this._log.debug('received token "%s", but expected "%s"',o.toString(),this._listener.secret.toString()),new Error("invalid auth_token")}}function w(){return new Promise((e,t)=>{i.randomBytes(4,(r,n)=>{if(r)return t(r);e(n.readUInt32BE(0))})})}y.version=2,t.default=y}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const{crypto:r}=window;t.randomBytes=function(t,n){const i=new Uint8Array(t),o=r.getRandomValues(i);n(null,e.from(o))}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(n,i){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===(void 0===n?"undefined":o(n))&&n.log&&(e=n).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(73)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(3),r(1))},function(e,t,r){"use strict";e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){var r;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(r||a);o.diff=c,o.prev=r,o.curr=a,r=a,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var i=n.formatters[r];if("function"==typeof i){var s=t[u];e=i.call(o,s),t.splice(u,1),u--}return e})),n.formatArgs.call(o,t);var l=o.log||n.log;l.apply(o,t)}}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function i(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){return n(this.namespace+(void 0===t?":":t)+e)}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){n.enable("")},n.enable=function(e){var t;n.save(e),n.names=[],n.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){var o=n.instances[t];o.enabled=n.enabled(o.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(16),Object.keys(e).forEach((function(t){n[t]=e[t]})),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t,r){"use strict";(function(t,n){const i=r(7);class o extends i.EventEmitter{constructor(e){super(),this._ws=new WebSocket(e),this._ws.binaryType="arraybuffer",this._ws.onerror=this.emit.bind(this,"error"),this._ws.onopen=this.emit.bind(this,"open"),this._ws.onclose=this.emit.bind(this,"close"),this._ws.onmessage=e=>{this.emit("message",t.from(e.data))}}send(e,t){this._ws.readyState===WebSocket.CONNECTING||this._ws.readyState===WebSocket.OPEN?(this._ws.send(e.buffer),n.nextTick(t)):n.nextTick(t,new Error("already closed"))}ping(){}close(){this._ws.close()}}e.exports=o}).call(this,r(0).Buffer,r(1))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(33),o=n("ilp-ws-reconnect"),s=[0,100,500,1e3,2e3,5e3];class a extends i.EventEmitter2{constructor(e){super(),this.WebSocket=e.WebSocket,this._clearTryTimeout=e.clearTryTimeout||1e4,this._tries=0,this._intervals=e.intervals||e.interval&&[e.interval]||s}open(e){return this._url=e,this._open(),new Promise(e=>{this.once("open",e)})}send(e,t){return this._instance.send(e,t)}close(){this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._instance.removeAllListeners(),this.emit("close"),this._instance.close(),this._openTimer&&clearTimeout(this._openTimer),this._clearTryTimer&&clearTimeout(this._clearTryTimer)}_open(){this._instance=new this.WebSocket(this._url),this._instance.on("open",()=>{this.emit("open"),this.heartbeat()}),this._instance.on("close",(e,t)=>this._reconnect(e)),this._instance.on("error",e=>this._reconnect(e)),this._instance.on("message",e=>{this.emit("message",e)})}heartbeat(){this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._instance&&this._instance.readyState===this._instance.OPEN&&(this._instance.ping(),this._heartbeatTimer=setTimeout(()=>this.heartbeat(),2e4))}_reconnect(e){o.debug(`websocket disconnected with ${e}; reconnect in ${this._intervals[this._tries]}`),this._connected=!1,this._instance.removeAllListeners(),this._openTimer=setTimeout(()=>{this._open()},this._intervals[this._tries]),this._tries=Math.min(this._tries+1,this._intervals.length-1),this._clearTryTimer&&clearTimeout(this._clearTryTimer),this._clearTryTimer=setTimeout(()=>{delete this._clearTryTimer,this._tries=0},this._clearTryTimeout),"function"==typeof this._clearTryTimer.unref&&this._clearTryTimer.unref(),this.emit("close")}}t.WebSocketReconnector=a},function(e,t,r){(function(n,i){t.log=function(...e){return"object"==typeof n&&n.log&&n.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(77)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(3),r(1))},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function s(...e){if(!s.enabled)return;const t=s,i=Number(new Date),o=i-(r||i);t.diff=o,t.prev=r,t.curr=i,r=i,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;a++;const o=n.formatters[i];if("function"==typeof o){const n=e[a];r=o.call(t,n),e.splice(a,1),a--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function i(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(s),...n.skips.map(s).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(16),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(34);t.protocolDataToIlpAndCustom=function(e){const t={},{protocolData:r}=e;for(const e of r){const r=e.protocolName;e.contentType===n.MIME_TEXT_PLAIN_UTF8?t[r]=e.data.toString("utf8"):e.contentType===n.MIME_APPLICATION_JSON?t[r]=JSON.parse(e.data.toString("utf8")):t[r]=e.data}return{protocolMap:t,ilp:t.ilp,custom:t.custom}},t.ilpAndCustomToProtocolData=function(t){const r=[],{ilp:i,custom:o,protocolMap:s}=t;if(i&&r.push({protocolName:"ilp",contentType:n.MIME_APPLICATION_OCTET_STREAM,data:i}),s){const t=Object.keys(s);for(const i of t)e.isBuffer(s[i])?r.push({protocolName:i,contentType:n.MIME_APPLICATION_OCTET_STREAM,data:s[i]}):"string"==typeof s[i]?r.push({protocolName:i,contentType:n.MIME_TEXT_PLAIN_UTF8,data:e.from(s[i])}):r.push({protocolName:i,contentType:n.MIME_APPLICATION_JSON,data:e.from(JSON.stringify(s[i]))})}return o&&r.push({protocolName:"custom",contentType:n.MIME_APPLICATION_JSON,data:e.from(JSON.stringify(o))}),r}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=r(80),i=r(81),o=r(2),s=r(17),a=function(){function t(e){this.buffer=e,this.cursor=0,this.bookmarks=[]}return t.from=function(r){if(e.isBuffer(r))return new t(r);if(r instanceof t)return new t(r.buffer.slice(r.cursor));throw new Error("Reader must be given a Buffer")},t.prototype.bookmark=function(){this.bookmarks.push(this.cursor)},t.prototype.restore=function(){if(!this.bookmarks.length)throw new Error("Cannot restore bookmark when no bookmark set");this.cursor=this.bookmarks.pop()},t.prototype.ensureAvailable=function(e){if(this.buffer.length<this.cursor+e)throw new n.default("Tried to read "+e+" bytes, but only "+(this.buffer.length-this.cursor)+" bytes available")},t.prototype.readUIntNumber=function(e){if(e<1)throw new Error("UInt length must be greater than zero");if(s.MAX_SAFE_BYTES<e)throw new Error("Value does not fit a JS number without sacrificing precision");var t=this.buffer.readUIntBE(this.cursor,e);return this.cursor+=e,t},t.prototype.readUIntLong=function(e){var t=this.peekUIntLong(e);return this.cursor+=e,t},t.prototype.readUInt=function(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.readUIntNumber(e)):this.readUIntLong(e).toString()},t.prototype.peekUIntNumber=function(e){if(e>=1&&e<=s.MAX_SAFE_BYTES)return this.buffer.readUIntBE(this.cursor,e);throw new Error("Value does not fit a JS number without sacrificing precision")},t.prototype.peekUIntLong=function(e){if(0===e)return o.UZERO;if(e<0)throw new Error("Tried to read integer with negative length (provided: "+e+")");if(e>8)throw new Error("UInts longer than 8 bytes must be encoded as VarUInts");return s.bufferToLong(this.peek(e),!0)},t.prototype.peekUInt=function(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.peekUIntNumber(e)):this.peekUIntLong(e).toString()},t.prototype.skipUInt=function(e){this.skip(e)},t.prototype.readIntNumber=function(e){if(e<1)throw new Error("Int length must be greater than zero");if(s.MAX_SAFE_BYTES<e)throw new Error("Value does not fit a JS number without sacrificing precision");var t=this.buffer.readIntBE(this.cursor,e);return this.cursor+=e,t},t.prototype.readIntLong=function(e){var t=this.peekIntLong(e);return this.cursor+=e,t},t.prototype.readInt=function(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.readIntNumber(e)):this.readIntLong(e).toString()},t.prototype.peekIntNumber=function(e){if(e>=1&&e<=s.MAX_SAFE_BYTES)return this.buffer.readIntBE(this.cursor,e);throw new Error("Value does not fit a JS number without sacrificing precision")},t.prototype.peekIntLong=function(e){if(0===e)return o.ZERO;if(e<0)throw new Error("Tried to read integer with negative length (provided: "+e+")");if(e>8)throw new Error("Ints longer than 8 bytes must be encoded as VarInts");return s.bufferToLong(this.peek(e),!1)},t.prototype.peekInt=function(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.peekIntNumber(e)):this.peekIntLong(e).toString()},t.prototype.skipInt=function(e){this.skip(e)},t.prototype.readVarUIntNumber=function(){if(0===this.buffer[this.cursor])throw new i.default("UInt of length 0 is invalid");if(this.buffer[this.cursor]<=s.MAX_SAFE_BYTES)return this.readUIntNumber(this.buffer[this.cursor++]);throw new Error("Value does not fit a JS number without sacrificing precision")},t.prototype.readVarUIntLong=function(){var e=this.readVarOctetString();if(0===e.length)throw new i.default("UInt of length 0 is invalid");return s.bufferToLong(e,!0)},t.prototype.readVarUInt=function(){return this.readVarUIntLong().toString()},t.prototype.peekVarUIntNumber=function(){this.bookmark();var e=this.readVarUIntNumber();return this.restore(),e},t.prototype.peekVarUIntLong=function(){this.bookmark();var e=this.readVarUIntLong();return this.restore(),e},t.prototype.peekVarUInt=function(){return this.peekVarUIntLong().toString()},t.prototype.skipVarUInt=function(){this.skipVarOctetString()},t.prototype.readVarIntNumber=function(){if(0===this.buffer[this.cursor])throw new i.default("Int of length 0 is invalid");if(this.buffer[this.cursor]<=s.MAX_SAFE_BYTES)return this.readIntNumber(this.buffer[this.cursor++]);throw new Error("Value does not fit a JS number without sacrificing precision")},t.prototype.readVarIntLong=function(){var e=this.readVarOctetString();if(0===e.length)throw new i.default("Int of length 0 is invalid");return s.bufferToLong(e,!1)},t.prototype.readVarInt=function(){return this.readVarIntLong().toString()},t.prototype.peekVarIntNumber=function(){this.bookmark();var e=this.readVarIntNumber();return this.restore(),e},t.prototype.peekVarIntLong=function(){this.bookmark();var e=this.readVarIntLong();return this.restore(),e},t.prototype.peekVarInt=function(){return this.peekVarIntLong().toString()},t.prototype.skipVarInt=function(){this.skipVarOctetString()},t.prototype.readOctetString=function(e){return this.read(e)},t.prototype.peekOctetString=function(e){return this.peek(e)},t.prototype.skipOctetString=function(e){return this.skip(e)},t.prototype.readLengthPrefix=function(){var e=this.readUInt8Number();if(e&t.HIGH_BIT){var r=e&t.LOWER_SEVEN_BITS,n=r&&this.readUIntNumber(r),o=Math.max(128,1<<8*(r-1));if(0===r||n<o)throw new i.default("Length prefix encoding is not canonical: "+n+" encoded in "+r+" bytes");return n}return e},t.prototype.readVarOctetString=function(){var e=this.readLengthPrefix();return this.read(e)},t.prototype.peekVarOctetString=function(){this.bookmark();var e=this.readVarOctetString();return this.restore(),e},t.prototype.skipVarOctetString=function(){var e=this.readLengthPrefix();this.skip(e)},t.prototype.read=function(e){this.ensureAvailable(e);var t=this.buffer.slice(this.cursor,this.cursor+e);return this.cursor+=e,t},t.prototype.peek=function(e){return this.ensureAvailable(e),this.buffer.slice(this.cursor,this.cursor+e)},t.prototype.skip=function(e){this.ensureAvailable(e),this.cursor+=e},t.HIGH_BIT=128,t.LOWER_SEVEN_BITS=127,t}();["read","peek","skip"].forEach((function(e){[1,2,4,8].forEach((function(t){a.prototype[e+"UInt"+8*t]=function(){return this[e+"UInt"](t)},a.prototype[e+"Int"+8*t]=function(){return this[e+"Int"](t)},"skip"!==e&&(a.prototype[e+"UInt"+8*t+"Number"]=function(){return this[e+"UIntNumber"](t)},a.prototype[e+"Int"+8*t+"Number"]=function(){return this[e+"IntNumber"](t)},a.prototype[e+"UInt"+8*t+"Long"]=function(){return this[e+"UIntLong"](t)},a.prototype[e+"Int"+8*t+"Long"]=function(){return this[e+"IntLong"](t)})}))})),t.default=a}).call(this,r(0).Buffer)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(r(35).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(r(35).default);t.default=o},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=r(17),i=function(){function t(t){e.isBuffer(t)?(this.buffer=t,this.strict=!0):(this.buffer=e.alloc(t||0),this.strict="number"==typeof t),this._offset=0}return Object.defineProperty(t.prototype,"length",{get:function(){return this._offset},enumerable:!0,configurable:!0}),t.prototype.writeUInt=function(e,r){if(!n.isInteger(e))throw new Error("UInt must be an integer");if("number"==typeof e&&e>t.MAX_SAFE_INTEGER)throw new Error("UInt is larger than safe JavaScript range (try using Longs instead)");if(r<=0)throw new Error("UInt length must be greater than zero");if(n.isLong(e)&&!e.unsigned)throw new Error("Expected unsigned Long");if(r<=n.MAX_SAFE_BYTES){if((o=Number(e))<0)throw new Error("UInt must be positive");if(o>t.UINT_RANGES[r])throw new Error("UInt "+e+" does not fit in "+r+" bytes");var i=this.advance(r);this.buffer.writeUIntBE(o,i,r)}else{var o=n.longFromValue(e,!0);if(r<n.getLongUIntBufferSize(o))throw new Error("UInt "+o+" does not fit in "+r+" bytes");this.write(n.longToBuffer(o,r))}},t.prototype.writeInt=function(e,r){if(!n.isInteger(e))throw new Error("Int must be an integer");if(r<=0)throw new Error("Int length must be greater than zero");if("number"==typeof e&&e>t.MAX_SAFE_INTEGER)throw new Error("Int is larger than safe JavaScript range (try using Longs instead)");if("number"==typeof e&&e<t.MIN_SAFE_INTEGER)throw new Error("Int is smaller than safe JavaScript range (try using Longs instead)");if(n.isLong(e)&&e.unsigned)throw new Error("Expected signed Long");if(r<=n.MAX_SAFE_BYTES){if((o=Number(e))<t.INT_RANGES[r][0]||o>t.INT_RANGES[r][1])throw new Error("Int "+e+" does not fit in "+r+" bytes");var i=this.advance(r);this.buffer.writeIntBE(o,i,r)}else{var o=n.longFromValue(e,!1);if(r<n.getLongIntBufferSize(o))throw new Error("Int "+o+" does not fit in "+r+" bytes");this.write(n.longToBuffer(o,r))}},t.prototype.writeVarUInt=function(t){if(e.isBuffer(t))this.writeVarOctetString(t);else{if(!n.isInteger(t))throw new Error("UInt must be an integer");var r,i;"number"==typeof t?(r=t,i=n.getUIntBufferSize(r)):(r=n.longFromValue(t,!0),i=n.getLongUIntBufferSize(r)),this.createVarOctetString(i).writeUInt(r,i)}},t.prototype.writeVarInt=function(r){if(e.isBuffer(r))this.writeVarOctetString(r);else{if(!n.isInteger(r))throw new Error("Int must be an integer");if("number"==typeof r&&r>t.MAX_SAFE_INTEGER)throw new Error("Int is larger than safe JavaScript range");if("number"==typeof r&&r<t.MIN_SAFE_INTEGER)throw new Error("Int is smaller than safe JavaScript range");var i,o;"number"==typeof r?(i=r,o=n.getIntBufferSize(i)):(i=n.longFromValue(r,!1),o=n.getLongIntBufferSize(i)),this.createVarOctetString(o).writeInt(i,o)}},t.prototype.writeOctetString=function(e,t){if(e.length!==t)throw new Error("Incorrect length for octet string (actual: "+e.length+", expected: "+t+")");this.write(e)},t.prototype.writeVarOctetString=function(t){if(!e.isBuffer(t))throw new TypeError("Expects a buffer");this._writeLengthPrefix(t.length),this.write(t)},t.prototype.createVarOctetString=function(e){if(e<0)throw new Error("length must be non-negative");this._writeLengthPrefix(e);var r=this.advance(e);return new t(this.buffer.slice(r,r+e))},t.prototype._writeLengthPrefix=function(e){if(e<=127)this.writeUInt8(e);else{var t=n.getUIntBufferSize(e);this.writeUInt8(128|t),this.writeUInt(e,t)}},t.prototype.write=function(e){var t=this.advance(e.length);e.copy(this.buffer,t)},t.prototype.getBuffer=function(){return this.buffer.slice(0,this._offset)},t.prototype.advance=function(r){var n=this._offset,i=n+r;if(i<=this.buffer.length)return this._offset+=r,n;if(this.strict)throw new Error("writer cannot exceed capacity");for(var o=this.buffer.length||t.MIN_BUFFER_SIZE;o<i;)o*=2;var s=e.alloc(o);return this.buffer.length&&this.buffer.copy(s),this.buffer=s,this._offset+=r,n},t.MAX_SAFE_INTEGER=9007199254740991,t.MIN_SAFE_INTEGER=-9007199254740991,t.MIN_BUFFER_SIZE=32,t.UINT_RANGES={1:255,2:65535,3:16777215,4:4294967295,5:0xffffffffff,6:0xffffffffffff},t.INT_RANGES={1:[-128,127],2:[-32768,32767],3:[-8388608,8388607],4:[-2147483648,2147483647],5:[-549755813888,549755813887],6:[-0x800000000000,0x7fffffffffff]},t}();[1,2,4,8].forEach((function(e){i.prototype["writeUInt"+8*e]=function(t){this.writeUInt(t,e)},i.prototype["writeInt"+8*e]=function(t){this.writeInt(t,e)}})),t.default=i}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17),i=function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),e.prototype.writeUInt=function(e,t){this.size+=t},e.prototype.writeInt=function(e,t){this.size+=t},e.prototype.writeVarUInt=function(e){if(!n.isInteger(e))throw new Error("UInt must be an integer");var t;if("number"==typeof e){if(e<0)throw new Error("UInt must be positive");t=n.getUIntBufferSize(e)}else{var r=n.longFromValue(e,!0);t=n.getLongUIntBufferSize(r)}this.skipVarOctetString(t)},e.prototype.writeVarInt=function(e){if(!n.isInteger(e))throw new Error("UInt must be an integer");var t;if("number"==typeof e)t=n.getIntBufferSize(e);else{var r=n.longFromValue(e,!1);t=n.getLongIntBufferSize(r)}this.skipVarOctetString(t)},e.prototype.writeOctetString=function(e,t){if(e.length!==t)throw new Error("Incorrect length for octet string (actual: "+e.length+", expected: "+t+")");this.skip(t)},e.prototype.writeVarOctetString=function(e){this.skipVarOctetString(e.length)},e.prototype.createVarOctetString=function(t){return this.skipVarOctetString(t),new e},e.prototype.write=function(e){this.size+=e.length},e.prototype.skip=function(e){this.size+=e},e.prototype.getSize=function(){return this.size},e.measureVarOctetString=function(e){var t=1;e>127&&(t+=n.getUIntBufferSize(e));return t+=e},e.prototype.skipVarOctetString=function(t){this.skip(e.measureVarOctetString(t))},e}();[1,2,4,8].forEach((function(e){i.prototype["writeUInt"+8*e]=function(t){return this.writeUInt(t,e)},i.prototype["writeInt"+8*e]=function(t){return this.writeUInt(t,e)}})),t.default=i},function(e,t,r){var n;!function(i){"use strict";var o,s,a,c=(o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,s=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,function(e,t,r,n){if(1!==arguments.length||"string"!==h(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i=(t=String(c.masks[t]||t||c.masks.default)).slice(0,4);"UTC:"!==i&&"GMT:"!==i||(t=t.slice(4),r=!0,"GMT:"===i&&(n=!0));var d=r?"getUTC":"get",p=e[d+"Date"](),g=e[d+"Day"](),m=e[d+"Month"](),y=e[d+"FullYear"](),w=e[d+"Hours"](),b=e[d+"Minutes"](),v=e[d+"Seconds"](),_=e[d+"Milliseconds"](),E=r?0:e.getTimezoneOffset(),S=l(e),I=f(e),T={d:p,dd:u(p),ddd:c.i18n.dayNames[g],dddd:c.i18n.dayNames[g+7],m:m+1,mm:u(m+1),mmm:c.i18n.monthNames[m],mmmm:c.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:w%12||12,hh:u(w%12||12),H:w,HH:u(w),M:b,MM:u(b),s:v,ss:u(v),l:u(_,3),L:u(Math.round(_/10)),t:w<12?c.i18n.timeNames[0]:c.i18n.timeNames[1],tt:w<12?c.i18n.timeNames[2]:c.i18n.timeNames[3],T:w<12?c.i18n.timeNames[4]:c.i18n.timeNames[5],TT:w<12?c.i18n.timeNames[6]:c.i18n.timeNames[7],Z:n?"GMT":r?"UTC":(String(e).match(s)||[""]).pop().replace(a,""),o:(E>0?"-":"+")+u(100*Math.floor(Math.abs(E)/60)+Math.abs(E)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:S,N:I};return t.replace(o,(function(e){return e in T?T[e]:e.slice(1,e.length-1)}))});function u(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function l(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var i=(t-r)/6048e5;return 1+Math.floor(i)}function f(e){var t=e.getDay();return 0===t&&(t=7),t}function h(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}c.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(n=function(){return c}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=r(86),o=r(20),s=r(5);r(99);const a=r(38);var c=r(38);t.Connection=c.Connection;var u=r(39);t.DataAndMoneyStream=u.DataAndMoneyStream;var l=r(119);t.Server=l.Server,t.createServer=l.createServer,t.createConnection=function(t){return n(this,void 0,void 0,(function*(){const r=t.plugin;yield r.connect();const c=s.default("ilp-protocol-stream:Client"),{clientAddress:u,assetCode:l,assetScale:f}=yield i.fetch(r.sendData.bind(r),{expiresAt:t.getExpiry&&t.getExpiry("peer.config")}),h=yield a.Connection.build(Object.assign(Object.assign({},t),{sourceAccount:u,assetCode:l,assetScale:f,isServer:!1,plugin:r}));return r.registerDataHandler(t=>n(this,void 0,void 0,(function*(){let r;try{r=o.deserializeIlpPrepare(t)}catch(r){return c.error("got data that is not an ILP Prepare packet: %h",t),o.serializeIlpReject({code:"F00",message:"Expected an ILP Prepare packet (type 12), but got packet with type: "+t[0],data:e.alloc(0),triggeredBy:u})}try{const e=yield h.handlePrepare(r);return o.serializeIlpFulfill(e)}catch(t){return t.ilpErrorCode||c.error("error handling prepare:",t),o.serializeIlpReject({code:t.ilpErrorCode||"F00",message:t.ilpErrorMessage||"",data:t.ilpErrorData||e.alloc(0),triggeredBy:u})}}))),h.once("close",()=>{r.deregisterDataHandler(),r.disconnect().then(()=>c.info("plugin disconnected")).catch(e=>c.error("error disconnecting plugin:",e))}),yield h.connect(),h}))}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(87),i=r(18),o=r(95)("ilp-protocol-ildcp"),s=e.alloc(32),a=e.from("Zmh6rfhivXdsj8GLjp+OIAiXFIVu4jOzkCpZHQ1fKSU=","base64"),c=e=>{const t=n.deserializeIlpPrepare(e);if("peer.config"!==t.destination)throw new TypeError("packet is not an IL-DCP request.");if(!a.equals(t.executionCondition))throw new Error("packet does not contain correct condition for a peer protocol request.");if(Date.now()>Number(t.expiresAt))throw new Error("IL-DCP request packet is expired.");return{expiresAt:t.expiresAt,data:t.data}};t.deserializeIldcpRequest=c;const u=t=>n.serializeIlpPrepare({amount:"0",destination:"peer.config",executionCondition:a,expiresAt:t.expiresAt||new Date(Date.now()+6e4),data:t.data||e.alloc(0)});t.serializeIldcpRequest=u;const l=e=>{const{fulfillment:t,data:r}=n.deserializeIlpFulfill(e);if(!s.equals(t))throw new Error("IL-DCP response does not contain the expected fulfillment.");const o=i.Reader.from(r);return{clientAddress:o.readVarOctetString().toString("ascii"),assetScale:o.readUInt8Number(),assetCode:o.readVarOctetString().toString("utf8")}};t.deserializeIldcpResponse=l;const f=(e,t,r,n)=>{e.writeVarOctetString(t),e.writeUInt8(r),e.writeVarOctetString(n)},h=t=>{const r=e.from(t.clientAddress,"ascii"),o=e.from(t.assetCode,"utf8"),a=new i.Predictor;f(a,r,t.assetScale,o);const c=new i.Writer(a.length);return f(c,r,t.assetScale,o),n.serializeIlpFulfill({fulfillment:s,data:c.getBuffer()})};t.serializeIldcpResponse=h;t.fetch=async(e,t)=>{const r=await e(u(t||{}));if(r[0]===n.Type.TYPE_ILP_REJECT){const{triggeredBy:e,message:t}=n.deserializeIlpReject(r);throw o("IL-DCP request rejected. triggeredBy=%s errorMessage=%s",e,t),new Error("IL-DCP failed: "+t)}if(r[0]!==n.Type.TYPE_ILP_FULFILL)throw o("invalid response type. type=%s",r[0]),new Error("IL-DCP error, unable to retrieve client configuration.");const{clientAddress:i,assetScale:s,assetCode:a}=l(r);return o("received client info. clientAddress=%s assetScale=%s assetCode=%s",i,s,a),{clientAddress:i,assetScale:s,assetCode:a}};t.serve=async({requestPacket:t,handler:r,serverAddress:i})=>{try{c(t);const e=await r({});return h(e)}catch(t){const r=t&&"object"==typeof t&&t.stack?t.stack:t;return o("error while handling ildcp request. error=%s",r),n.serializeIlpReject({code:"F00",message:t&&"object"==typeof t&&t.message?t.message:"unexpected error.",triggeredBy:i,data:e.alloc(0)})}}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(18),i=r(93),o=r(10),s=r(94);var a;function c(t){return e.isBuffer(t.fulfillment)&&e.isBuffer(t.data)}t.Errors=s,function(e){e[e.TYPE_ILP_PREPARE=12]="TYPE_ILP_PREPARE",e[e.TYPE_ILP_FULFILL=13]="TYPE_ILP_FULFILL",e[e.TYPE_ILP_REJECT=14]="TYPE_ILP_REJECT"}(a=t.Type||(t.Type={})),t.deserializeEnvelope=e=>{const t=n.Reader.from(e);return{type:t.readUInt8Number(),contents:t.readVarOctetString()}},t.serializeIlpPrepare=t=>{o(t.amount&&"string"==typeof t.amount,"amount must be a string"),o(e.isBuffer(t.executionCondition)&&32===t.executionCondition.length,"executionCondition must be a 32-byte buffer"),o(t.expiresAt&&t.expiresAt instanceof Date,"expiresAt must be a Date"),o("string"==typeof t.destination,"destination is required"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=e.from(i.dateToInterledgerTime(t.expiresAt),"ascii"),s=e.from(t.destination,"ascii"),c=8+i.INTERLEDGER_TIME_LENGTH+32+n.Predictor.measureVarOctetString(s.length)+n.Predictor.measureVarOctetString(t.data.length),u=1+n.Predictor.measureVarOctetString(c),l=new n.Writer(u);l.writeUInt8(a.TYPE_ILP_PREPARE);const f=l.createVarOctetString(c);return f.writeUInt64(t.amount),f.write(r),f.write(t.executionCondition),f.writeVarOctetString(s),f.writeVarOctetString(t.data),l.getBuffer()},t.deserializeIlpPrepare=e=>{const{type:r,contents:o}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_PREPARE)throw new Error("Packet has incorrect type");const s=n.Reader.from(o),c=s.readUInt64(),u=i.interledgerTimeToDate(s.read(i.INTERLEDGER_TIME_LENGTH).toString("ascii"));return{amount:c,executionCondition:s.read(32),expiresAt:u,destination:s.readVarOctetString().toString("ascii"),data:s.readVarOctetString()}},t.isPrepare=function(t){return"string"==typeof t.amount&&void 0!==t.expiresAt&&"string"==typeof t.destination&&e.isBuffer(t.executionCondition)&&e.isBuffer(t.data)},t.isFulfill=c,t.isReject=function(t){return"string"==typeof t.code&&"string"==typeof t.triggeredBy&&"string"==typeof t.message&&e.isBuffer(t.data)},t.serializeIlpFulfill=t=>{o(e.isBuffer(t.fulfillment)&&32===t.fulfillment.length,"fulfillment must be a 32-byte buffer"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=32+n.Predictor.measureVarOctetString(t.data.length),i=1+n.Predictor.measureVarOctetString(r),s=new n.Writer(i);s.writeUInt8(a.TYPE_ILP_FULFILL);const c=s.createVarOctetString(r);return c.write(t.fulfillment),c.writeVarOctetString(t.data),s.getBuffer()},t.deserializeIlpFulfill=e=>{const{type:r,contents:i}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_FULFILL)throw new Error("Packet has incorrect type");const o=n.Reader.from(i);return{fulfillment:o.read(32),data:o.readVarOctetString()}};const u=e.alloc(0);t.serializeIlpReject=t=>{o(t.code&&"string"==typeof t.code,"code must be a string"),o("string"==typeof t.triggeredBy,"triggeredBy must be a string"),o("string"==typeof t.message,"message must be a string"),o(!t.data||e.isBuffer(t.data),"data must be a buffer");const r=e.from(t.code,"ascii");if(3!==r.length)throw new Error("ILP error codes must be three bytes long, received: "+t.code);const i=e.from(t.triggeredBy,"ascii"),s=e.from(t.message,"utf8"),c=t.data||u,l=3+n.Predictor.measureVarOctetString(i.length)+n.Predictor.measureVarOctetString(s.length)+n.Predictor.measureVarOctetString(c.length),f=1+n.Predictor.measureVarOctetString(l),h=new n.Writer(f);h.writeUInt8(a.TYPE_ILP_REJECT);const d=h.createVarOctetString(l);return d.write(r),d.writeVarOctetString(i),d.writeVarOctetString(s),d.writeVarOctetString(c),h.getBuffer()},t.deserializeIlpReject=e=>{const{type:r,contents:i}=t.deserializeEnvelope(e);if(+r!==a.TYPE_ILP_REJECT)throw new Error("Packet has incorrect type");const o=n.Reader.from(i);return{code:o.read(3).toString("ascii"),triggeredBy:o.readVarOctetString().toString("ascii"),message:o.readVarOctetString().toString("utf8"),data:o.readVarOctetString()}},t.serializeIlpPacket=e=>{switch(e.type){case a.TYPE_ILP_PREPARE:return t.serializeIlpPrepare(e.data);case a.TYPE_ILP_FULFILL:return t.serializeIlpFulfill(e.data);case a.TYPE_ILP_REJECT:return t.serializeIlpReject(e.data);default:throw new Error("Object has invalid type")}},t.deserializeIlpPacket=e=>{if(e[0]===a.TYPE_ILP_PREPARE)return{type:e[0],typeString:"ilp_prepare",data:t.deserializeIlpPrepare(e)};if(e[0]===a.TYPE_ILP_FULFILL)return{type:e[0],typeString:"ilp_fulfill",data:t.deserializeIlpFulfill(e)};if(e[0]===a.TYPE_ILP_REJECT)return{type:e[0],typeString:"ilp_reject",data:t.deserializeIlpReject(e)};throw new Error("Packet has invalid type")},t.deserializeIlpReply=function(e){return t.deserializeIlpPacket(e).data},t.serializeIlpReply=function(e){return c(e)?t.serializeIlpFulfill(e):t.serializeIlpReject(e)},t.errorToReject=(r,n)=>t.serializeIlpReject({code:n.ilpErrorCode||"F00",triggeredBy:r,message:n.message||"",data:n.ilpErrorData||e.alloc(0)}),t.errorToIlpReject=(t,r)=>({code:r.ilpErrorCode||"F00",triggeredBy:t,message:r.message||"",data:r.ilpErrorData||e.alloc(0)})}).call(this,r(0).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(89),i=r(90),o=r(2),s=r(19);class a{constructor(e){this.buffer=e,this.cursor=0,this.bookmarks=[]}static from(t){if(e.isBuffer(t))return new a(t);if(t instanceof a)return new a(t.buffer.slice(t.cursor));throw new Error("Reader must be given a Buffer")}bookmark(){this.bookmarks.push(this.cursor)}restore(){if(!this.bookmarks.length)throw new Error("Cannot restore bookmark when no bookmark set");this.cursor=this.bookmarks.pop()}ensureAvailable(e){if(this.buffer.length<this.cursor+e)throw new n.UnderflowError("Tried to read "+e+" bytes, but only "+(this.buffer.length-this.cursor)+" bytes available")}readUIntNumber(e){if(e<1)throw new Error("UInt length must be greater than zero");if(s.MAX_SAFE_BYTES<e)throw new Error("Value does not fit a JS number without sacrificing precision");{const t=this.buffer.readUIntBE(this.cursor,e);return this.cursor+=e,t}}readUIntLong(e){const t=this.peekUIntLong(e);return this.cursor+=e,t}readUInt(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.readUIntNumber(e)):this.readUIntLong(e).toString()}peekUIntNumber(e){if(e>=1&&e<=s.MAX_SAFE_BYTES)return this.buffer.readUIntBE(this.cursor,e);throw new Error("Value does not fit a JS number without sacrificing precision")}peekUIntLong(e){if(0===e)return o.UZERO;if(e<0)throw new Error("Tried to read integer with negative length (provided: "+e+")");if(e>8)throw new Error("UInts longer than 8 bytes must be encoded as VarUInts");return s.bufferToLong(this.peek(e),!0)}peekUInt(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.peekUIntNumber(e)):this.peekUIntLong(e).toString()}skipUInt(e){this.skip(e)}readIntNumber(e){if(e<1)throw new Error("Int length must be greater than zero");if(s.MAX_SAFE_BYTES<e)throw new Error("Value does not fit a JS number without sacrificing precision");{const t=this.buffer.readIntBE(this.cursor,e);return this.cursor+=e,t}}readIntLong(e){const t=this.peekIntLong(e);return this.cursor+=e,t}readInt(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.readIntNumber(e)):this.readIntLong(e).toString()}peekIntNumber(e){if(e>=1&&e<=s.MAX_SAFE_BYTES)return this.buffer.readIntBE(this.cursor,e);throw new Error("Value does not fit a JS number without sacrificing precision")}peekIntLong(e){if(0===e)return o.ZERO;if(e<0)throw new Error("Tried to read integer with negative length (provided: "+e+")");if(e>8)throw new Error("Ints longer than 8 bytes must be encoded as VarInts");return s.bufferToLong(this.peek(e),!1)}peekInt(e){return e>=1&&e<=s.MAX_SAFE_BYTES?String(this.peekIntNumber(e)):this.peekIntLong(e).toString()}skipInt(e){this.skip(e)}readVarUIntNumber(){if(0===this.buffer[this.cursor])throw new i.ParseError("UInt of length 0 is invalid");if(this.buffer[this.cursor]<=s.MAX_SAFE_BYTES)return this.readUIntNumber(this.buffer[this.cursor++]);throw new Error("Value does not fit a JS number without sacrificing precision")}readVarUIntLong(){const e=this.readVarOctetString();if(0===e.length)throw new i.ParseError("UInt of length 0 is invalid");return s.bufferToLong(e,!0)}readVarUInt(){return this.readVarUIntLong().toString()}peekVarUIntNumber(){this.bookmark();const e=this.readVarUIntNumber();return this.restore(),e}peekVarUIntLong(){this.bookmark();const e=this.readVarUIntLong();return this.restore(),e}peekVarUInt(){return this.peekVarUIntLong().toString()}skipVarUInt(){this.skipVarOctetString()}readVarIntNumber(){if(0===this.buffer[this.cursor])throw new i.ParseError("Int of length 0 is invalid");if(this.buffer[this.cursor]<=s.MAX_SAFE_BYTES)return this.readIntNumber(this.buffer[this.cursor++]);throw new Error("Value does not fit a JS number without sacrificing precision")}readVarIntLong(){const e=this.readVarOctetString();if(0===e.length)throw new i.ParseError("Int of length 0 is invalid");return s.bufferToLong(e,!1)}readVarInt(){return this.readVarIntLong().toString()}peekVarIntNumber(){this.bookmark();const e=this.readVarIntNumber();return this.restore(),e}peekVarIntLong(){this.bookmark();const e=this.readVarIntLong();return this.restore(),e}peekVarInt(){return this.peekVarIntLong().toString()}skipVarInt(){this.skipVarOctetString()}readOctetString(e){return this.read(e)}peekOctetString(e){return this.peek(e)}skipOctetString(e){return this.skip(e)}readLengthPrefix(){const e=this.readUInt8Number();if(e&a.HIGH_BIT){const t=e&a.LOWER_SEVEN_BITS,r=t&&this.readUIntNumber(t),n=Math.max(128,1<<8*(t-1));if(0===t||r<n)throw new i.ParseError("Length prefix encoding is not canonical: "+r+" encoded in "+t+" bytes");return r}return e}readVarOctetString(){const e=this.readLengthPrefix();return this.read(e)}peekVarOctetString(){this.bookmark();const e=this.readVarOctetString();return this.restore(),e}skipVarOctetString(){const e=this.readLengthPrefix();this.skip(e)}read(e){this.ensureAvailable(e);const t=this.buffer.slice(this.cursor,this.cursor+e);return this.cursor+=e,t}peek(e){return this.ensureAvailable(e),this.buffer.slice(this.cursor,this.cursor+e)}skip(e){this.ensureAvailable(e),this.cursor+=e}}a.HIGH_BIT=128,a.LOWER_SEVEN_BITS=127,["read","peek","skip"].forEach(e=>{[1,2,4,8].forEach(t=>{a.prototype[e+"UInt"+8*t]=function(){return this[e+"UInt"](t)},a.prototype[e+"Int"+8*t]=function(){return this[e+"Int"](t)},"skip"!==e&&(a.prototype[e+"UInt"+8*t+"Number"]=function(){return this[e+"UIntNumber"](t)},a.prototype[e+"Int"+8*t+"Number"]=function(){return this[e+"IntNumber"](t)},a.prototype[e+"UInt"+8*t+"Long"]=function(){return this[e+"UIntLong"](t)},a.prototype[e+"Int"+8*t+"Long"]=function(){return this[e+"IntLong"](t)})})}),t.default=a}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(36);class i extends n.default{}t.UnderflowError=i,t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(36);class i extends n.default{}t.ParseError=i,t.default=i},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(19);class i{constructor(t){e.isBuffer(t)?(this.buffer=t,this.strict=!0):(this.buffer=e.alloc(t||0),this.strict="number"==typeof t),this._offset=0}get length(){return this._offset}writeUInt(e,t){if(!n.isInteger(e))throw new Error("UInt must be an integer");if("number"==typeof e&&e>i.MAX_SAFE_INTEGER)throw new Error("UInt is larger than safe JavaScript range (try using Longs instead)");if(t<=0)throw new Error("UInt length must be greater than zero");if(n.isLong(e)&&!e.unsigned)throw new Error("Expected unsigned Long");if(t<=n.MAX_SAFE_BYTES){const r=Number(e);if(r<0)throw new Error("UInt must be positive");if(r>i.UINT_RANGES[t])throw new Error(`UInt ${e} does not fit in ${t} bytes`);const n=this.advance(t);this.buffer.writeUIntBE(r,n,t)}else{const r=n.longFromValue(e,!0);if(t<n.getLongUIntBufferSize(r))throw new Error(`UInt ${r} does not fit in ${t} bytes`);this.write(n.longToBuffer(r,t))}}writeInt(e,t){if(!n.isInteger(e))throw new Error("Int must be an integer");if(t<=0)throw new Error("Int length must be greater than zero");if("number"==typeof e&&e>i.MAX_SAFE_INTEGER)throw new Error("Int is larger than safe JavaScript range (try using Longs instead)");if("number"==typeof e&&e<i.MIN_SAFE_INTEGER)throw new Error("Int is smaller than safe JavaScript range (try using Longs instead)");if(n.isLong(e)&&e.unsigned)throw new Error("Expected signed Long");if(t<=n.MAX_SAFE_BYTES){const r=Number(e);if(r<i.INT_RANGES[t][0]||r>i.INT_RANGES[t][1])throw new Error("Int "+e+" does not fit in "+t+" bytes");const n=this.advance(t);this.buffer.writeIntBE(r,n,t)}else{const r=n.longFromValue(e,!1);if(t<n.getLongIntBufferSize(r))throw new Error("Int "+r+" does not fit in "+t+" bytes");this.write(n.longToBuffer(r,t))}}writeVarUInt(t){if(e.isBuffer(t))return void this.writeVarOctetString(t);if(!n.isInteger(t))throw new Error("UInt must be an integer");let r,i;"number"==typeof t?(r=t,i=n.getUIntBufferSize(r)):(r=n.longFromValue(t,!0),i=n.getLongUIntBufferSize(r)),this.createVarOctetString(i).writeUInt(r,i)}writeVarInt(t){if(e.isBuffer(t))return void this.writeVarOctetString(t);if(!n.isInteger(t))throw new Error("Int must be an integer");if("number"==typeof t&&t>i.MAX_SAFE_INTEGER)throw new Error("Int is larger than safe JavaScript range");if("number"==typeof t&&t<i.MIN_SAFE_INTEGER)throw new Error("Int is smaller than safe JavaScript range");let r,o;"number"==typeof t?(r=t,o=n.getIntBufferSize(r)):(r=n.longFromValue(t,!1),o=n.getLongIntBufferSize(r)),this.createVarOctetString(o).writeInt(r,o)}writeOctetString(e,t){if(e.length!==t)throw new Error("Incorrect length for octet string (actual: "+e.length+", expected: "+t+")");this.write(e)}writeVarOctetString(t){if(!e.isBuffer(t))throw new TypeError("Expects a buffer");this._writeLengthPrefix(t.length),this.write(t)}createVarOctetString(e){if(e<0)throw new Error("length must be non-negative");this._writeLengthPrefix(e);const t=this.advance(e),r=this.buffer.slice(t,t+e);return new i(r)}_writeLengthPrefix(e){if(e<=127)this.writeUInt8(e);else{const t=n.getUIntBufferSize(e);this.writeUInt8(128|t),this.writeUInt(e,t)}}write(e){const t=this.advance(e.length);e.copy(this.buffer,t)}getBuffer(){return this.buffer.slice(0,this._offset)}advance(t){const r=this._offset,n=r+t;if(n<=this.buffer.length)return this._offset+=t,r;if(this.strict)throw new Error("writer cannot exceed capacity");let o=this.buffer.length||i.MIN_BUFFER_SIZE;for(;o<n;)o*=2;const s=e.alloc(o);return this.buffer.length&&this.buffer.copy(s),this.buffer=s,this._offset+=t,r}}i.MAX_SAFE_INTEGER=9007199254740991,i.MIN_SAFE_INTEGER=-9007199254740991,i.MIN_BUFFER_SIZE=32,i.UINT_RANGES={1:255,2:65535,3:16777215,4:4294967295,5:0xffffffffff,6:0xffffffffffff},i.INT_RANGES={1:[-128,127],2:[-32768,32767],3:[-8388608,8388607],4:[-2147483648,2147483647],5:[-549755813888,549755813887],6:[-0x800000000000,0x7fffffffffff]},[1,2,4,8].forEach(e=>{i.prototype["writeUInt"+8*e]=function(t){this.writeUInt(t,e)},i.prototype["writeInt"+8*e]=function(t){this.writeInt(t,e)}}),t.default=i}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(19);class i{constructor(){this.size=0}get length(){return this.size}writeUInt(e,t){this.size+=t}writeInt(e,t){this.size+=t}writeVarUInt(e){if(!n.isInteger(e))throw new Error("UInt must be an integer");let t;if("number"==typeof e){if(e<0)throw new Error("UInt must be positive");t=n.getUIntBufferSize(e)}else{const r=n.longFromValue(e,!0);t=n.getLongUIntBufferSize(r)}this.skipVarOctetString(t)}writeVarInt(e){if(!n.isInteger(e))throw new Error("UInt must be an integer");let t;if("number"==typeof e)t=n.getIntBufferSize(e);else{const r=n.longFromValue(e,!1);t=n.getLongIntBufferSize(r)}this.skipVarOctetString(t)}writeOctetString(e,t){if(e.length!==t)throw new Error("Incorrect length for octet string (actual: "+e.length+", expected: "+t+")");this.skip(t)}writeVarOctetString(e){this.skipVarOctetString(e.length)}createVarOctetString(e){return this.skipVarOctetString(e),new i}write(e){this.size+=e.length}skip(e){this.size+=e}getSize(){return this.size}static measureVarOctetString(e){let t=1;if(e>127){t+=n.getUIntBufferSize(e)}return t+=e,t}skipVarOctetString(e){this.skip(i.measureVarOctetString(e))}}[1,2,4,8].forEach(e=>{i.prototype["writeUInt"+8*e]=function(t){return this.writeUInt(t,e)},i.prototype["writeInt"+8*e]=function(t){return this.writeUInt(t,e)}}),t.default=i},function(e,t,r){"use strict";function n(e){return e<10?"0"+e:String(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.dateToInterledgerTime=e=>e.getUTCFullYear()+n(e.getUTCMonth()+1)+n(e.getUTCDate())+n(e.getUTCHours())+n(e.getUTCMinutes())+n(e.getUTCSeconds())+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5),t.INTERLEDGER_TIME_LENGTH=17,t.interledgerTimeToDate=e=>{const t=new Date(Date.UTC(+e.slice(0,4),+e.slice(4,6)-1,+e.slice(6,8),+e.slice(8,10),+e.slice(10,12),+e.slice(12,14),+e.slice(14,17)));if(!t.valueOf())throw new Error("invalid date");return t},t.dateToGeneralizedTime=e=>e.toISOString().replace(/[-T:]/g,""),t.GENERALIZED_TIME_REGEX=/^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2}\.[0-9]{3}Z)$/,t.generalizedTimeToDate=e=>{const r=e.replace(t.GENERALIZED_TIME_REGEX,"$1-$2-$3T$4:$5:$6"),n=new Date(r);if(!n.valueOf())throw new Error("invalid date");return n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(18),i=r(37);t.codes={F00_BAD_REQUEST:"F00",F01_INVALID_PACKET:"F01",F02_UNREACHABLE:"F02",F03_INVALID_AMOUNT:"F03",F04_INSUFFICIENT_DESTINATION_AMOUNT:"F04",F05_WRONG_CONDITION:"F05",F06_UNEXPECTED_PAYMENT:"F06",F07_CANNOT_RECEIVE:"F07",F08_AMOUNT_TOO_LARGE:"F08",F99_APPLICATION_ERROR:"F99",T00_INTERNAL_ERROR:"T00",T01_PEER_UNREACHABLE:"T01",T02_PEER_BUSY:"T02",T03_CONNECTOR_BUSY:"T03",T04_INSUFFICIENT_LIQUIDITY:"T04",T05_RATE_LIMITED:"T05",T99_APPLICATION_ERROR:"T99",R00_TRANSFER_TIMED_OUT:"R00",R01_INSUFFICIENT_SOURCE_AMOUNT:"R01",R02_INSUFFICIENT_TIMEOUT:"R02",R99_APPLICATION_ERROR:"R99"};t.BadRequestError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F00_BAD_REQUEST}};t.InvalidPacketError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F01_INVALID_PACKET}};t.UnreachableError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F02_UNREACHABLE}};t.InvalidAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F03_INVALID_AMOUNT}};t.InsufficientDestinationAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F04_INSUFFICIENT_DESTINATION_AMOUNT}};t.WrongConditionError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F05_WRONG_CONDITION}};t.UnexpectedPaymentError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F06_UNEXPECTED_PAYMENT}};t.CannotReceiveError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F07_CANNOT_RECEIVE}};t.AmountTooLargeError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.F08_AMOUNT_TOO_LARGE;const i=new n.Writer(16);i.writeUInt64(r.receivedAmount),i.writeUInt64(r.maximumAmount),this.ilpErrorData=i.getBuffer()}};t.FinalApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.F99_APPLICATION_ERROR,this.ilpErrorData=r}};t.InternalError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T00_INTERNAL_ERROR}};t.PeerUnreachableError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T01_PEER_UNREACHABLE}};t.PeerBusyError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T02_PEER_BUSY}};t.ConnectorBusyError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T03_CONNECTOR_BUSY}};t.InsufficientLiquidityError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T04_INSUFFICIENT_LIQUIDITY}};t.RateLimitedError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T05_RATE_LIMITED}};t.TemporaryApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.T99_APPLICATION_ERROR,this.ilpErrorData=r}};t.TransferTimedOutError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R00_TRANSFER_TIMED_OUT}};t.InsufficientSourceAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R01_INSUFFICIENT_SOURCE_AMOUNT}};t.InsufficientTimeoutError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R02_INSUFFICIENT_TIMEOUT}};t.RelativeApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.R99_APPLICATION_ERROR,this.ilpErrorData=r}}},function(e,t,r){"use strict";(function(n,i){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===(void 0===n?"undefined":o(n))&&n.log&&(e=n).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(96)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(3),r(1))},function(e,t,r){"use strict";e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){var r;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(r||a);o.diff=c,o.prev=r,o.curr=a,r=a,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var i=n.formatters[r];if("function"==typeof i){var s=t[u];e=i.call(o,s),t.splice(u,1),u--}return e})),n.formatArgs.call(o,t);var l=o.log||n.log;l.apply(o,t)}}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function i(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){return n(this.namespace+(void 0===t?":":t)+e)}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){n.enable("")},n.enable=function(e){var t;n.save(e),n.names=[],n.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){var o=n.instances[t];o.enabled=n.enabled(o.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(16),Object.keys(e).forEach((function(t){n[t]=e[t]})),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t,r){"use strict";function n(e){return e<10?"0"+e:String(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.dateToInterledgerTime=e=>e.getUTCFullYear()+n(e.getUTCMonth()+1)+n(e.getUTCDate())+n(e.getUTCHours())+n(e.getUTCMinutes())+n(e.getUTCSeconds())+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5),t.INTERLEDGER_TIME_LENGTH=17,t.interledgerTimeToDate=e=>{const t=new Date(Date.UTC(+e.slice(0,4),+e.slice(4,6)-1,+e.slice(6,8),+e.slice(8,10),+e.slice(10,12),+e.slice(12,14),+e.slice(14,17)));if(!t.valueOf())throw new Error("invalid date");return t},t.dateToGeneralizedTime=e=>e.toISOString().replace(/[\-T:]/g,""),t.GENERALIZED_TIME_REGEX=/^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2}\.[0-9]{3}Z)$/,t.generalizedTimeToDate=e=>{const r=e.replace(t.GENERALIZED_TIME_REGEX,"$1-$2-$3T$4:$5:$6"),n=new Date(r);if(!n.valueOf())throw new Error("invalid date");return n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(8),i=r(37);t.codes={F00_BAD_REQUEST:"F00",F01_INVALID_PACKET:"F01",F02_UNREACHABLE:"F02",F03_INVALID_AMOUNT:"F03",F04_INSUFFICIENT_DESTINATION_AMOUNT:"F04",F05_WRONG_CONDITION:"F05",F06_UNEXPECTED_PAYMENT:"F06",F07_CANNOT_RECEIVE:"F07",F08_AMOUNT_TOO_LARGE:"F08",F99_APPLICATION_ERROR:"F99",T00_INTERNAL_ERROR:"T00",T01_PEER_UNREACHABLE:"T01",T02_PEER_BUSY:"T02",T03_CONNECTOR_BUSY:"T03",T04_INSUFFICIENT_LIQUIDITY:"T04",T05_RATE_LIMITED:"T05",T99_APPLICATION_ERROR:"T99",R00_TRANSFER_TIMED_OUT:"R00",R01_INSUFFICIENT_SOURCE_AMOUNT:"R01",R02_INSUFFICIENT_TIMEOUT:"R02",R99_APPLICATION_ERROR:"R99"};t.BadRequestError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F00_BAD_REQUEST}};t.InvalidPacketError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F01_INVALID_PACKET}};t.UnreachableError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F02_UNREACHABLE}};t.InvalidAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F03_INVALID_AMOUNT}};t.InsufficientDestinationAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F04_INSUFFICIENT_DESTINATION_AMOUNT}};t.WrongConditionError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F05_WRONG_CONDITION}};t.UnexpectedPaymentError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F06_UNEXPECTED_PAYMENT}};t.CannotReceiveError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.F07_CANNOT_RECEIVE}};t.AmountTooLargeError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.F08_AMOUNT_TOO_LARGE;const i=new n.Writer(16);i.writeUInt64(r.receivedAmount),i.writeUInt64(r.maximumAmount),this.ilpErrorData=i.getBuffer()}};t.FinalApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.F99_APPLICATION_ERROR,this.ilpErrorData=r}};t.InternalError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T00_INTERNAL_ERROR}};t.PeerUnreachableError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T01_PEER_UNREACHABLE}};t.PeerBusyError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T02_PEER_BUSY}};t.ConnectorBusyError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T03_CONNECTOR_BUSY}};t.InsufficientLiquidityError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T04_INSUFFICIENT_LIQUIDITY}};t.RateLimitedError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.T05_RATE_LIMITED}};t.TemporaryApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.T99_APPLICATION_ERROR,this.ilpErrorData=r}};t.TransferTimedOutError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R00_TRANSFER_TIMED_OUT}};t.InsufficientSourceAmountError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R01_INSUFFICIENT_SOURCE_AMOUNT}};t.InsufficientTimeoutError=class extends i{constructor(e){super(e),this.ilpErrorCode=t.codes.R02_INSUFFICIENT_TIMEOUT}};t.RelativeApplicationError=class extends i{constructor(e,r){super(e),this.ilpErrorCode=t.codes.R99_APPLICATION_ERROR,this.ilpErrorData=r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(5).formatters.h=e=>e.toString("hex")},function(e,t,r){e.exports=i;var n=r(7).EventEmitter;function i(){n.call(this)}r(9)(i,n),i.Readable=r(21),i.Writable=r(107),i.Duplex=r(108),i.Transform=r(109),i.PassThrough=r(110),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",a),r.removeListener("close",c),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",l),r.removeListener("close",l),e.removeListener("close",l)}return r.on("error",u),e.on("error",u),r.on("end",l),r.on("close",l),e.on("close",l),e.emit("pipe",r),e}},function(e,t){},function(e,t,r){"use strict";var n=r(22).Buffer,i=r(103);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=o,i=a,t.copy(r,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,r){(function(t,r){function n(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,r){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(r);n("traceDeprecation")?t.trace(r):t.warn(r),i=!0}return e.apply(this,arguments)}}}).call(this,r(3),r(4))},function(e,t,r){var n=r(0),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";e.exports=o;var n=r(44),i=Object.create(r(11));function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=r(9),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){e.exports=r(6)},function(e,t,r){e.exports=r(21).Transform},function(e,t,r){e.exports=r(21).PassThrough},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,r){this.data=e,this.callback=t,this.next=r}}t.DataQueue=class{constructor(){this.length=0}push(e,t){const n=new r(e,t);this.tail?this.tail.next=n:this.head=n,this.tail=n,this.length+=1}shift(){if(!this.head)return null;const e=this.head.data;return 1===this.length?this.head=this.tail=void 0:this.head=this.head.next,this.length-=1,e}read(t){if(!this.head)return;let r=t;const n=[];for(;r>0&&this.length>0;){let e=this.head.data;e.length>r?(this.head.data=e.slice(r),e=e.slice(0,r),n.push(e),r-=e.length):(n.push(e),r-=e.length,this.head&&this.head.callback&&this.head.callback(),this.shift())}return e.concat(n)}isEmpty(){return 0===this.length}byteLength(){let e=0,t=this.head;for(;t;)e+=t.data.length,t=t.next;return e}}}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t,r){this.data=e,this.offset=t,this.next=r}}t.OffsetSorter=class{constructor(){this.readOffset=0,this.maxOffset=0}push(e,t){const r=new n(e,t);if(this.maxOffset=Math.max(t+e.length,this.maxOffset),this.head)if(this.head.offset>t)r.next=this.head,this.head=r;else{let e=this.head;for(;;){if(!e.next){e.next=r;break}if(e.next.offset>t){r.next=e.next,e.next=r;break}e=e.next}}else this.head=r}read(){let e;return this.head&&this.readOffset===this.head.offset&&(e=this.head.data,this.readOffset=this.head.offset+(e?e.length:0),this.head=this.head.next),e}byteLength(){let e=0,t=this.head,r=this.readOffset;for(;t&&t.offset===r;)e+=t.data.length,r+=t.data.length,t=t.next;return e}}},function(e,t,r){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=r(8),o=r(20),s=r(2),a=r(45),c=r(12),u=s.fromNumber(1,!0),l=e.alloc(32);var f;t.IlpPacketType={Prepare:o.Type.TYPE_ILP_PREPARE,Fulfill:o.Type.TYPE_ILP_FULFILL,Reject:o.Type.TYPE_ILP_REJECT},function(e){e[e.NoError=1]="NoError",e[e.InternalError=2]="InternalError",e[e.EndpointBusy=3]="EndpointBusy",e[e.FlowControlError=4]="FlowControlError",e[e.StreamIdError=5]="StreamIdError",e[e.StreamStateError=6]="StreamStateError",e[e.FrameFormatError=7]="FrameFormatError",e[e.ProtocolViolation=8]="ProtocolViolation",e[e.ApplicationError=9]="ApplicationError"}(t.ErrorCode||(t.ErrorCode={})),function(e){e[e.ConnectionClose=1]="ConnectionClose",e[e.ConnectionNewAddress=2]="ConnectionNewAddress",e[e.ConnectionMaxData=3]="ConnectionMaxData",e[e.ConnectionDataBlocked=4]="ConnectionDataBlocked",e[e.ConnectionMaxStreamId=5]="ConnectionMaxStreamId",e[e.ConnectionStreamIdBlocked=6]="ConnectionStreamIdBlocked",e[e.ConnectionAssetDetails=7]="ConnectionAssetDetails",e[e.StreamClose=16]="StreamClose",e[e.StreamMoney=17]="StreamMoney",e[e.StreamMaxMoney=18]="StreamMaxMoney",e[e.StreamMoneyBlocked=19]="StreamMoneyBlocked",e[e.StreamData=20]="StreamData",e[e.StreamMaxData=21]="StreamMaxData",e[e.StreamDataBlocked=22]="StreamDataBlocked"}(f=t.FrameType||(t.FrameType={}));class h{constructor(e,t,r=s.UZERO,n=[]){this.sequence=c.longFromValue(e,!0),this.ilpPacketType=t,this.prepareAmount=c.longFromValue(r,!0),this.frames=n}static decryptAndDeserialize(e,t){return n(this,void 0,void 0,(function*(){let r;try{r=yield a.decrypt(e,t)}catch(e){throw new Error("Unable to decrypt packet. Data was corrupted or packet was encrypted with the wrong key")}return h._deserializeUnencrypted(r)}))}static _deserializeUnencrypted(e){const t=i.Reader.from(e),r=t.readUInt8Long();if(!r.equals(u))throw new Error("Unsupported protocol version: "+r);const n=t.readUInt8Number(),o=t.readVarUIntLong(),s=t.readVarUIntLong(),a=t.readVarUIntNumber(),c=[];for(let e=0;e<a;e++){const e=x(t);e&&c.push(e)}return new h(o,n,s,c)}serializeAndEncrypt(e,t){const r=this._serialize();if(void 0!==t){const n=t-a.ENCRYPTION_OVERHEAD-r.length,i=[e,r];for(let e=0;e<Math.floor(n/32);e++)i.push(l);return i.push(l.slice(0,n%32)),a.encrypt.apply(null,i)}return a.encrypt(e,r)}_serialize(){const e=new i.Predictor;this.writeTo(e);const t=new i.Writer(e.length);return this.writeTo(t),t.getBuffer()}writeTo(e){e.writeUInt8(u),e.writeUInt8(this.ilpPacketType),e.writeVarUInt(this.sequence),e.writeVarUInt(this.prepareAmount),e.writeVarUInt(this.frames.length);for(let t of this.frames)t.writeTo(e)}byteLength(){const e=new i.Predictor;return this.writeTo(e),e.getSize()+a.ENCRYPTION_OVERHEAD}}t.Packet=h;class d{constructor(e){this.type=f[e],this.name=e}static fromContents(e){throw new Error('class method "fromContents" is not implemented')}writeTo(e){const t=new i.Predictor;return this.writeContentsTo(t),e.writeUInt8(this.type),this.writeContentsTo(e.createVarOctetString(t.length)),e}writeContentsTo(t){const r=Object.getOwnPropertyNames(this).filter(e=>"type"!==e&&"name"!==e);for(let n of r){const r=this[n];if("number"==typeof r)t.writeUInt8(r);else if("string"==typeof r)t.writeVarOctetString(e.from(r,"utf8"));else if(e.isBuffer(r))t.writeVarOctetString(r);else{if(!s.isLong(r))throw new Error(`Unexpected property type for property "${n}": ${typeof r}`);t.writeVarUInt(r)}}}byteLength(){const e=new i.Predictor;return this.writeTo(e),e.getSize()}}t.BaseFrame=d;class p extends d{constructor(e,t){super("ConnectionClose"),this.errorCode=e,this.errorMessage=t}static fromContents(e){const t=e.readUInt8Number(),r=e.readVarOctetString().toString();return new p(t,r)}}t.ConnectionCloseFrame=p;class g extends d{constructor(e){super("ConnectionNewAddress"),this.sourceAccount=e}static fromContents(e){const t=e.readVarOctetString().toString("utf8");return new g(t)}}t.ConnectionNewAddressFrame=g;class m extends d{constructor(e,t){super("ConnectionAssetDetails"),this.sourceAssetCode=e,this.sourceAssetScale=t}static fromContents(e){const t=e.readVarOctetString().toString("utf8"),r=e.readUInt8Number();return new m(t,r)}}t.ConnectionAssetDetailsFrame=m;class y extends d{constructor(e){super("ConnectionMaxData"),this.maxOffset=c.longFromValue(e,!0)}static fromContents(e){const t=e.readVarUIntLong();return new y(t)}}t.ConnectionMaxDataFrame=y;class w extends d{constructor(e){super("ConnectionDataBlocked"),this.maxOffset=c.longFromValue(e,!0)}static fromContents(e){const t=e.readVarUIntLong();return new w(t)}}t.ConnectionDataBlockedFrame=w;class b extends d{constructor(e){super("ConnectionMaxStreamId"),this.maxStreamId=c.longFromValue(e,!0)}static fromContents(e){const t=e.readVarUIntLong();return new b(t)}}t.ConnectionMaxStreamIdFrame=b;class v extends d{constructor(e){super("ConnectionStreamIdBlocked"),this.maxStreamId=c.longFromValue(e,!0)}static fromContents(e){const t=e.readVarUIntLong();return new v(t)}}t.ConnectionStreamIdBlockedFrame=v;class _ extends d{constructor(e,t,r){super("StreamClose"),this.streamId=c.longFromValue(e,!0),this.errorCode=t,this.errorMessage=r}static fromContents(e){const t=e.readVarUIntLong(),r=e.readUInt8Number(),n=e.readVarOctetString().toString("utf8");return new _(t,r,n)}}t.StreamCloseFrame=_;class E extends d{constructor(e,t){super("StreamMoney"),this.streamId=c.longFromValue(e,!0),this.shares=c.longFromValue(t,!0)}static fromContents(e){const t=e.readVarUIntLong(),r=e.readVarUIntLong();return new E(t,r)}}t.StreamMoneyFrame=E;class S extends d{constructor(e,t,r){super("StreamMaxMoney"),"number"!=typeof t||isFinite(t)||(t=s.MAX_UNSIGNED_VALUE),this.streamId=c.longFromValue(e,!0),this.receiveMax=c.longFromValue(t,!0),this.totalReceived=c.longFromValue(r,!0)}static fromContents(e){const t=e.readVarUIntLong(),r=O(e),n=e.readVarUIntLong();return new S(t,r,n)}}t.StreamMaxMoneyFrame=S;class I extends d{constructor(e,t,r){super("StreamMoneyBlocked"),this.streamId=c.longFromValue(e,!0),this.sendMax=c.longFromValue(t,!0),this.totalSent=c.longFromValue(r,!0)}static fromContents(e){const t=e.readVarUIntLong(),r=O(e),n=e.readVarUIntLong();return new I(t,r,n)}}t.StreamMoneyBlockedFrame=I;class T extends d{constructor(e,t,r){super("StreamData"),this.streamId=c.longFromValue(e,!0),this.offset=c.longFromValue(t,!0),this.data=r}static fromContents(e){const t=e.readVarUIntLong(),r=e.readVarUIntLong(),n=e.readVarOctetString();return new T(t,r,n)}toJSON(){return{type:this.type,name:this.name,streamId:this.streamId,offset:this.offset,dataLength:this.data.length}}}t.StreamDataFrame=T;class C extends d{constructor(e,t){super("StreamMaxData"),this.streamId=c.longFromValue(e,!0),this.maxOffset=c.longFromValue(t,!0)}static fromContents(e){const t=e.readVarUIntLong(),r=e.readVarUIntLong();return new C(t,r)}}t.StreamMaxDataFrame=C;class A extends d{constructor(e,t){super("StreamDataBlocked"),this.streamId=c.longFromValue(e,!0),this.maxOffset=c.longFromValue(t,!0)}static fromContents(e){const t=e.readVarUIntLong(),r=e.readVarUIntLong();return new A(t,r)}}function x(e){const t=e.readUInt8Number(),r=i.Reader.from(e.readVarOctetString());switch(t){case f.ConnectionClose:return p.fromContents(r);case f.ConnectionNewAddress:return g.fromContents(r);case f.ConnectionAssetDetails:return m.fromContents(r);case f.ConnectionMaxData:return y.fromContents(r);case f.ConnectionDataBlocked:return w.fromContents(r);case f.ConnectionMaxStreamId:return b.fromContents(r);case f.ConnectionStreamIdBlocked:return v.fromContents(r);case f.StreamClose:return _.fromContents(r);case f.StreamMoney:return E.fromContents(r);case f.StreamMaxMoney:return S.fromContents(r);case f.StreamMoneyBlocked:return I.fromContents(r);case f.StreamData:return T.fromContents(r);case f.StreamMaxData:return C.fromContents(r);case f.StreamDataBlocked:return A.fromContents(r);default:return}}function O(e){return e.peekVarOctetString().length>8?(e.skipVarOctetString(),s.MAX_UNSIGNED_VALUE):e.readVarUIntLong()}t.StreamDataBlockedFrame=A}).call(this,r(0).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(5),o=r(8),s=r(12),a=i.default("ilp-protocol-stream:Congestion");t.CongestionController=class{constructor(e){this._testMaximumPacketAmount=n.MAX_UNSIGNED_VALUE,this._maximumPacketAmount=n.MAX_UNSIGNED_VALUE,this._fixedPacketAmount=e.maximumPacketAmount||n.MAX_UNSIGNED_VALUE}get testMaximumPacketAmount(){return this._testMaximumPacketAmount}get maximumPacketAmount(){return s.minLong(this._maximumPacketAmount,this._fixedPacketAmount)}setMaximumAmounts(e){this._testMaximumPacketAmount=e,this._maximumPacketAmount=e}onFulfill(e){const t=this.maximumPacketAmount;if(!(e.equals(this._testMaximumPacketAmount)&&this._testMaximumPacketAmount.lessThan(t)))return;let r;if(t.notEquals(n.MAX_UNSIGNED_VALUE)){const e=t.divide(10);r=s.minLong(s.checkedAdd(this._testMaximumPacketAmount,e).sum,t),a.trace("last packet amount was successful (max packet amount: %s), raising packet amount from %s to: %s",t,this._testMaximumPacketAmount,r)}else r=s.checkedMultiply(this._testMaximumPacketAmount,n.fromNumber(2,!0)).product,a.trace("last packet amount was successful, unknown max packet amount, raising packet amount from: %s to: %s",this._testMaximumPacketAmount,r);this._testMaximumPacketAmount=r}onAmountTooLargeError(e,t){let r,n;try{const t=o.Reader.from(e.data);r=t.readUInt64Long(),n=t.readUInt64Long()}catch(e){r=void 0,n=void 0}if(r&&n&&r.greaterThan(n)){const e=s.multiplyDivideFloor(t,n,r);a.trace("reducing maximum packet amount from %s to %s",this._maximumPacketAmount,e),this._maximumPacketAmount=e,this._testMaximumPacketAmount=e}else this._maximumPacketAmount=t.subtract(1),this._testMaximumPacketAmount=this.maximumPacketAmount.divide(2);return this.maximumPacketAmount}onInsufficientLiquidityError(e,t){const r=s.minLong(t,this._testMaximumPacketAmount),i=r.subtract(r.divide(3));this._testMaximumPacketAmount=s.maxLong(n.fromNumber(2,!0),i),a.warn("got T04: Insufficient Liquidity error triggered by: %s reducing the packet amount to %s",e.triggeredBy,this._testMaximumPacketAmount)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(10),i=r(2),o=r(12);class s{constructor(e,t,r){if(!r)throw new Error("signed rationals are not implemented");n.strictEqual(e.unsigned,r,"numerator is incorrectly signed"),n.strictEqual(t.unsigned,r,"denominator is incorrectly signed"),n(!t.isZero(),"denominator must be non-zero"),this.a=e,this.b=t,this.unsigned=r}static isRational(e){return e instanceof s}static fromNumbers(e,t,r){return new s(i.fromNumber(e,r),i.fromNumber(t,r),r)}static fromNumber(e,t){if(!isFinite(e))throw new Error("value must be finite");if(t&&e<0)throw new Error("unsigned value must be positive");if(e%1==0)return s.fromNumbers(e,1,t);const r=Math.floor(Math.log(e)/Math.LN10);let n=r<0?18:18-r,i=1;for(;Math.floor(e*i)!==e*i&&n>0;)i*=10,n--;return s.fromNumbers(e*i,i,t)}multiplyByLong(e){return o.multiplyDivideFloor(e,this.a,this.b)}multiplyByLongCeil(e){return o.multiplyDivideCeil(e,this.a,this.b)}multiplyByRational(e){return new s(this.a.multiply(e.a),this.b.multiply(e.b),this.unsigned)}greaterThanOne(){return this.a.greaterThan(this.b)}complement(){if(this.a.greaterThan(this.b))throw new Error("cannot take complement of rational >1");return new s(this.b.subtract(this.a),this.b,this.unsigned)}reciprocal(){return new s(this.b,this.a,this.unsigned)}toNumber(){return this.a.toNumber()/this.b.toNumber()}toString(){const e=function(e,t){for(let r=e.length-1;r>=0;r--)if(e[r]!==t)return e.slice(0,r+1);return""}(this.toFixed(19),"0");return"."===e[e.length-1]?e.slice(0,-1):e}toFixed(e){e=e||0;const t=this.a.divide(this.b);if(0===e)return t.toString();const r=this.a.modulo(this.b),n=o.multiplyDivideRound(r,function(e){const t=i.fromNumber(10,!0);let r=i.UONE;for(;e--;)r=r.multiply(t);return r}(e),this.b).toString();return t.toString()+"."+"0".repeat(e-n.length)+n}}t.default=s,s.UZERO=new s(i.UZERO,i.UONE,!0)},function(e,t,r){var n=r(117),i=r(118),o=i;o.v1=n,o.v4=i,e.exports=o},function(e,t,r){var n,i,o=r(47),s=r(48),a=0,c=0;e.exports=function(e,t,r){var u=t&&r||0,l=t||[],f=(e=e||{}).node||n,h=void 0!==e.clockseq?e.clockseq:i;if(null==f||null==h){var d=o();null==f&&(f=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==h&&(h=i=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,m=p-a+(g-c)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||p>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,c=g,i=h;var y=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;l[u++]=y>>>24&255,l[u++]=y>>>16&255,l[u++]=y>>>8&255,l[u++]=255&y;var w=p/4294967296*1e4&268435455;l[u++]=w>>>8&255,l[u++]=255&w,l[u++]=w>>>24&15|16,l[u++]=w>>>16&255,l[u++]=h>>>8|128,l[u++]=255&h;for(var b=0;b<6;++b)l[u+b]=f[b];return t||s(l)}},function(e,t,r){var n=r(47),i=r(48);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(121);t.BandwidthTiers=n.BandwidthTiers},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(122),s=[0,1e5,15e4,25e4],a=function(){function e(){}return e.prototype.tierDataExpired=function(){return!this.tierDataDate||(new Date).getTime()-this.tierDataDate.getTime()>18e5},e.prototype.getTier=function(e){return n(this,void 0,void 0,(function(){var t,r,n,o,s,a,c,u;return i(this,(function(i){switch(i.label){case 0:return[4,this.fetchTierData()];case 1:if(t=i.sent(),r=t[e])return[2,r];for(n=new URL(e),o=n.origin,s=n.pathname.split("/"),a=s.length;a>0;a--)if(c=s.slice(0,a).join(),u=t[o+c])return[2,u];return[2,1]}}))}))},e.prototype.getBandwidth=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return[4,this.getTier(e)];case 1:return t=r.sent(),[2,s[t]||s[1]]}}))}))},e.prototype.fetchTierData=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return this.tierData&&!this.tierDataExpired()?[2,this.tierData]:[4,o.portableFetch("https://cdn.coil.com/tierdata.json")];case 1:if(!(e=r.sent()).ok)throw new Error("failed to fetch tier data");return[4,e.json()];case 2:return t=r.sent(),this.tierData=t,this.tierDataDate=new Date,[2,t]}}))}))},e}();t.BandwidthTiers=a},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(31);t.portableFetch=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o(e,t)]}))}))}},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=r(15),o=r(24),s=function(){function e(e){this.doc=e,this.finalized=!0,this.state="stopped"}return e.prototype.setMonetizationRequest=function(e){this.request=e,this.finalized=!0},e.prototype.setState=function(e){var t=e.state,r=e.finalized;if(o.debug("SET STATE","new:",{state:t,finalized:r},"old:",{state:this.state,finalized:this.finalized}),void 0!==r&&"stopped"!==t)throw new Error("invalid_state: finalized set when not stopped state");var n=(r=Boolean(r))!=this.finalized,s=this.state!=t,a=s||n;return this.state=t,this.finalized=r,a&&(s&&(i.getDoc(this.doc).monetization.state=t),!this.request||"stopped"!==t&&"pending"!==t||this.dispatchMonetizationEvent("pending"===t?"monetizationpending":"monetizationstop",this.request,r)),a},e.prototype.dispatchMonetizationStartEventAndSetMonetizationState=function(e){if(!this.setState({state:"started"}))throw new Error("expecting state transition");this.dispatchMonetizationEvent("monetizationstart",e)},e.prototype.dispatchMonetizationEvent=function(e,t,r){var o=n({},t);"monetizationstop"===e&&(o.finalized=Boolean(r)),i.getDoc(this.doc).monetization.dispatchEvent(new CustomEvent(e,{detail:o}))},e.prototype.dispatchMonetizationProgressEvent=function(e){this.dispatchMonetizationEvent("monetizationprogress",e)},e}();t.DocumentMonetization=s},function(e,t,r){"use strict";r.r(t),r.d(t,"v1",(function(){return d})),r.d(t,"v3",(function(){return _})),r.d(t,"v4",(function(){return E})),r.d(t,"v5",(function(){return T}));var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);function o(){if(!n)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}for(var s=[],a=0;a<256;++a)s[a]=(a+256).toString(16).substr(1);var c,u,l=function(e,t){var r=t||0,n=s;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},f=0,h=0;var d=function(e,t,r){var n=t&&r||0,i=t||[],s=(e=e||{}).node||c,a=void 0!==e.clockseq?e.clockseq:u;if(null==s||null==a){var d=e.random||(e.rng||o)();null==s&&(s=c=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==a&&(a=u=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:h+1,m=p-f+(g-h)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||p>f)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=p,h=g,u=a;var y=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;i[n++]=y>>>24&255,i[n++]=y>>>16&255,i[n++]=y>>>8&255,i[n++]=255&y;var w=p/4294967296*1e4&268435455;i[n++]=w>>>8&255,i[n++]=255&w,i[n++]=w>>>24&15|16,i[n++]=w>>>16&255,i[n++]=a>>>8|128,i[n++]=255&a;for(var b=0;b<6;++b)i[n+b]=s[b];return t||l(i)};var p=function(e,t,r){var n=function(e,n,i,o){var s=i&&o||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)),"string"==typeof n&&(n=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(n)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||16!==n.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var a=r(n.concat(e));if(a[6]=15&a[6]|t,a[8]=63&a[8]|128,i)for(var c=0;c<16;++c)i[s+c]=a[c];return i||l(a)};try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};function g(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function m(e,t,r,n,i,o){return g((s=g(g(t,e),g(n,o)))<<(a=i)|s>>>32-a,r);var s,a}function y(e,t,r,n,i,o,s){return m(t&r|~t&n,e,t,i,o,s)}function w(e,t,r,n,i,o,s){return m(t&n|r&~n,e,t,i,o,s)}function b(e,t,r,n,i,o,s){return m(t^r^n,e,t,i,o,s)}function v(e,t,r,n,i,o,s){return m(r^(t|~n),e,t,i,o,s)}var _=p("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var r=0;r<t.length;r++)e[r]=t.charCodeAt(r)}return function(e){var t,r,n,i=[],o=32*e.length;for(t=0;t<o;t+=8)r=e[t>>5]>>>t%32&255,n=parseInt("0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r),16),i.push(n);return i}(function(e,t){var r,n,i,o,s;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var a=1732584193,c=-271733879,u=-1732584194,l=271733878;for(r=0;r<e.length;r+=16)n=a,i=c,o=u,s=l,a=y(a,c,u,l,e[r],7,-680876936),l=y(l,a,c,u,e[r+1],12,-389564586),u=y(u,l,a,c,e[r+2],17,606105819),c=y(c,u,l,a,e[r+3],22,-1044525330),a=y(a,c,u,l,e[r+4],7,-176418897),l=y(l,a,c,u,e[r+5],12,1200080426),u=y(u,l,a,c,e[r+6],17,-1473231341),c=y(c,u,l,a,e[r+7],22,-45705983),a=y(a,c,u,l,e[r+8],7,1770035416),l=y(l,a,c,u,e[r+9],12,-1958414417),u=y(u,l,a,c,e[r+10],17,-42063),c=y(c,u,l,a,e[r+11],22,-1990404162),a=y(a,c,u,l,e[r+12],7,1804603682),l=y(l,a,c,u,e[r+13],12,-40341101),u=y(u,l,a,c,e[r+14],17,-1502002290),c=y(c,u,l,a,e[r+15],22,1236535329),a=w(a,c,u,l,e[r+1],5,-165796510),l=w(l,a,c,u,e[r+6],9,-1069501632),u=w(u,l,a,c,e[r+11],14,643717713),c=w(c,u,l,a,e[r],20,-373897302),a=w(a,c,u,l,e[r+5],5,-701558691),l=w(l,a,c,u,e[r+10],9,38016083),u=w(u,l,a,c,e[r+15],14,-660478335),c=w(c,u,l,a,e[r+4],20,-405537848),a=w(a,c,u,l,e[r+9],5,568446438),l=w(l,a,c,u,e[r+14],9,-1019803690),u=w(u,l,a,c,e[r+3],14,-187363961),c=w(c,u,l,a,e[r+8],20,1163531501),a=w(a,c,u,l,e[r+13],5,-1444681467),l=w(l,a,c,u,e[r+2],9,-51403784),u=w(u,l,a,c,e[r+7],14,1735328473),c=w(c,u,l,a,e[r+12],20,-1926607734),a=b(a,c,u,l,e[r+5],4,-378558),l=b(l,a,c,u,e[r+8],11,-2022574463),u=b(u,l,a,c,e[r+11],16,1839030562),c=b(c,u,l,a,e[r+14],23,-35309556),a=b(a,c,u,l,e[r+1],4,-1530992060),l=b(l,a,c,u,e[r+4],11,1272893353),u=b(u,l,a,c,e[r+7],16,-155497632),c=b(c,u,l,a,e[r+10],23,-1094730640),a=b(a,c,u,l,e[r+13],4,681279174),l=b(l,a,c,u,e[r],11,-358537222),u=b(u,l,a,c,e[r+3],16,-722521979),c=b(c,u,l,a,e[r+6],23,76029189),a=b(a,c,u,l,e[r+9],4,-640364487),l=b(l,a,c,u,e[r+12],11,-421815835),u=b(u,l,a,c,e[r+15],16,530742520),c=b(c,u,l,a,e[r+2],23,-995338651),a=v(a,c,u,l,e[r],6,-198630844),l=v(l,a,c,u,e[r+7],10,1126891415),u=v(u,l,a,c,e[r+14],15,-1416354905),c=v(c,u,l,a,e[r+5],21,-57434055),a=v(a,c,u,l,e[r+12],6,1700485571),l=v(l,a,c,u,e[r+3],10,-1894986606),u=v(u,l,a,c,e[r+10],15,-1051523),c=v(c,u,l,a,e[r+1],21,-2054922799),a=v(a,c,u,l,e[r+8],6,1873313359),l=v(l,a,c,u,e[r+15],10,-30611744),u=v(u,l,a,c,e[r+6],15,-1560198380),c=v(c,u,l,a,e[r+13],21,1309151649),a=v(a,c,u,l,e[r+4],6,-145523070),l=v(l,a,c,u,e[r+11],10,-1120210379),u=v(u,l,a,c,e[r+2],15,718787259),c=v(c,u,l,a,e[r+9],21,-343485551),a=g(a,n),c=g(c,i),u=g(u,o),l=g(l,s);return[a,c,u,l]}(function(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e[t/8])<<t%32;return r}(e),8*e.length))}));var E=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[n+s]=i[s];return t||l(i)};function S(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function I(e,t){return e<<t|e>>>32-t}var T=p("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=new Array(n.length);for(var i=0;i<n.length;i++)e[i]=n.charCodeAt(i)}e.push(128);var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s);for(i=0;i<s;i++){a[i]=new Array(16);for(var c=0;c<16;c++)a[i][c]=e[64*i+4*c]<<24|e[64*i+4*c+1]<<16|e[64*i+4*c+2]<<8|e[64*i+4*c+3]}for(a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295,i=0;i<s;i++){for(var u=new Array(80),l=0;l<16;l++)u[l]=a[i][l];for(l=16;l<80;l++)u[l]=I(u[l-3]^u[l-8]^u[l-14]^u[l-16],1);var f=r[0],h=r[1],d=r[2],p=r[3],g=r[4];for(l=0;l<80;l++){var m=Math.floor(l/20),y=I(f,5)+S(m,h,d,p)+g+t[m]+u[l]>>>0;g=p,p=d,d=I(h,30)>>>0,h=f,f=y}r[0]=r[0]+f>>>0,r[1]=r[1]+h>>>0,r[2]=r[2]+d>>>0,r[3]=r[3]+p>>>0,r[4]=r[4]+g>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}))}])}));